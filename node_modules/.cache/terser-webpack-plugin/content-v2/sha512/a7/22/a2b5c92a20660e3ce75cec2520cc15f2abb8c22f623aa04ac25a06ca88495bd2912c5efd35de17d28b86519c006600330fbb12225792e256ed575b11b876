{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{456:function(s,t,a){\"use strict\";a.r(t);var n=a(13),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"redis-消息队列的三种方案-list、streams、pub-sub\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-消息队列的三种方案-list、streams、pub-sub\"}},[s._v(\"#\")]),s._v(\" Redis 消息队列的三种方案（List、Streams、Pub/Sub）\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/Jstarfish/picBed/img/008eGmZEly1gmjoestg8dj31eu0ixtam.jpg\",alt:\"\"}})]),s._v(\" \"),a(\"p\",[s._v(\"现如今的互联网应用大都是采用 \"),a(\"strong\",[s._v(\"分布式系统架构\")]),s._v(\" 设计的，所以 \"),a(\"strong\",[s._v(\"消息队列\")]),s._v(\" 已经逐渐成为企业应用系统 \"),a(\"strong\",[s._v(\"内部通信\")]),s._v(\" 的核心手段，\")]),s._v(\" \"),a(\"p\",[s._v(\"它具有 \"),a(\"strong\",[s._v(\"低耦合\")]),s._v(\"、\"),a(\"strong\",[s._v(\"可靠投递\")]),s._v(\"、\"),a(\"strong\",[s._v(\"广播\")]),s._v(\"、\"),a(\"strong\",[s._v(\"流量控制\")]),s._v(\"、\"),a(\"strong\",[s._v(\"最终一致性\")]),s._v(\" 等一系列功能。\")]),s._v(\" \"),a(\"p\",[s._v(\"当前使用较多的 \"),a(\"strong\",[s._v(\"消息队列\")]),s._v(\" 有 \"),a(\"code\",[s._v(\"RabbitMQ\")]),s._v(\"、\"),a(\"code\",[s._v(\"RocketMQ\")]),s._v(\"、\"),a(\"code\",[s._v(\"ActiveMQ\")]),s._v(\"、\"),a(\"code\",[s._v(\"Kafka\")]),s._v(\"、\"),a(\"code\",[s._v(\"ZeroMQ\")]),s._v(\"、\"),a(\"code\",[s._v(\"MetaMQ\")]),s._v(\" 等，而部分\"),a(\"strong\",[s._v(\"数据库\")]),s._v(\" 如 \"),a(\"code\",[s._v(\"Redis\")]),s._v(\"、\"),a(\"code\",[s._v(\"MySQL\")]),s._v(\" 以及 \"),a(\"code\",[s._v(\"phxsql\")]),s._v(\" ，如果硬搞的话，其实也可实现消息队列的功能。\")]),s._v(\" \"),a(\"p\",[s._v(\"可能有人觉得，各种开源的 MQ 已经足够使用了，为什么需要用 Redis 实现 MQ 呢？\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"有些简单的业务场景，可能不需要重量级的 MQ 组件（相比 Redis 来说，Kafka 和 RabbitMQ 都算是重量级的消息队列）\")])]),s._v(\" \"),a(\"p\",[s._v(\"那你有考虑过用 Redis 做消息队列吗？\")]),s._v(\" \"),a(\"p\",[s._v(\"这一章，我会结合消息队列的特点和 Redis 做消息队列的使用方式，以及实际项目中的使用，来和大家探讨下 Redis 消息队列的方案。\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"一、回顾消息队列\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#一、回顾消息队列\"}},[s._v(\"#\")]),s._v(\" 一、回顾消息队列\")]),s._v(\" \"),a(\"blockquote\",[a(\"p\",[a(\"strong\",[s._v(\"消息队列\")]),s._v(\" 是指利用 \"),a(\"strong\",[s._v(\"高效可靠\")]),s._v(\" 的 \"),a(\"strong\",[s._v(\"消息传递机制\")]),s._v(\" 进行与平台无关的 \"),a(\"strong\",[s._v(\"数据交流\")]),s._v(\"，并基于\"),a(\"strong\",[s._v(\"数据通信\")]),s._v(\"来进行分布式系统的集成。\")]),s._v(\" \"),a(\"p\",[s._v(\"通过提供 \"),a(\"strong\",[s._v(\"消息传递\")]),s._v(\" 和 \"),a(\"strong\",[s._v(\"消息排队\")]),s._v(\" 模型，它可以在 \"),a(\"strong\",[s._v(\"分布式环境\")]),s._v(\" 下提供 \"),a(\"strong\",[s._v(\"应用解耦\")]),s._v(\"、\"),a(\"strong\",[s._v(\"弹性伸缩\")]),s._v(\"、\"),a(\"strong\",[s._v(\"冗余存储\")]),s._v(\"、\"),a(\"strong\",[s._v(\"流量削峰\")]),s._v(\"、\"),a(\"strong\",[s._v(\"异步通信\")]),s._v(\"、\"),a(\"strong\",[s._v(\"数据同步\")]),s._v(\" 等等功能，其作为 \"),a(\"strong\",[s._v(\"分布式系统架构\")]),s._v(\" 中的一个重要组件，有着举足轻重的地位。\")])]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1glwfccxrs1j33hc0ruwtq.jpg\",alt:\"mq_overview\"}})]),s._v(\" \"),a(\"p\",[s._v(\"现在回顾下，我们使用的消息队列，一般都有什么样的特点：\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"三个角色：生产者、消费者、消息处理中心\")]),s._v(\" \"),a(\"li\",[s._v(\"异步处理模式：\"),a(\"strong\",[s._v(\"生产者\")]),s._v(\" 将消息发送到一条 \"),a(\"strong\",[s._v(\"虚拟的通道\")]),s._v(\"（消息队列）上，而无须等待响应。\"),a(\"strong\",[s._v(\"消费者\")]),s._v(\" 则 \"),a(\"strong\",[s._v(\"订阅\")]),s._v(\" 或是 \"),a(\"strong\",[s._v(\"监听\")]),s._v(\" 该通道，取出消息。两者互不干扰，甚至都不需要同时在线，也就是我们说的 \"),a(\"strong\",[s._v(\"松耦合\")])]),s._v(\" \"),a(\"li\",[s._v(\"可靠性：消息要可以保证不丢失、不重复消费、有时可能还需要顺序性的保证\")])]),s._v(\" \"),a(\"p\",[s._v(\"撇开我们常用的消息中间件不说，你觉得 Redis 的哪些数据类型可以满足 MQ 的常规需求~~\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"二、redis-实现消息队列\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#二、redis-实现消息队列\"}},[s._v(\"#\")]),s._v(\" 二、Redis 实现消息队列\")]),s._v(\" \"),a(\"p\",[s._v(\"思来想去，只有 List 和 Streams 两种数据类型，可以实现消息队列的这些需求，当然，Redis 还提供了发布、订阅(pub/sub) 模式。\")]),s._v(\" \"),a(\"p\",[s._v(\"我们逐一看下这 3 种方式的使用和场景。\")]),s._v(\" \"),a(\"h3\",{attrs:{id:\"_2-1-list-实现消息队列\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1-list-实现消息队列\"}},[s._v(\"#\")]),s._v(\" 2.1 List 实现消息队列\")]),s._v(\" \"),a(\"p\",[s._v(\"Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。\")]),s._v(\" \"),a(\"p\",[s._v(\"所以常用来做\"),a(\"strong\",[s._v(\"异步队列\")]),s._v(\"使用。将需要延后处理的任务结构体序列化成字符串塞进 Redis 的列表，另一个线程从这个列表中轮询数据进行处理。\")]),s._v(\" \"),a(\"p\",[s._v(\"Redis 提供了好几对 List 指令，先大概看下这些命令，混个眼熟\")]),s._v(\" \"),a(\"h4\",{attrs:{id:\"list-常用命令\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#list-常用命令\"}},[s._v(\"#\")]),s._v(\" List 常用命令\")]),s._v(\" \"),a(\"table\",[a(\"thead\",[a(\"tr\",[a(\"th\",[s._v(\"命令\")]),s._v(\" \"),a(\"th\",[s._v(\"用法\")]),s._v(\" \"),a(\"th\",[s._v(\"描述\")]),s._v(\" \"),a(\"th\",[s._v(\"示例\")])])]),s._v(\" \"),a(\"tbody\",[a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"LPUSH\")])]),s._v(\" \"),a(\"td\",[s._v(\"LPUSH key value [value ...]\")]),s._v(\" \"),a(\"td\",[s._v(\"将一个或多个值 value 插入到列表 key 的表头如果有多个 value 值，那么各个 value 值按从左到右的顺序依次插入到表头\")]),s._v(\" \"),a(\"td\",[s._v(\"正着进反着出\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"LPUSHX\")]),s._v(\" \"),a(\"td\",[s._v(\"LPUSHX key value\")]),s._v(\" \"),a(\"td\",[s._v(\"将值 value 插入到列表 key 的表头，当且仅当 key 存在并且是一个列表。和 LPUSH 命令相反，当 key 不存在时， LPUSHX 命令什么也不做\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"RPUSH\")])]),s._v(\" \"),a(\"td\",[s._v(\"RPUSH key value [value ...]\")]),s._v(\" \"),a(\"td\",[s._v(\"将一个或多个值 value 插入到列表 key 的表尾(最右边)\")]),s._v(\" \"),a(\"td\",[s._v(\"怎么进怎么出\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"RPUSHX\")]),s._v(\" \"),a(\"td\",[s._v(\"RPUSHX key value\")]),s._v(\" \"),a(\"td\",[s._v(\"将值 value 插入到列表 key 的表尾，当且仅当 key 存在并且是一个列表。和 RPUSH 命令相反，当 key 不存在时， RPUSHX 命令什么也不做。\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"LPOP\")])]),s._v(\" \"),a(\"td\",[s._v(\"LPOP key\")]),s._v(\" \"),a(\"td\",[s._v(\"移除并返回列表 key 的头元素。\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"BLPOP\")])]),s._v(\" \"),a(\"td\",[s._v(\"BLPOP key [key ...] timeout\")]),s._v(\" \"),a(\"td\",[s._v(\"移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"RPOP\")])]),s._v(\" \"),a(\"td\",[s._v(\"RPOP key\")]),s._v(\" \"),a(\"td\",[s._v(\"移除并返回列表 key 的尾元素。\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"BRPOP\")])]),s._v(\" \"),a(\"td\",[s._v(\"BRPOP key [key ...] timeout\")]),s._v(\" \"),a(\"td\",[s._v(\"移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"BRPOPLPUSH\")]),s._v(\" \"),a(\"td\",[s._v(\"BRPOPLPUSH source destination timeout\")]),s._v(\" \"),a(\"td\",[s._v(\"从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"RPOPLPUSH\")]),s._v(\" \"),a(\"td\",[s._v(\"RPOPLPUSH source destinationb\")]),s._v(\" \"),a(\"td\",[s._v(\"命令 RPOPLPUSH 在一个原子时间内，执行以下两个动作：将列表 source 中的最后一个元素(尾元素)弹出，并返回给客户端。将 source 弹出的元素插入到列表 destination ，作为 destination 列表的的头元素\")]),s._v(\" \"),a(\"td\",[s._v(\"RPOPLPUSH list01 list02\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"LSET\")])]),s._v(\" \"),a(\"td\",[s._v(\"LSET key index value\")]),s._v(\" \"),a(\"td\",[s._v(\"将列表 key 下标为 index 的元素的值设置为 value\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"LLEN\")])]),s._v(\" \"),a(\"td\",[s._v(\"LLEN key\")]),s._v(\" \"),a(\"td\",[s._v(\"返回列表 key 的长度。如果 key 不存在，则 key 被解释为一个空列表，返回 0 .如果 key 不是列表类型，返回一个错误\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"LINDEX\")])]),s._v(\" \"),a(\"td\",[s._v(\"LINDEX key index\")]),s._v(\" \"),a(\"td\",[s._v(\"返回列表 key 中，下标为 index 的元素。下标(index)参数 start 和 stop 都以 0 为底，也就是说，以 0 表示列表的第一个元素，以 1 表示列表的第二个元素，以此类推。\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"LRANGE\")])]),s._v(\" \"),a(\"td\",[s._v(\"LRANGE key start stop\")]),s._v(\" \"),a(\"td\",[s._v(\"返回列表 key 中指定区间内的元素，区间以偏移量 start 和 stop 指定\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"LREM\")]),s._v(\" \"),a(\"td\",[s._v(\"LREM key count value\")]),s._v(\" \"),a(\"td\",[s._v(\"根据参数 count 的值，移除列表中与参数 value 相等的元素\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"LTRIM\")]),s._v(\" \"),a(\"td\",[s._v(\"LTRIM key start stop\")]),s._v(\" \"),a(\"td\",[s._v(\"对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除\")]),s._v(\" \"),a(\"td\")]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"LINSERT\")]),s._v(\" \"),a(\"td\",[s._v(\"LINSERT key BEFORE|AFTER pivot value\")]),s._v(\" \"),a(\"td\",[s._v(\"将值 value 插入到列表 key 当中，位于值 pivot 之前或之后。当 pivot 不存在于列表 key 时，不执行任何操作。当 key 不存在时， key 被视为空列表，不执行任何操作。如果 key 不是列表类型，返回一个错误。\")]),s._v(\" \"),a(\"td\",[s._v(\"LINSERT list01 before c++ c#(在c++之前加上C#)\")])])])]),s._v(\" \"),a(\"p\",[s._v(\"挑几个弹入、弹出的命令就可以组合出很多\"),a(\"strong\",[s._v(\"姿势\")])]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[s._v(\"LPUSH、RPOP  左进右出\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"RPUSH、LPOP  右进左出\")])])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" lpush mylist a a b c d e\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" rpop mylist\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"a\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" rpop mylist\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"a\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" rpop mylist\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"b\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" \\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1glyvjgvlowj33li0l0wmw.jpg\",alt:\"redis-RPOP\"}})]),s._v(\" \"),a(\"h4\",{attrs:{id:\"即时消费问题\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#即时消费问题\"}},[s._v(\"#\")]),s._v(\" 即时消费问题\")]),s._v(\" \"),a(\"p\",[s._v(\"通过 \"),a(\"code\",[s._v(\"LPUSH\")]),s._v(\"，\"),a(\"code\",[s._v(\"RPOP\")]),s._v(\" 这样的方式，会存在一个性能风险点，就是消费者如果想要及时的处理数据，就要在程序中写个类似 \"),a(\"code\",[s._v(\"while(true)\")]),s._v(\" 这样的逻辑，不停的去调用 RPOP 或 LPOP 命令，这就会给消费者程序带来些不必要的性能损失。\")]),s._v(\" \"),a(\"p\",[s._v(\"所以，Redis 还提供了 \"),a(\"code\",[s._v(\"BLPOP\")]),s._v(\"、\"),a(\"code\",[s._v(\"BRPOP\")]),s._v(\" 这种阻塞式读取的命令（带 B-Bloking的都是阻塞式），客户端在没有读到队列数据时，自动阻塞，直到有新的数据写入队列，再开始读取新数据。这种方式就节省了不必要的 CPU 开销。\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[s._v(\"LPUSH、BRPOP  左进右阻塞出\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"RPUSH、BLPOP  右进左阻塞出\")])])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" lpush yourlist a b c d\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" blpop yourlist \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"yourlist\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"d\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" blpop yourlist \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"yourlist\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"c\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" blpop yourlist \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"yourlist\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"b\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" blpop yourlist \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"yourlist\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"a\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" blpop yourlist \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"nil\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\".02s\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\")])]),a(\"p\",[a(\"strong\",[s._v(\"如果将超时时间设置为 0 时，即可无限等待，直到弹出消息\")])]),s._v(\" \"),a(\"p\",[s._v(\"因为 Redis 单线程的特点，所以在消费数据时，同一个消息会不会同时被多个 \"),a(\"code\",[s._v(\"consumer\")]),s._v(\" 消费掉，但是需要我们考虑消费不成功的情况。\")]),s._v(\" \"),a(\"h4\",{attrs:{id:\"可靠队列模式-ack-机制\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#可靠队列模式-ack-机制\"}},[s._v(\"#\")]),s._v(\" 可靠队列模式 | ack 机制\")]),s._v(\" \"),a(\"p\",[s._v(\"以上方式中， List 队列中的消息一经发送出去，便从队列里删除。如果由于网络原因消费者没有收到消息，或者消费者在处理这条消息的过程中崩溃了，就再也无法还原出这条消息。究其原因，就是缺少消息确认机制。\")]),s._v(\" \"),a(\"p\",[s._v(\"为了保证消息的可靠性，消息队列都会有完善的消息确认机制（Acknowledge），即消费者向队列报告消息已收到或已处理的机制。\")]),s._v(\" \"),a(\"p\",[a(\"strong\",[s._v(\"Redis List 怎么搞一搞呢？\")])]),s._v(\" \"),a(\"p\",[s._v(\"再看上边的表格中，有两个命令，  \"),a(\"code\",[s._v(\"RPOPLPUSH\")]),s._v(\"、\"),a(\"code\",[s._v(\"BRPOPLPUSH\")]),s._v(\" （阻塞）从一个 list 中获取消息的同时把这条消息复制到另一个 list 里（可以当做备份），而且这个过程是原子的。\")]),s._v(\" \"),a(\"p\",[s._v(\"这样我们就可以在业务流程安全结束后，再删除队列元素，实现消息确认机制。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-c line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-c\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" rpush myqueue \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"one\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" rpush myqueue \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"two\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" rpush myqueue \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"three\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" rpoplpush myqueue queuebak\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"three\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" lrange myqueue \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"one\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"two\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" lrange queuebak \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"three\"')]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\")])]),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1gm3u36miftj33390u04a3.jpg\",alt:\"redis-rpoplpush\"}})]),s._v(\" \"),a(\"p\",[s._v(\"之前做过的项目中就有用到这样的方式去处理数据，数据标识从一个 List 取出后放入另一个 List，业务操作安全执行完成后，再去删除 List 中的数据，如果有问题的话，很好回滚。\")]),s._v(\" \"),a(\"p\",[s._v(\"当然，还有更特殊的场景，可以通过 \"),a(\"strong\",[s._v(\"zset\")]),s._v(\" 来实现\"),a(\"strong\",[s._v(\"延时消息队列\")]),s._v(\"，原理就是将消息加到 zset 结构后，将要被消费的时间戳设置为对应的 score 即可，只要业务数据不会是重复数据就 OK。\")]),s._v(\" \"),a(\"h3\",{attrs:{id:\"_2-2-订阅与发布实现消息队列\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-订阅与发布实现消息队列\"}},[s._v(\"#\")]),s._v(\" 2.2 订阅与发布实现消息队列\")]),s._v(\" \"),a(\"p\",[s._v(\"我们都知道消息模型有两种\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"点对点： Point-to-Point(P2P)\")]),s._v(\" \"),a(\"li\",[s._v(\"发布订阅：Publish/Subscribe(Pub/Sub)\")])]),s._v(\" \"),a(\"p\",[s._v(\"List 实现方式其实就是点对点的模式，下边我们再看下 Redis 的发布订阅模式（消息多播），这才是“根正苗红”的 Redis MQ\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/Jstarfish/picBed/redis/redis0081Kckwly1gm3py9nvc9j321q0u0dv3.jpg\",alt:\"redis-pub_sub\"}})]),s._v(\" \"),a(\"p\",[s._v('\"发布/订阅\"模式同样可以实现进程间的消息传递，其原理如下:')]),s._v(\" \"),a(\"p\",[s._v('\"发布/订阅\"模式包含两种角色，分别是发布者和订阅者。订阅者可以订阅一个或者多个频道(channel)，而发布者可以向指定的频道(channel)发送消息，所有订阅此频道的订阅者都会收到此消息。')]),s._v(\" \"),a(\"p\",[s._v(\"Redis 通过 \"),a(\"code\",[s._v(\"PUBLISH\")]),s._v(\" 、 \"),a(\"code\",[s._v(\"SUBSCRIBE\")]),s._v(\" 等命令实现了订阅与发布模式， 这个功能提供两种信息机制， 分别是订阅/发布到频道和订阅/发布到模式。\")]),s._v(\" \"),a(\"p\",[s._v(\"这个 \"),a(\"strong\",[s._v(\"频道\")]),s._v(\" 和 \"),a(\"strong\",[s._v(\"模式\")]),s._v(\" 有什么区别呢？\")]),s._v(\" \"),a(\"p\",[s._v(\"频道我们可以先理解为是个 Redis 的 key 值，而模式，可以理解为是一个类似正则匹配的 Key，只是个可以匹配给定模式的频道。这样就不需要显式的去订阅多个名称了，可以通过模式订阅这种方式，一次性关注多个频道。\")]),s._v(\" \"),a(\"p\",[s._v(\"我们启动三个 Redis 客户端看下效果：\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1gm2qvbkezmj31z00q4ql8.jpg\",alt:\"redis-subscribe\"}})]),s._v(\" \"),a(\"p\",[s._v(\"先启动两个客户端订阅（subscribe） 名字叫 framework 的频道，然后第三个客户端往 framework 发消息，可以看到前两个客户端都会接收到对应的消息：\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1gm2r9bsurcj31jn0u0qn3.jpg\",alt:\"redis-publish\"}})]),s._v(\" \"),a(\"p\",[s._v(\"我们可以看到订阅的客户端每次可以收到一个 3 个参数的消息，分别为：\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"消息的种类\")]),s._v(\" \"),a(\"li\",[s._v(\"始发频道的名称\")]),s._v(\" \"),a(\"li\",[s._v(\"实际的消息\")])]),s._v(\" \"),a(\"p\",[s._v(\"再来看下订阅符合给定\"),a(\"strong\",[s._v(\"模式\")]),s._v(\"的频道，这回订阅的命令是 \"),a(\"code\",[s._v(\"PSUBSCRIBE\")])]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1gm2rr2c9nhj31tg0tutrx.jpg\",alt:\"redis-psubscribe\"}})]),s._v(\" \"),a(\"p\",[s._v(\"我们往 \"),a(\"code\",[s._v(\"java.framework\")]),s._v(\" 这个频道发送了一条消息，不止订阅了该频道的 Consumer1 和 Consumer2 可以接收到消息，订阅了模式 \"),a(\"code\",[s._v(\"java.*\")]),s._v(\" 的 Consumer3 和 Consumer4 也可以接收到消息。\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1gm4j4kxisrj31nt0u07ku.jpg\",alt:\"redis-psubscribe1\"}})]),s._v(\" \"),a(\"h4\",{attrs:{id:\"pub-sub-常用命令\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#pub-sub-常用命令\"}},[s._v(\"#\")]),s._v(\" Pub/Sub 常用命令：\")]),s._v(\" \"),a(\"table\",[a(\"thead\",[a(\"tr\",[a(\"th\",[s._v(\"命令\")]),s._v(\" \"),a(\"th\",[s._v(\"用法\")]),s._v(\" \"),a(\"th\",[s._v(\"描述\")])])]),s._v(\" \"),a(\"tbody\",[a(\"tr\",[a(\"td\",[s._v(\"PSUBSCRIBE\")]),s._v(\" \"),a(\"td\",[s._v(\"PSUBSCRIBE pattern [pattern ...]\")]),s._v(\" \"),a(\"td\",[s._v(\"订阅一个或多个符合给定模式的频道\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"PUBSUB\")]),s._v(\" \"),a(\"td\",[s._v(\"PUBSUB subcommand [argument [argument ...]]\")]),s._v(\" \"),a(\"td\",[s._v(\"查看订阅与发布系统状态\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"PUBLISH\")]),s._v(\" \"),a(\"td\",[s._v(\"PUBLISH channel message\")]),s._v(\" \"),a(\"td\",[s._v(\"将信息发送到指定的频道\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"PUNSUBSCRIBE\")]),s._v(\" \"),a(\"td\",[s._v(\"PUNSUBSCRIBE [pattern [pattern ...]]\")]),s._v(\" \"),a(\"td\",[s._v(\"退订所有给定模式的频道\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"SUBSCRIBE\")]),s._v(\" \"),a(\"td\",[s._v(\"SUBSCRIBE channel [channel ...]\")]),s._v(\" \"),a(\"td\",[s._v(\"订阅给定的一个或多个频道的信息\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"UNSUBSCRIBE\")]),s._v(\" \"),a(\"td\",[s._v(\"UNSUBSCRIBE [channel [channel ...]]\")]),s._v(\" \"),a(\"td\",[s._v(\"指退订给定的频道\")])])])]),s._v(\" \"),a(\"h3\",{attrs:{id:\"_2-3-streams-实现消息队列\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-3-streams-实现消息队列\"}},[s._v(\"#\")]),s._v(\" 2.3 Streams 实现消息队列\")]),s._v(\" \"),a(\"p\",[s._v(\"Redis 发布订阅 (pub/sub) 有个缺点就是消息无法持久化，如果出现网络断开、Redis 宕机等，消息就会被丢弃。而且也没有 Ack 机制来保证数据的可靠性，假设一个消费者都没有，那消息就直接被丢弃了。\")]),s._v(\" \"),a(\"blockquote\",[a(\"p\",[s._v(\"后来 Redis 的父亲 Antirez，又单独开启了一个叫 Disque 的项目来完善这些问题，但是没有做起来，github 的更新也定格在了 5 年前，所以我们就不讨论了。\")])]),s._v(\" \"),a(\"p\",[s._v(\"Redis 5.0 版本新增了一个更强大的数据结构——\"),a(\"strong\",[s._v(\"Stream\")]),s._v(\"。它提供了消息的持久化和主备复制功能，可以让任何客户端访问任何时刻的数据，并且能记住每一个客户端的访问位置，还能保证消息不丢失。\")]),s._v(\" \"),a(\"p\",[s._v(\"它就像是个仅追加内容的\"),a(\"strong\",[s._v(\"消息链表\")]),s._v(\"，把所有加入的消息都串起来，每个消息都有一个唯一的 ID 和对应的内容。而且消息是持久化的。\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/Jstarfish/picBed/redis/redis-stream.png\",alt:\"redis-stream\"}})]),s._v(\" \"),a(\"p\",[s._v(\"每个 Stream 都有唯一的名称，它就是 Redis 的 key，在我们首次使用 xadd 指令追加消息时自动创建。\")]),s._v(\" \"),a(\"p\",[s._v(\"Streams 是 Redis 专门为消息队列设计的数据类型，所以提供了丰富的消息队列操作命令。\")]),s._v(\" \"),a(\"h4\",{attrs:{id:\"stream-常用命令\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#stream-常用命令\"}},[s._v(\"#\")]),s._v(\" Stream 常用命令\")]),s._v(\" \"),a(\"table\",[a(\"thead\",[a(\"tr\",[a(\"th\",[s._v(\"命令\")]),s._v(\" \"),a(\"th\",[s._v(\"描述\")]),s._v(\" \"),a(\"th\",[s._v(\"用法\")])])]),s._v(\" \"),a(\"tbody\",[a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"XADD\")])]),s._v(\" \"),a(\"td\",[s._v(\"添加消息到末尾，保证有序，可以自动生成唯一ID\")]),s._v(\" \"),a(\"td\",[s._v(\"XADD key ID field value [field value ...]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XTRIM\")]),s._v(\" \"),a(\"td\",[s._v(\"对流进行修剪，限制长度\")]),s._v(\" \"),a(\"td\",[s._v(\"XTRIM key MAXLEN [~] count\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XDEL\")]),s._v(\" \"),a(\"td\",[s._v(\"删除消息\")]),s._v(\" \"),a(\"td\",[s._v(\"XDEL key ID [ID ...]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XLEN\")]),s._v(\" \"),a(\"td\",[s._v(\"获取流包含的元素数量，即消息长度\")]),s._v(\" \"),a(\"td\",[s._v(\"XLEN key\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XRANGE\")]),s._v(\" \"),a(\"td\",[s._v(\"获取消息列表，会自动过滤已经删除的消息\")]),s._v(\" \"),a(\"td\",[s._v(\"XRANGE key start end [COUNT count]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XREVRANGE\")]),s._v(\" \"),a(\"td\",[s._v(\"反向获取消息列表，ID 从大到小\")]),s._v(\" \"),a(\"td\",[s._v(\"XREVRANGE key end start [COUNT count]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"XREAD\")])]),s._v(\" \"),a(\"td\",[s._v(\"以阻塞或非阻塞方式获取消息列表\")]),s._v(\" \"),a(\"td\",[s._v(\"XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] id [id ...]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"XGROUP CREATE\")])]),s._v(\" \"),a(\"td\",[s._v(\"创建消费者组\")]),s._v(\" \"),a(\"td\",[s._v(\"XGROUP [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname] [DELCONSUMER key groupname consumername]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[a(\"strong\",[s._v(\"XREADGROUP GROUP\")])]),s._v(\" \"),a(\"td\",[s._v(\"读取消费者组中的消息\")]),s._v(\" \"),a(\"td\",[s._v(\"XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XACK\")]),s._v(\" \"),a(\"td\",[s._v('将消息标记为\"已处理\"')]),s._v(\" \"),a(\"td\",[s._v(\"XACK key group ID [ID ...]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XGROUP SETID\")]),s._v(\" \"),a(\"td\",[s._v(\"为消费者组设置新的最后递送消息ID\")]),s._v(\" \"),a(\"td\",[s._v(\"XGROUP SETID [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XGROUP DELCONSUMER\")]),s._v(\" \"),a(\"td\",[s._v(\"删除消费者\")]),s._v(\" \"),a(\"td\",[s._v(\"XGROUP DELCONSUMER [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XGROUP DESTROY\")]),s._v(\" \"),a(\"td\",[s._v(\"删除消费者组\")]),s._v(\" \"),a(\"td\",[s._v(\"XGROUP DESTROY [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname] [DEL\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XPENDING\")]),s._v(\" \"),a(\"td\",[s._v(\"显示待处理消息的相关信息\")]),s._v(\" \"),a(\"td\",[s._v(\"XPENDING key group [start end count] [consumer]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XCLAIM\")]),s._v(\" \"),a(\"td\",[s._v(\"转移消息的归属权\")]),s._v(\" \"),a(\"td\",[s._v(\"XCLAIM key group consumer min-idle-time ID [ID ...] [IDLE ms] [TIME ms-unix-time] [RETRYCOUNT count]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XINFO\")]),s._v(\" \"),a(\"td\",[s._v(\"查看流和消费者组的相关信息\")]),s._v(\" \"),a(\"td\",[s._v(\"XINFO [CONSUMERS key groupname] [GROUPS key] [STREAM key] [HELP]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XINFO GROUPS\")]),s._v(\" \"),a(\"td\",[s._v(\"打印消费者组的信息\")]),s._v(\" \"),a(\"td\",[s._v(\"XINFO GROUPS [CONSUMERS key groupname] [GROUPS key] [STREAM key] [HELP]\")])]),s._v(\" \"),a(\"tr\",[a(\"td\",[s._v(\"XINFO STREAM\")]),s._v(\" \"),a(\"td\",[s._v(\"打印流信息\")]),s._v(\" \"),a(\"td\",[s._v(\"XINFO STREAM [CONSUMERS key groupname] [GROUPS key] [STREAM key] [HELP]\")])])])]),s._v(\" \"),a(\"h4\",{attrs:{id:\"crud-工程师上线\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#crud-工程师上线\"}},[s._v(\"#\")]),s._v(\" CRUD 工程师上线\")]),s._v(\" \"),a(\"h5\",{attrs:{id:\"增删改查来一波\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#增删改查来一波\"}},[s._v(\"#\")]),s._v(\" 增删改查来一波\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# * 号表示服务器自动生成 ID，后面顺序跟着一堆 key/value\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xadd mystream * f1 v1 f2 v2 f3 v3\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609404470049-0\"')]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"## 生成的消息 ID，有两部分组成，毫秒时间戳-该毫秒内产生的第1条消息\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 消息ID 必须要比上个 ID 大\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xadd mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"123\")]),s._v(\" f4 v4  \\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"error\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" ERR The ID specified \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"in\")]),s._v(\" XADD is equal or smaller than the target stream \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"top\")]),s._v(\" item\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 自定义ID\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xadd mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1609404470049\")]),s._v(\"-1 f4 v4\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609404470049-1\"')]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# -表示最小值 , + 表示最大值,也可以指定最大消息ID，或最小消息ID，配合 -、+ 使用\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xrange mystream - +\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609404470049-0\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f1\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v1\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f2\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v2\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f3\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v3\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609404470049-1\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f4\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v4\"')]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xdel mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1609404470049\")]),s._v(\"-1\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xlen mystream\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 删除整个 stream\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" del mystream\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),a(\"br\")])]),a(\"h5\",{attrs:{id:\"独立消费\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#独立消费\"}},[s._v(\"#\")]),s._v(\" 独立消费\")]),s._v(\" \"),a(\"p\",[a(\"code\",[s._v(\"xread\")]),s._v(\" 以阻塞或非阻塞方式获取消息列表，指定 \"),a(\"code\",[s._v(\"BLOCK\")]),s._v(\" 选项即表示阻塞，超时时间 0 毫秒（意味着永不超时）\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 从ID是0-0的开始读前2条\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xread count \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\" streams mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mystream\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609405178536-0\"')]),s._v(\"\\n         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f5\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v5\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609405198676-0\"')]),s._v(\"\\n         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f1\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v1\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f2\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v2\"')]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 阻塞的从尾部读取流，开启新的客户端xadd后发现这里就读到了,block 0 表示永久阻塞\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xread block \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" streams mystream $\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mystream\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609408791503-0\"')]),s._v(\"\\n         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f6\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v6\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"42\")]),s._v(\".37s\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\")])]),a(\"p\",[s._v(\"可以看到，我并没有给流 \"),a(\"code\",[s._v(\"mystream\")]),s._v(\" 传入一个常规的 ID，而是传入了一个特殊的 ID \"),a(\"code\",[s._v(\"$\")]),s._v(\"这个特殊的 ID 意思是 \"),a(\"strong\",[s._v(\"XREAD\")]),s._v(\" 应该使用流 \"),a(\"code\",[s._v(\"mystream\")]),s._v(\" 已经存储的最大 ID 作为最后一个 ID。以便我们仅接收从我们开始监听时间以后的新消息。这在某种程度上相似于 Unix 命令\"),a(\"code\",[s._v(\"tail -f\")]),s._v(\"。\")]),s._v(\" \"),a(\"p\",[s._v(\"当然，也可以指定任意有效的 ID。\")]),s._v(\" \"),a(\"p\",[s._v(\"而且， \"),a(\"code\",[s._v(\"XREAD\")]),s._v(\" 的阻塞形式还可以同时监听多个 Strema，只需要指定多个键名即可。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-c line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-c\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" xread block \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" streams mystream yourstream $ $\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\")])]),a(\"h5\",{attrs:{id:\"创建消费者组\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#创建消费者组\"}},[s._v(\"#\")]),s._v(\" 创建消费者组\")]),s._v(\" \"),a(\"p\",[a(\"code\",[s._v(\"xread\")]),s._v(\" 虽然可以扇形分发到 N 个客户端，然而，在某些问题中，我们想要做的不是向许多客户端提供相同的消息流，而是从同一流向许多客户端提供不同的消息子集。比如下图这样，三个消费者按轮训的方式去消费一个 Stream。\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://tva1.sinaimg.cn/large/0081Kckwly1gmdro3lr69j31t60u0ttn.jpg\",alt:\"redis-stream-cg\"}})]),s._v(\" \"),a(\"p\",[s._v(\"Redis Stream 借鉴了很多 Kafka 的设计。\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[a(\"strong\",[s._v(\"Consumer Group\")]),s._v(\"：有了消费组的概念，每个消费组状态独立，互不影响，一个消费组可以有多个消费者\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[s._v(\"last_delivered_id\")]),s._v(\" ：每个消费组会有个游标 last_delivered_id 在数组之上往前移动，表示当前消费组已经消费到哪条消息了\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[s._v(\"pending_ids\")]),s._v(\" ：消费者的状态变量，作用是维护消费者的未确认的 id。 pending_ids 记录了当前已经被客户端读取的消息，但是还没有 ack。如果客户端没有 ack，这个变量里面的消息 ID 会越来越多，一旦某个消息被 ack，它就开始减少。这个 pending_ids 变量在 Redis 官方被称之为 \"),a(\"code\",[s._v(\"PEL\")]),s._v(\"，也就是 \"),a(\"code\",[s._v(\"Pending Entries List\")]),s._v(\"，这是一个很核心的数据结构，它用来确保客户端至少消费了消息一次，而不会在网络传输的中途丢失了没处理。\")])])]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/Jstarfish/picBed/redis/redis-group-strucure.png\",alt:\"redis-group-strucure\"}})]),s._v(\" \"),a(\"p\",[s._v(\"Stream 不像 Kafak 那样有分区的概念，如果想实现类似分区的功能，就要在客户端使用一定的策略将消息写到不同的 Stream。\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"code\",[s._v(\"xgroup create\")]),s._v(\"：创建消费者组\")]),s._v(\" \"),a(\"li\",[a(\"code\",[s._v(\"xgreadgroup\")]),s._v(\"：读取消费组中的消息\")]),s._v(\" \"),a(\"li\",[a(\"code\",[s._v(\"xack\")]),s._v(\"：ack 掉指定消息\")])]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/Jstarfish/picBed/redis/redis-cg-commands%20(1).jpg\",alt:\"\"}})]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 创建消费者组的时候必须指定 ID, ID 为 0 表示从头开始消费，为 $ 表示只消费新的消息，也可以自己指定\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xgroup create mystream mygroup $\\nOK\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 查看流和消费者组的相关信息，可以查看流、也可以单独查看流下的某个组的信息\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xinfo stream mystream\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"length\"')]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 共 4 个消息\")]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"radix-tree-keys\"')]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"radix-tree-nodes\"')]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"last-generated-id\"')]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609408943089-0\"')]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"groups\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 一个消费组\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"11\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"first-entry\"')]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 第一个消息\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"12\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609405178536-0\"')]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f5\"')]),s._v(\"\\n       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v5\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"13\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"last-entry\"')]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 最后一个消息\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"14\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609408943089-0\"')]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f6\"')]),s._v(\"\\n       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v6\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" \\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),a(\"br\")])]),a(\"h5\",{attrs:{id:\"按消费组消费\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#按消费组消费\"}},[s._v(\"#\")]),s._v(\" 按消费组消费\")]),s._v(\" \"),a(\"p\",[s._v(\"Stream 提供了 \"),a(\"code\",[s._v(\"xreadgroup\")]),s._v(\" 指令可以进行消费组的组内消费，需要提供消费组名称、消费者名称和起始消息 ID。它同 \"),a(\"code\",[s._v(\"xread\")]),s._v(\" 一样，也可以阻塞等待新消息。读到新消息后，对应的消息 ID 就会进入消费者的 PEL(正在处理的消息) 结构里，客户端处理完毕后使用 \"),a(\"code\",[s._v(\"xack\")]),s._v(\" 指令通知服务器，本条消息已经处理完毕，该消息 ID 就会从 PEL 中移除。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#  消费组 mygroup1 中的 消费者 c1 从 mystream 中 消费组数据\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# > 号表示从当前消费组的 last_delivered_id 后面开始读\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 每当消费者读取一条消息，last_delivered_id 变量就会前进\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xreadgroup group mygroup1 c1 count \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" streams mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mystream\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609727806627-0\"')]),s._v(\"\\n         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f1\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v1\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f2\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v2\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f3\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v3\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xreadgroup group mygroup1 c1 count \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" streams mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mystream\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609727818650-0\"')]),s._v(\"\\n         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f4\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v4\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 已经没有消息可读了            \")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xreadgroup group mygroup1 c1 count \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\" streams mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"nil\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 还可以阻塞式的消费\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xreadgroup group mygroup1 c2 block \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" streams mystream \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nµ1\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mystream\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609728270632-0\"')]),s._v(\"\\n         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"f5\"')]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v5\"')]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"89\")]),s._v(\".36s\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 观察消费组信息\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xinfo \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"groups\")]),s._v(\" mystream\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mygroup1\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"consumers\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 2个消费者\")]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"pending\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 共 3 条正在处理的信息还没有 ack\")]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"last-delivered-id\"')]),s._v(\"\\n   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"1609728270632-0\"')]),s._v(\"\\n   \\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" xack mystream mygroup1 \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1609727806627\")]),s._v(\"-0  \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# ack掉指定消息\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"integer\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"40\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"41\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"42\")]),a(\"br\")])]),a(\"p\",[s._v(\"尝鲜到此结束，就不继续深入了。\")]),s._v(\" \"),a(\"p\",[s._v(\"个人感觉，就目前来说，Stream 还是不能当做主流的 MQ 来使用的，而且使用案例也比较少，慎用。\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"写在最后\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#写在最后\"}},[s._v(\"#\")]),s._v(\" 写在最后\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[s._v(\"当然，还有需要注意的就是，业务上避免过度复用一个 Redis。既用它做缓存、做计算，还拿它做任务队列，这样的话 Redis 会很累的。\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"没有绝对好的技术、只有对业务最友好的技术，共勉\")])])]),s._v(\" \"),a(\"blockquote\",[a(\"p\",[s._v(\"以梦为马，越骑越傻。诗和远方，越走越慌。不忘初心是对的，但切记要出发，加油吧，程序员。\")])]),s._v(\" \"),a(\"blockquote\",[a(\"p\",[s._v(\"在路上的你，可以微信搜「 \"),a(\"strong\",[s._v(\"JavaKeeper\")]),s._v(\" 」一起前行，无套路领取 500+ 本电子书和 30+ 视频教学和源码，本文 \"),a(\"strong\",[s._v(\"GitHub\")]),s._v(\" \"),a(\"a\",{attrs:{href:\"https://github.com/Jstarfish/JavaKeeper\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"github.com/JavaKeeper)\"),a(\"OutboundLink\")],1),s._v(\"已经收录，服务端开发、面试必备技能兵器谱，有你想要的！\")])]),s._v(\" \"),a(\"h2\",{attrs:{id:\"参考\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考\"}},[s._v(\"#\")]),s._v(\" 参考\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[a(\"a\",{attrs:{href:\"https://redisbook.readthedocs.io/en/latest/feature/pubsub.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\" 《Redis 设计与实现》\"),a(\"OutboundLink\")],1)])]),s._v(\" \"),a(\"li\",[a(\"p\",[a(\"a\",{attrs:{href:\"https://redis.io/topics/pubsub\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"Redis 官网\"),a(\"OutboundLink\")],1)])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"https://segmentfault.com/a/1190000012244418\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"https://www.cnblogs.com/williamjie/p/11201654.html\")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);","extractedComments":[]}
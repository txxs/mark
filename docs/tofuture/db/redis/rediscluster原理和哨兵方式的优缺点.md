原文地址：https://juejin.im/post/5d3e39e751882544df24a39b

redis cluster是亲生的集群方案，目前，在高可用和稳定性方面，都有了很大的进步。据统计和观察，采用redis cluster架构的公司和社区越来越多，已经成为事实的标准。它的主要特点就是去中心化，无需proxy代理。其中一个主要设计目标就是达到线性可扩展性（linear scalability）。**分布式存储无非就是处理分片和副本**。 对redis cluster来说，核心概念就是槽（slot），了解了它，基本就了解了集群的管理方式。

### 优点：
- 1、不再需要额外的Sentinel集群，为使用者提供了一致的方案，减少了学习成本。
- 2、去中心架构，节点对等，集群可支持上千个节点。
- 3、抽象出了slot概念，针对slot进行运维操作。
- 4、副本功能能够实现自动故障转移，大部分情况下无需人工介入。

### 缺点：
- 1、客户端要缓存部分数据，实现Cluster协议，相对复杂。
- 2、数据是通过异步复制的，不能保证数据的强一致性。
- 3、资源隔离困难，经常流量不均衡，尤其是多个业务共用集群的时候。数据不知道在哪里，针对热点数据，也无法通过专项优化完成。
- 4、从库是完全的冷备，无法分担读操作，真是太太浪费了。需要做额外工作。
- 5、MultiOp和Pipeline支持有限，老代码要是进行架构升级，要小心了。
- 6、数据迁移是基于key而不是基于slot的，过程较慢。

### 基本原理

从槽到key，定位过程明显就是一个双层的路由。redis cluster和常用的一致性hash没什么关系，它主要采用了哈希槽的概念。当需要在其中存取一个key时，redis客户端会首先对这个key采用crc16算法算出一个值，然后对这个值进行mod操作。每个key都会落在其中的一个hash槽上，不管下边redis怎么变，都是哈希到固定的slot上去。这个数组的长度为 16384/8=2048 Byte，那么就可以使用0或者1来标识本节点对某个槽是否拥有。当数据库中的16384个槽都有节点在处理时，集群处于上线状态（ok）；相反地，如果数据库中有任何一个槽没有得到处理，那么集群处于下线状态（fail）。当客户端向节点发送相关命令时，接收命令的节点会计算出命令要处理的key属于哪个槽，并检查这个槽是否指派给了自己。如果不是自己的，会指引客户端到正确的节点。


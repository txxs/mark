<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mark</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/mark/mlogo.svg">
    <link rel="manifest" href="/mark/manifest.json">
    <meta name="description" content="本博客主要是用来记录系统化的知识，内容部分来自github上的其他开源仓库，如有问题联系sdlyjhm01@sina.com">
    
    <link rel="preload" href="/mark/assets/css/0.styles.06a758ea.css" as="style"><link rel="preload" href="/mark/assets/js/app.0aea0d93.js" as="script"><link rel="preload" href="/mark/assets/js/2.9796e7dc.js" as="script"><link rel="preload" href="/mark/assets/js/214.486d9eaa.js" as="script"><link rel="preload" href="/mark/assets/js/4.70c6b853.js" as="script"><link rel="prefetch" href="/mark/assets/js/10.df3cf319.js"><link rel="prefetch" href="/mark/assets/js/100.153c6b63.js"><link rel="prefetch" href="/mark/assets/js/101.789f3dc5.js"><link rel="prefetch" href="/mark/assets/js/102.389ce7d5.js"><link rel="prefetch" href="/mark/assets/js/103.21d2a49f.js"><link rel="prefetch" href="/mark/assets/js/104.fa4d8cec.js"><link rel="prefetch" href="/mark/assets/js/105.17b344cf.js"><link rel="prefetch" href="/mark/assets/js/106.fa110d7c.js"><link rel="prefetch" href="/mark/assets/js/107.18ced5d2.js"><link rel="prefetch" href="/mark/assets/js/108.8c423eb7.js"><link rel="prefetch" href="/mark/assets/js/109.a6ecdae7.js"><link rel="prefetch" href="/mark/assets/js/11.546876c1.js"><link rel="prefetch" href="/mark/assets/js/110.96899885.js"><link rel="prefetch" href="/mark/assets/js/111.47d8b3d7.js"><link rel="prefetch" href="/mark/assets/js/112.b8b924e6.js"><link rel="prefetch" href="/mark/assets/js/113.61c8208a.js"><link rel="prefetch" href="/mark/assets/js/114.a291ede8.js"><link rel="prefetch" href="/mark/assets/js/115.dc73def9.js"><link rel="prefetch" href="/mark/assets/js/116.f9a6b1fd.js"><link rel="prefetch" href="/mark/assets/js/117.089d1d20.js"><link rel="prefetch" href="/mark/assets/js/118.11aa1e54.js"><link rel="prefetch" href="/mark/assets/js/119.f13d888c.js"><link rel="prefetch" href="/mark/assets/js/12.741fde36.js"><link rel="prefetch" href="/mark/assets/js/120.9b7d7491.js"><link rel="prefetch" href="/mark/assets/js/121.632837f8.js"><link rel="prefetch" href="/mark/assets/js/122.8aa410d6.js"><link rel="prefetch" href="/mark/assets/js/123.6fb7df23.js"><link rel="prefetch" href="/mark/assets/js/124.9a70b373.js"><link rel="prefetch" href="/mark/assets/js/125.577690e5.js"><link rel="prefetch" href="/mark/assets/js/126.a73df929.js"><link rel="prefetch" href="/mark/assets/js/127.6bc09867.js"><link rel="prefetch" href="/mark/assets/js/128.d536a7d0.js"><link rel="prefetch" href="/mark/assets/js/129.7caba0a2.js"><link rel="prefetch" href="/mark/assets/js/13.ca3fb9d7.js"><link rel="prefetch" href="/mark/assets/js/130.b96a021e.js"><link rel="prefetch" href="/mark/assets/js/131.cceee9e2.js"><link rel="prefetch" href="/mark/assets/js/132.f16fd5fb.js"><link rel="prefetch" href="/mark/assets/js/133.e836d7ac.js"><link rel="prefetch" href="/mark/assets/js/134.93c285e0.js"><link rel="prefetch" href="/mark/assets/js/135.f000f0bb.js"><link rel="prefetch" href="/mark/assets/js/136.f30668ff.js"><link rel="prefetch" href="/mark/assets/js/137.be281b94.js"><link rel="prefetch" href="/mark/assets/js/138.9f19a9d5.js"><link rel="prefetch" href="/mark/assets/js/139.fcb6a986.js"><link rel="prefetch" href="/mark/assets/js/14.fac6fd4f.js"><link rel="prefetch" href="/mark/assets/js/140.2d6f1457.js"><link rel="prefetch" href="/mark/assets/js/141.93df91d8.js"><link rel="prefetch" href="/mark/assets/js/142.d64311bc.js"><link rel="prefetch" href="/mark/assets/js/143.5b78829e.js"><link rel="prefetch" href="/mark/assets/js/144.4c4816a2.js"><link rel="prefetch" href="/mark/assets/js/145.79841a51.js"><link rel="prefetch" href="/mark/assets/js/146.1fc2cd42.js"><link rel="prefetch" href="/mark/assets/js/147.07873326.js"><link rel="prefetch" href="/mark/assets/js/148.9996b3e4.js"><link rel="prefetch" href="/mark/assets/js/149.55ddabca.js"><link rel="prefetch" href="/mark/assets/js/15.b668abe7.js"><link rel="prefetch" href="/mark/assets/js/150.dab4ede8.js"><link rel="prefetch" href="/mark/assets/js/151.96c562cb.js"><link rel="prefetch" href="/mark/assets/js/152.0fdf4cc6.js"><link rel="prefetch" href="/mark/assets/js/153.b79e6a8b.js"><link rel="prefetch" href="/mark/assets/js/154.97779b76.js"><link rel="prefetch" href="/mark/assets/js/155.55cc46ad.js"><link rel="prefetch" href="/mark/assets/js/156.a8cfb429.js"><link rel="prefetch" href="/mark/assets/js/157.daa1bd59.js"><link rel="prefetch" href="/mark/assets/js/158.4c0f43bb.js"><link rel="prefetch" href="/mark/assets/js/159.c4ed63f7.js"><link rel="prefetch" href="/mark/assets/js/16.44e71218.js"><link rel="prefetch" href="/mark/assets/js/160.83e77120.js"><link rel="prefetch" href="/mark/assets/js/161.78228eb1.js"><link rel="prefetch" href="/mark/assets/js/162.adce8a63.js"><link rel="prefetch" href="/mark/assets/js/163.7ff2e22e.js"><link rel="prefetch" href="/mark/assets/js/164.c3eab7af.js"><link rel="prefetch" href="/mark/assets/js/165.2c3fb0f1.js"><link rel="prefetch" href="/mark/assets/js/166.343114d4.js"><link rel="prefetch" href="/mark/assets/js/167.9f6db258.js"><link rel="prefetch" href="/mark/assets/js/168.834fd68e.js"><link rel="prefetch" href="/mark/assets/js/169.11e13f73.js"><link rel="prefetch" href="/mark/assets/js/17.aa02a9aa.js"><link rel="prefetch" href="/mark/assets/js/170.7cab0e00.js"><link rel="prefetch" href="/mark/assets/js/171.203b2c5c.js"><link rel="prefetch" href="/mark/assets/js/172.7d76b968.js"><link rel="prefetch" href="/mark/assets/js/173.66619bd6.js"><link rel="prefetch" href="/mark/assets/js/174.4c1d9d38.js"><link rel="prefetch" href="/mark/assets/js/175.3498f184.js"><link rel="prefetch" href="/mark/assets/js/176.09d0c241.js"><link rel="prefetch" href="/mark/assets/js/177.1c815a5b.js"><link rel="prefetch" href="/mark/assets/js/178.6d39c03e.js"><link rel="prefetch" href="/mark/assets/js/179.2da0dc6d.js"><link rel="prefetch" href="/mark/assets/js/18.853ba918.js"><link rel="prefetch" href="/mark/assets/js/180.0bf90d52.js"><link rel="prefetch" href="/mark/assets/js/181.16a8c25f.js"><link rel="prefetch" href="/mark/assets/js/182.ab450f09.js"><link rel="prefetch" href="/mark/assets/js/183.4605186c.js"><link rel="prefetch" href="/mark/assets/js/184.3fd167bb.js"><link rel="prefetch" href="/mark/assets/js/185.a27fddf8.js"><link rel="prefetch" href="/mark/assets/js/186.f346e584.js"><link rel="prefetch" href="/mark/assets/js/187.3fe583d0.js"><link rel="prefetch" href="/mark/assets/js/188.6a727288.js"><link rel="prefetch" href="/mark/assets/js/189.b8753c71.js"><link rel="prefetch" href="/mark/assets/js/19.b6645eb5.js"><link rel="prefetch" href="/mark/assets/js/190.c37c0c58.js"><link rel="prefetch" href="/mark/assets/js/191.6d321c97.js"><link rel="prefetch" href="/mark/assets/js/192.5dc26a17.js"><link rel="prefetch" href="/mark/assets/js/193.82cafb33.js"><link rel="prefetch" href="/mark/assets/js/194.bcc3b6ac.js"><link rel="prefetch" href="/mark/assets/js/195.7b0e55bd.js"><link rel="prefetch" href="/mark/assets/js/196.a46abcca.js"><link rel="prefetch" href="/mark/assets/js/197.60ed2939.js"><link rel="prefetch" href="/mark/assets/js/198.328d5a76.js"><link rel="prefetch" href="/mark/assets/js/199.e08acaf4.js"><link rel="prefetch" href="/mark/assets/js/20.4f331f61.js"><link rel="prefetch" href="/mark/assets/js/200.b8bf4db0.js"><link rel="prefetch" href="/mark/assets/js/201.be29f7a2.js"><link rel="prefetch" href="/mark/assets/js/202.72b1e094.js"><link rel="prefetch" href="/mark/assets/js/203.cb278cbf.js"><link rel="prefetch" href="/mark/assets/js/204.5289facc.js"><link rel="prefetch" href="/mark/assets/js/205.946877ea.js"><link rel="prefetch" href="/mark/assets/js/206.da0a11a3.js"><link rel="prefetch" href="/mark/assets/js/207.9eb4891a.js"><link rel="prefetch" href="/mark/assets/js/208.4e4538dc.js"><link rel="prefetch" href="/mark/assets/js/209.c6219bc8.js"><link rel="prefetch" href="/mark/assets/js/21.47861e33.js"><link rel="prefetch" href="/mark/assets/js/210.28b46949.js"><link rel="prefetch" href="/mark/assets/js/211.050ecc31.js"><link rel="prefetch" href="/mark/assets/js/212.89dc24eb.js"><link rel="prefetch" href="/mark/assets/js/213.627cf6d2.js"><link rel="prefetch" href="/mark/assets/js/215.b3f08353.js"><link rel="prefetch" href="/mark/assets/js/216.194c265b.js"><link rel="prefetch" href="/mark/assets/js/217.339c13d4.js"><link rel="prefetch" href="/mark/assets/js/218.a9e8e150.js"><link rel="prefetch" href="/mark/assets/js/219.4595de1c.js"><link rel="prefetch" href="/mark/assets/js/22.c1d496c9.js"><link rel="prefetch" href="/mark/assets/js/220.55484b34.js"><link rel="prefetch" href="/mark/assets/js/221.1144668a.js"><link rel="prefetch" href="/mark/assets/js/222.bb9d84f8.js"><link rel="prefetch" href="/mark/assets/js/223.f578c014.js"><link rel="prefetch" href="/mark/assets/js/224.65514ef7.js"><link rel="prefetch" href="/mark/assets/js/225.da50f6d7.js"><link rel="prefetch" href="/mark/assets/js/226.96f4cb4d.js"><link rel="prefetch" href="/mark/assets/js/227.50eb7c64.js"><link rel="prefetch" href="/mark/assets/js/228.cd74cdab.js"><link rel="prefetch" href="/mark/assets/js/229.08dbfe78.js"><link rel="prefetch" href="/mark/assets/js/23.db7b956e.js"><link rel="prefetch" href="/mark/assets/js/230.5d68f00a.js"><link rel="prefetch" href="/mark/assets/js/231.eab10621.js"><link rel="prefetch" href="/mark/assets/js/232.05c059e2.js"><link rel="prefetch" href="/mark/assets/js/233.cb776663.js"><link rel="prefetch" href="/mark/assets/js/234.bbc11dd5.js"><link rel="prefetch" href="/mark/assets/js/235.c4efbbc3.js"><link rel="prefetch" href="/mark/assets/js/236.6a22f217.js"><link rel="prefetch" href="/mark/assets/js/237.1a40837f.js"><link rel="prefetch" href="/mark/assets/js/238.92325903.js"><link rel="prefetch" href="/mark/assets/js/239.65aad4f0.js"><link rel="prefetch" href="/mark/assets/js/24.e7e41804.js"><link rel="prefetch" href="/mark/assets/js/240.7bdf2832.js"><link rel="prefetch" href="/mark/assets/js/241.49c723c1.js"><link rel="prefetch" href="/mark/assets/js/242.941f33c5.js"><link rel="prefetch" href="/mark/assets/js/243.c557c4e9.js"><link rel="prefetch" href="/mark/assets/js/244.f1f1a474.js"><link rel="prefetch" href="/mark/assets/js/245.fc65caec.js"><link rel="prefetch" href="/mark/assets/js/246.61008bb7.js"><link rel="prefetch" href="/mark/assets/js/247.9f05516d.js"><link rel="prefetch" href="/mark/assets/js/248.8eb9f553.js"><link rel="prefetch" href="/mark/assets/js/249.b1fbf121.js"><link rel="prefetch" href="/mark/assets/js/25.c3096003.js"><link rel="prefetch" href="/mark/assets/js/250.ee2057f9.js"><link rel="prefetch" href="/mark/assets/js/251.07e723e5.js"><link rel="prefetch" href="/mark/assets/js/252.68ff6cbb.js"><link rel="prefetch" href="/mark/assets/js/253.b625cca4.js"><link rel="prefetch" href="/mark/assets/js/254.8941ce7a.js"><link rel="prefetch" href="/mark/assets/js/255.d4a316d4.js"><link rel="prefetch" href="/mark/assets/js/256.c0de3cda.js"><link rel="prefetch" href="/mark/assets/js/257.d8139590.js"><link rel="prefetch" href="/mark/assets/js/258.182b22bf.js"><link rel="prefetch" href="/mark/assets/js/259.07c14f8b.js"><link rel="prefetch" href="/mark/assets/js/26.e31c1b71.js"><link rel="prefetch" href="/mark/assets/js/260.4787cd7a.js"><link rel="prefetch" href="/mark/assets/js/261.430b5f66.js"><link rel="prefetch" href="/mark/assets/js/262.c09d2caf.js"><link rel="prefetch" href="/mark/assets/js/263.eed48bff.js"><link rel="prefetch" href="/mark/assets/js/264.dbdddf86.js"><link rel="prefetch" href="/mark/assets/js/265.b1fed4a3.js"><link rel="prefetch" href="/mark/assets/js/266.3a38458a.js"><link rel="prefetch" href="/mark/assets/js/267.a91c4a5f.js"><link rel="prefetch" href="/mark/assets/js/268.79fc101d.js"><link rel="prefetch" href="/mark/assets/js/269.3cede94b.js"><link rel="prefetch" href="/mark/assets/js/27.f63cdc60.js"><link rel="prefetch" href="/mark/assets/js/270.d123bdb4.js"><link rel="prefetch" href="/mark/assets/js/271.d5dd8bac.js"><link rel="prefetch" href="/mark/assets/js/272.2840a815.js"><link rel="prefetch" href="/mark/assets/js/273.f4365937.js"><link rel="prefetch" href="/mark/assets/js/274.e62b4866.js"><link rel="prefetch" href="/mark/assets/js/275.371a5248.js"><link rel="prefetch" href="/mark/assets/js/276.5dfdd341.js"><link rel="prefetch" href="/mark/assets/js/277.1a6f6821.js"><link rel="prefetch" href="/mark/assets/js/278.23f55dac.js"><link rel="prefetch" href="/mark/assets/js/279.e2b8ff6c.js"><link rel="prefetch" href="/mark/assets/js/28.e4273a3d.js"><link rel="prefetch" href="/mark/assets/js/280.9b821466.js"><link rel="prefetch" href="/mark/assets/js/281.532af105.js"><link rel="prefetch" href="/mark/assets/js/282.c6a18938.js"><link rel="prefetch" href="/mark/assets/js/283.42cf3e72.js"><link rel="prefetch" href="/mark/assets/js/29.11cf275c.js"><link rel="prefetch" href="/mark/assets/js/3.d3cb6ecd.js"><link rel="prefetch" href="/mark/assets/js/30.2af544ab.js"><link rel="prefetch" href="/mark/assets/js/31.98f1a2af.js"><link rel="prefetch" href="/mark/assets/js/32.4c62810b.js"><link rel="prefetch" href="/mark/assets/js/33.fddffa17.js"><link rel="prefetch" href="/mark/assets/js/34.ea53abff.js"><link rel="prefetch" href="/mark/assets/js/35.26ecf795.js"><link rel="prefetch" href="/mark/assets/js/36.8156b993.js"><link rel="prefetch" href="/mark/assets/js/37.66e2a6fd.js"><link rel="prefetch" href="/mark/assets/js/38.805f3329.js"><link rel="prefetch" href="/mark/assets/js/39.c314f4f6.js"><link rel="prefetch" href="/mark/assets/js/40.843f3435.js"><link rel="prefetch" href="/mark/assets/js/41.f172bc1f.js"><link rel="prefetch" href="/mark/assets/js/42.1ffe2dfc.js"><link rel="prefetch" href="/mark/assets/js/43.494ff33e.js"><link rel="prefetch" href="/mark/assets/js/44.067ae635.js"><link rel="prefetch" href="/mark/assets/js/45.c1e3cae0.js"><link rel="prefetch" href="/mark/assets/js/46.32b783a4.js"><link rel="prefetch" href="/mark/assets/js/47.13bf2133.js"><link rel="prefetch" href="/mark/assets/js/48.c6c664aa.js"><link rel="prefetch" href="/mark/assets/js/49.50269c8a.js"><link rel="prefetch" href="/mark/assets/js/5.52acfc77.js"><link rel="prefetch" href="/mark/assets/js/50.b7c51e4d.js"><link rel="prefetch" href="/mark/assets/js/51.9ccde890.js"><link rel="prefetch" href="/mark/assets/js/52.727c66c2.js"><link rel="prefetch" href="/mark/assets/js/53.38c41b64.js"><link rel="prefetch" href="/mark/assets/js/54.c0d2ebd7.js"><link rel="prefetch" href="/mark/assets/js/55.1284913a.js"><link rel="prefetch" href="/mark/assets/js/56.ae880421.js"><link rel="prefetch" href="/mark/assets/js/57.4f73916d.js"><link rel="prefetch" href="/mark/assets/js/58.140c76ef.js"><link rel="prefetch" href="/mark/assets/js/59.d4e19796.js"><link rel="prefetch" href="/mark/assets/js/6.f05774e4.js"><link rel="prefetch" href="/mark/assets/js/60.43e99ed1.js"><link rel="prefetch" href="/mark/assets/js/61.f3edf3c6.js"><link rel="prefetch" href="/mark/assets/js/62.89042103.js"><link rel="prefetch" href="/mark/assets/js/63.b0a95371.js"><link rel="prefetch" href="/mark/assets/js/64.50593833.js"><link rel="prefetch" href="/mark/assets/js/65.f416c344.js"><link rel="prefetch" href="/mark/assets/js/66.c226c0cb.js"><link rel="prefetch" href="/mark/assets/js/67.362e0cc0.js"><link rel="prefetch" href="/mark/assets/js/68.bede1fd6.js"><link rel="prefetch" href="/mark/assets/js/69.26827342.js"><link rel="prefetch" href="/mark/assets/js/7.46392252.js"><link rel="prefetch" href="/mark/assets/js/70.0005ba58.js"><link rel="prefetch" href="/mark/assets/js/71.837fc208.js"><link rel="prefetch" href="/mark/assets/js/72.e86979bd.js"><link rel="prefetch" href="/mark/assets/js/73.cc305854.js"><link rel="prefetch" href="/mark/assets/js/74.f2460698.js"><link rel="prefetch" href="/mark/assets/js/75.75f69430.js"><link rel="prefetch" href="/mark/assets/js/76.94f7336c.js"><link rel="prefetch" href="/mark/assets/js/77.3763594e.js"><link rel="prefetch" href="/mark/assets/js/78.b7935c10.js"><link rel="prefetch" href="/mark/assets/js/79.0c3eec6c.js"><link rel="prefetch" href="/mark/assets/js/8.929c879f.js"><link rel="prefetch" href="/mark/assets/js/80.3ac4a553.js"><link rel="prefetch" href="/mark/assets/js/81.7b7f6307.js"><link rel="prefetch" href="/mark/assets/js/82.38f820f5.js"><link rel="prefetch" href="/mark/assets/js/83.308d26e6.js"><link rel="prefetch" href="/mark/assets/js/84.93111332.js"><link rel="prefetch" href="/mark/assets/js/85.95757c0b.js"><link rel="prefetch" href="/mark/assets/js/86.87cc60ea.js"><link rel="prefetch" href="/mark/assets/js/87.c440b0c2.js"><link rel="prefetch" href="/mark/assets/js/88.a81ba93f.js"><link rel="prefetch" href="/mark/assets/js/89.9202901b.js"><link rel="prefetch" href="/mark/assets/js/9.9d4021a1.js"><link rel="prefetch" href="/mark/assets/js/90.39e4d1f5.js"><link rel="prefetch" href="/mark/assets/js/91.a2157163.js"><link rel="prefetch" href="/mark/assets/js/92.2d9ede3b.js"><link rel="prefetch" href="/mark/assets/js/93.557ab653.js"><link rel="prefetch" href="/mark/assets/js/94.d2cb0331.js"><link rel="prefetch" href="/mark/assets/js/95.614d2a8e.js"><link rel="prefetch" href="/mark/assets/js/96.38236ad9.js"><link rel="prefetch" href="/mark/assets/js/97.2c8caa3b.js"><link rel="prefetch" href="/mark/assets/js/98.b6708259.js"><link rel="prefetch" href="/mark/assets/js/99.07ab6ab2.js">
    <link rel="stylesheet" href="/mark/assets/css/0.styles.06a758ea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mark/" class="home-link router-link-active"><img src="/mark/mlogo.svg" alt="Mark" class="logo"> <span class="site-name can-hide">Mark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link router-link-active">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link">
  突击
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/key/" class="nav-link">
  key
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/txxs/mark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link router-link-active">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link">
  突击
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/key/" class="nav-link">
  key
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/txxs/mark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mark/q&amp;a/interview/Collections-FAQ.html" class="sidebar-link">「直击面试」—— Java 集合，你肯定也会被问到这些</a></li><li><a href="/mark/q&amp;a/interview/Design-Pattern-FAQ.html" class="sidebar-link">/q&amp;a/interview/Design-Pattern-FAQ.html</a></li><li><a href="/mark/q&amp;a/interview/Elasticsearch-FAQ.html" class="sidebar-link">/q&amp;a/interview/Elasticsearch-FAQ.html</a></li><li><a href="/mark/q&amp;a/interview/GC-FAQ.html" aria-current="page" class="active sidebar-link">/q&amp;a/interview/GC-FAQ.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#jvm-运行时内存布局" class="sidebar-link">JVM 运行时内存布局</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-1-jvm-运行时内存布局分为哪些区域-它们之间又是怎样的关系" class="sidebar-link">Question 1：JVM 运行时内存布局分为哪些区域？它们之间又是怎样的关系？</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-2-哪些区域会产生-oom" class="sidebar-link">Question 2：哪些区域会产生 OOM？</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-3-总体来看-jvm-把内存划分为-栈-stack-与-堆-heap-两大类-为何要这样设计" class="sidebar-link">Question 3：总体来看，JVM 把内存划分为“栈(stack)”与“堆(heap)”两大类，为何要这样设计？</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-4-如果-a-引用-b-b-又引用-a-发生了循环引用问题-这-2-个对象是否能被-gc回收" class="sidebar-link">Question 4：如果 A 引用 B，B 又引用 A（发生了循环引用问题），这 2 个对象是否能被 GC回收？</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-5-说一说常用的-gc-算法及其优缺点" class="sidebar-link">Question 5：说一说常用的 GC 算法及其优缺点</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-6-请以-hotspot-为例-分析一下-gc-全过程-并指出其中-gc-算法的综合运用-。" class="sidebar-link">Question 6：请以 Hotspot 为例，分析一下 GC 全过程（并指出其中 GC 算法的综合运用）。</a></li></ul></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#_8-种垃圾回收器" class="sidebar-link">8 种垃圾回收器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-7-cms-收集器工作的整个流程主要分为哪几个阶段" class="sidebar-link">Question 7：CMS 收集器工作的整个流程主要分为哪几个阶段？</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-8-g1-垃圾收集器的原理是什么" class="sidebar-link">Question 8：G1 垃圾收集器的原理是什么？</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-9-g1-垃圾收集器的运行过程-分为哪几个阶段" class="sidebar-link">Question 9：G1 垃圾收集器的运行过程，分为哪几个阶段？</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/interview/GC-FAQ.html#question-10-zgc-在-g1-基础上做了哪些改进" class="sidebar-link">Question 10：ZGC 在 G1 基础上做了哪些改进？</a></li></ul></li></ul></li><li><a href="/mark/q&amp;a/interview/Java-Basics-FAQ.html" class="sidebar-link">JDK和JRE、 JVM</a></li><li><a href="/mark/q&amp;a/interview/JUC-FAQ.html" class="sidebar-link">/q&amp;a/interview/JUC-FAQ.html</a></li><li><a href="/mark/q&amp;a/interview/JVM-FAQ.html" class="sidebar-link">/q&amp;a/interview/JVM-FAQ.html</a></li><li><a href="/mark/q&amp;a/interview/Kafka-FAQ.html" class="sidebar-link">/q&amp;a/interview/Kafka-FAQ.html</a></li><li><a href="/mark/q&amp;a/interview/MyBatis-FAQ.html" class="sidebar-link">/q&amp;a/interview/MyBatis-FAQ.html</a></li><li><a href="/mark/q&amp;a/interview/MySQL-FAQ.html" class="sidebar-link">MySQL 三万字精华总结 + 面试100 问，和面试官扯皮绰绰有余</a></li><li><a href="/mark/q&amp;a/interview/Network-FAQ.html" class="sidebar-link">/q&amp;a/interview/Network-FAQ.html</a></li><li><a href="/mark/q&amp;a/interview/networks-interview.html" class="sidebar-link">计算机网络面试突击</a></li><li><a href="/mark/q&amp;a/interview/Redis-FAQ.html" class="sidebar-link">一、Redis 基础问题</a></li><li><a href="/mark/q&amp;a/interview/Spring-FAQ.html" class="sidebar-link">Spring 面试集</a></li><li><a href="/mark/q&amp;a/interview/SpringBoot-FAQ.html" class="sidebar-link">概述</a></li><li><a href="/mark/q&amp;a/interview/Tomcat-FAQ.html" class="sidebar-link">Tomcat简介</a></li><li><a href="/mark/q&amp;a/interview/ZooKeeper-FAQ.html" class="sidebar-link">谈下你对 Zookeeper 的认识？</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>《面试必备：GC 垃圾回收十大考点及图文详解》</p></blockquote> <p>Java 发展历史上出现过很多垃圾回收器，各有各的适应场景，很多网上的旧内容已经跟不上最新的变化。而且“Java 的内存布局以及 GC 原理”又是 Java 开发人员绕不开的话题，更是面试中常见的高频问题之一。</p> <p>我们将详细介绍 Java 的内存布局，以及各种 GC 原理。这也就包括了经典面试考点：垃圾判断法、4 种 GC 算法、8 种垃圾回收器原理等内容。其中分代收集算法、ZGC 收集器我将重点介绍，最后会再加以实战，带你进行垃圾回收器练习。</p> <p>学习之前，你可以看看以下十大考点，你是否能清晰作答？</p> <p>Question 1：JVM 运行时内存布局分为哪些区域？它们之间又是怎样的关系？
Question 2：JVM 内存布局中，哪些区域会产生 OOM？
Question 3：总体看 JVM 把内存划分为“栈(stack)”与“堆(heap)”两大类，为何要这样设计？
Question 4：如果 A 引用 B，B 又引用 A（发生了循环引用问题），这 2 个对象是否能被 GC回收？
Question 5：说一说常用的 GC 算法及其优缺点
Question 6：请以 Hotspot 为例，分析一下 GC 全过程（并指出其中 GC 算法的综合运用）。
Question 7：CMS 收集器工作的整个流程主要分为哪几个阶段？
Question 8：G1 垃圾收集器的原理是什么？
Question 9：G1 垃圾收集器的运行过程，分为哪几个阶段？
Question 10：ZGC 在 G1 基础上做了哪些改进？</p> <p>希望学习后，你能对这方面的知识不再陌生，有所收获。</p> <h2 id="jvm-运行时内存布局"><a href="#jvm-运行时内存布局" class="header-anchor">#</a> JVM 运行时内存布局</h2> <h3 id="question-1-jvm-运行时内存布局分为哪些区域-它们之间又是怎样的关系"><a href="#question-1-jvm-运行时内存布局分为哪些区域-它们之间又是怎样的关系" class="header-anchor">#</a> Question 1：JVM 运行时内存布局分为哪些区域？它们之间又是怎样的关系？</h3> <p>按 Java 8 <a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5" target="_blank" rel="noopener noreferrer">虚拟机规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的原始表达：(jvm)Run-Time Data Areas，暂时翻译为“jvm 运行时内存布局”。从概念上大致分为以下 6 个（逻辑）区域，参考下图。</p> <blockquote><p>注：Method Area 中还有一个常量池区，图中未明确标出，所以图中就是 5 个区域。</p></blockquote> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/29/Cgp9HWEsoWmAcdmIAAFBWAdWemc383.png" alt="1.png"></p> <p>这 6 块区域按是否被线程共享，可以分为两大类：一类是每个线程所独享的（下图绿色部分），另一类是所有线程共享的（下图非绿色部分）。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/26/Cgp9HWEsl86AWeQWAAArQmSxWbY367.jpg" alt="2.jpg"></p> <p><strong>分类一：是每个线程所独享的</strong></p> <ol><li><p>PC Register：也称为程序计数器， 记录每个线程当前执行的指令信。eg：当前执行到哪一条指令，下一条该取哪条指令。</p></li> <li><p>JVM Stack：也称为虚拟机栈，记录每个栈帧（Frame）中的局部变量、方法返回地址等。注：这里出现了一个新名词“栈帧”，它的结构如下。</p> <blockquote><p>线程中每次有方法调用时，会创建 Frame，方法调用结束时 Frame 销毁。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/27/Cgp9HWEsmFmAQdtCAAAb3P-d7ws695.jpg" alt="3.jpg"></p></blockquote></li> <li><p>Native Method Stack：本地（原生）方法栈，顾名思义就是调用操作系统原生本地方法时，所需要的内存区域。</p></li></ol> <p>上述 3 类区域，生命周期与 Thread 相同，即：</p> <p>线程创建时，相应的区域分配内存；</p> <p>线程销毁时，释放相应内存。</p> <p><strong>分类二：是所有线程共享的</strong></p> <ol><li><p>Heap：即鼎鼎大名的堆内存区，也是 GC 垃圾回收的主站场，用于存放类的实例对象及 Arrays 实例等。
（注：Heap 被所有线程共享，严格来说并不严谨。事实上，由于 TLAB 的存在，为了防止并发对象分配时，多个对象分配到同一块内存。heap 中的 TLAB 区域，在分配时，是被线程独占写入的。）</p></li> <li><p>Method Area：方法区，主要存放类结构、类成员定义、static 静态成员等。</p></li> <li><p>Runtime Constant Pool：运行时常量池，比如字符串、int -128~127 范围的值等，它是 Method Area 中的一部分。</p></li></ol> <blockquote><p>Heap、Method Area 都是在虚拟机启动时创建，虚拟机退出时释放。</p></blockquote> <p>注：Method Area 区，虚拟机规范只是说必须要有，但是具体怎么实现（比如是否需要垃圾回收），交给具体的 JVM 实现去决定。逻辑上讲，它可视为 Heap 区的一部分，所以如果你看见类似下面的图，也不要觉得画错了。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2F/CioPOWEsmOWAdpluAAA5IldyRXs168.jpg" alt="4.jpg"></p> <h3 id="question-2-哪些区域会产生-oom"><a href="#question-2-哪些区域会产生-oom" class="header-anchor">#</a> Question 2：哪些区域会产生 OOM？</h3> <p>上述 6 个区域，除了 PC Register 区不会抛出 StackOverflowError 或 OutOfMemoryError，其它 5 个区域，当请求分配的内存不足时，均会抛出 OutOfMemoryError（即：OOM），其中 thread 独立的 JVM Stack 区及 Native Method Stack 区还会抛出 StackOverflowError。</p> <p><strong>【堆外内存与堆内存】</strong></p> <p>最后，还有一类不受 JVM 虚拟机管控的内存区，这里也提一下，即堆外内存。可以通过 Unsafe 和 NIO 包下的 DirectByteBuffer 来操作堆外内存。如下图，虽然堆外内存不受 JVM 管控，但是堆内存中会持有对它的引用，以便进行 GC。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/2F/CioPOWEsmWmAEapzAAALMHafOd4507.jpg" alt="5.jpg"></p> <h3 id="question-3-总体来看-jvm-把内存划分为-栈-stack-与-堆-heap-两大类-为何要这样设计"><a href="#question-3-总体来看-jvm-把内存划分为-栈-stack-与-堆-heap-两大类-为何要这样设计" class="header-anchor">#</a> Question 3：总体来看，JVM 把内存划分为“栈(stack)”与“堆(heap)”两大类，为何要这样设计？</h3> <p>个人理解，程序运行时，内存中的信息大致分为两类：</p> <p>跟程序执行逻辑相关的指令数据，这类数据通常不大，而且生命周期短；</p> <p>跟对象实例相关的数据，这类数据可能会很大，而且可以被多个线程长时间内反复共用，比如字符串常量、缓存对象这类。</p> <p>将这两类特点不同的数据分开管理，体现了软件设计上“模块隔离”的思想。好比我们通常会把后端 service 与前端 website 解耦类似，也更便于内存管理。</p> <h4 id="gc-垃圾回收原理"><a href="#gc-垃圾回收原理" class="header-anchor">#</a> GC 垃圾回收原理</h4> <h5 id="_1-如何判断对象是垃圾"><a href="#_1-如何判断对象是垃圾" class="header-anchor">#</a> 1.如何判断对象是垃圾？</h5> <p><strong>经典判断方法 1：引用计数法</strong></p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/27/Cgp9HWEsmeyANNc7AAA9QBsPYME826.jpg" alt="6.jpg"></p> <p>思路很简单，但是如果出现循环引用，即 A 引用 B，B 又引用 A，这种情况下就不好办了。所以 JVM 中使用了另一种称为“可达性分析”的判断方法。</p> <p><strong>经典判断方法 2：可达性分析</strong></p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/27/Cgp9HWEsmfyAEgFaAABA5PRUFiU013.jpg" alt="7.jpg"></p> <h3 id="question-4-如果-a-引用-b-b-又引用-a-发生了循环引用问题-这-2-个对象是否能被-gc回收"><a href="#question-4-如果-a-引用-b-b-又引用-a-发生了循环引用问题-这-2-个对象是否能被-gc回收" class="header-anchor">#</a> Question 4：如果 A 引用 B，B 又引用 A（发生了循环引用问题），这 2 个对象是否能被 GC回收？</h3> <p>关键不是在于 A、B 之间是否有引用，而是 A、B 是否可以一直向上追溯到 GC Roots。如果与 GC Roots 没有关联，则会被回收；否则，将继续存活。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/27/Cgp9HWEsmkGAf7_pAAA0kOaBKyA839.jpg" alt="8.jpg"></p> <p>上图是一个用“可达性分析”标记垃圾对象的示例图，灰色的对象表示不可达对象，将等待回收。</p> <h4 id="_2-哪些内存区域需要-gc"><a href="#_2-哪些内存区域需要-gc" class="header-anchor">#</a> 2.哪些内存区域需要 GC ?</h4> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/27/Cgp9HWEsmlOABzEaAABLevaZD-w747.jpg" alt="9.jpg"></p> <p>在刚刚一开始讲到的 JVM 内存布局中，我们知道了 thread 独享的区域：PC Regiester、JVM Stack、Native Method Stack，其生命周期都与线程相同（即与线程共生死），所以无需 GC。而线程共享的 Heap 区、Method Area 则是 GC 关注的重点对象。</p> <h4 id="_3-常用的-4-种-gc-算法"><a href="#_3-常用的-4-种-gc-算法" class="header-anchor">#</a> 3.常用的 4 种 GC 算法</h4> <h3 id="question-5-说一说常用的-gc-算法及其优缺点"><a href="#question-5-说一说常用的-gc-算法及其优缺点" class="header-anchor">#</a> Question 5：说一说常用的 GC 算法及其优缺点</h3> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/27/Cgp9HWEsmp-AV969AAAXLK9JRog778.jpg" alt="10.jpg"></p> <p><strong>1）mark-sweep 标记清除法</strong></p> <p>如上图，黑色区域表示待清理的垃圾对象，标记出来后直接清空。</p> <ul><li><p>优：简单快速；</p></li> <li><p>缺：产生很多内存碎片。</p></li></ul> <p><strong>2）mark-copy 标记复制法</strong></p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/30/CioPOWEsmsiAaFzWAAAZCCjflgw041.jpg" alt="11.jpg"></p> <p>思路也很简单，将内存对半分，总是保留一块空着（上图中的右侧），将左侧存活的对象（浅灰色区域）复制到右侧，然后左侧全部清空。</p> <ul><li><p>优：避免了内存碎片问题；</p></li> <li><p>缺：内存浪费很严重，相当于只能使用 50% 的内存。</p></li></ul> <p><strong>3）mark-compact 标记-整理（也称标记-压缩）法</strong></p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/28/Cgp9HWEsmuuAVl1CAAAXeNiLceQ497.jpg" alt="12.jpg"></p> <p>将垃圾对象清理掉后，同时将剩下的存活对象进行整理挪动（类似于 windows 的磁盘碎片整理），保证它们占用的空间连续。</p> <ul><li><p>优：节约了内存，并避免了内存碎片问题。</p></li> <li><p>缺：整理过程会降低 GC 的效率。</p></li></ul> <p>上述三种算法，每种都有各自的优缺点，都不完美；在现代 JVM 中，往往是综合使用的。经过大量实际分析，发现内存中的对象，大致可以分为两类：</p> <ul><li><p>有些生命周期很短，比如一些局部变量/临时对象；</p></li> <li><p>而另一些则会存活很久，典型的比如 websocket 长连接中的 connection 对象。如下图，纵向 y 轴可以理解分配内存的字节数，横向 x 轴理解为随着时间流逝（伴随着 GC）。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/30/CioPOWEsmxuAXJBzAAAXcpdwihU560.jpg" alt="13.jpg"></p></li></ul> <p>可以发现大部分对象其实相当短命，很少有对象能在 GC 后活下来，因此诞生了分代的思想。</p> <p><strong>4）generation-collect 分代收集算法</strong></p> <p>咱们以 Hotspot 为例（JDK 7）进行讲解，如下图所示，可以将内存分成了三大块：年青代（Young Genaration）、老年代（Old Generation）、永久代（Permanent Generation）。其中 Young Genaration 更是又细为分 eden、S0、S1 三个区。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/28/Cgp9HWEsmzOALLLdAAAteML8kLI706.jpg" alt="14.jpg"></p> <p>结合我们经常使用的一些 jvm 调优参数后，一些参数能影响的各区域内存大小值，示意图如下：</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/28/Cgp9HWEsnDaANqB8AABT8uplhYI656.jpg" alt="15.jpg"></p> <p>注：jdk8 开始，用 MetaSpace 区取代了 Perm 区（永久代），所以相应的 jvm 参数变成-XX:MetaspaceSize 及 -XX:MaxMetaspaceSize。</p> <h3 id="question-6-请以-hotspot-为例-分析一下-gc-全过程-并指出其中-gc-算法的综合运用-。"><a href="#question-6-请以-hotspot-为例-分析一下-gc-全过程-并指出其中-gc-算法的综合运用-。" class="header-anchor">#</a> Question 6：请以 Hotspot 为例，分析一下 GC 全过程（并指出其中 GC 算法的综合运用）。</h3> <p>刚开始时，对象分配在 eden 区，s0（即：from）及 s1（即：to）区几乎是空着。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/28/Cgp9HWEsnHSAe44fAAAyBIlKU2g132.jpg" alt="16.jpg"></p> <p>随着应用的运行，越来越多的对象被分配到 eden 区。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/28/Cgp9HWEsnJCARKtWAAAyUE3yOd4626.jpg" alt="17.jpg"></p> <p>当 eden 区放不下时，就会发生 minor GC（也被称为 young GC）。</p> <ul><li><p>首先当然是要先标识出不可达垃圾对象（即下图中的黄色块）；</p></li> <li><p>然后将可达对象，移动到 s0 区（即：4个淡蓝色的方块挪到s0区）；</p></li> <li><p>然后将黄色的垃圾块清理掉，这一轮后 eden 区就成空的了。</p></li></ul> <p><mark>注：这里其实已经综合运用了“【标记-清理eden】+【标记-复制 eden-&gt;s0】”算法。</mark></p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/30/CioPOWEsnOWAC91nAAA7mBY9r_U036.jpg" alt="18.jpg"></p> <p>随着时间推移，eden 如果又满了，再次触发 minor GC，同样还是先做标记，这时 eden 和 s0 区可能都有垃圾对象了（下图中的黄色块）。</p> <ul><li><p>这时 s1（即：to）区是空的，s0 区和 eden 区的存活对象，将直接搬到 s1 区。</p></li> <li><p>然后将 eden 和 s0 区的垃圾清理掉，这一轮 minor GC 后，eden 和 s0 区就变成了空的了。</p></li></ul> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/28/Cgp9HWEsnRKAe-vTAAA4wqe0anE150.jpg" alt="19.jpg"></p> <p>继续随着对象的不断分配，eden 空可能又满了，这时会重复刚才的 minor GC 过程。不过要注意的是：</p> <ul><li><p>这时候 s0 是空的，所以 s0 与 s1 的角色其实会互换。即存活的对象，会从 eden 和 s1 区，向 s0 区移动。</p></li> <li><p>然后再把 eden 和 s1 区中的垃圾清除，这一轮完成后，eden 与 s1 区变成空的，如下图。</p></li></ul> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/31/CioPOWEsnTuATA-lAAA60jlAwtA023.jpg" alt="20.jpg"></p> <p><strong>【代龄与晋升】</strong></p> <p>对于那些比较“长寿”的对象一直在 s0 与 s1 中挪来挪去，一来很占地方，而且也会造成一定开销，降低 gc 效率，于是有了“代龄(age)”及“晋升”。</p> <p>对象在年青代的 3 个区（edge,s0,s1）之间，每次从一个区移到另一区，年龄 +1，在 young 区达到一定的年龄阈值后，将晋升到老年代。</p> <p>下图中是 8，即挪动 8 次后，如果还活着，下次 minor GC 时，将移动到 Tenured 区。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/28/Cgp9HWEsnXiAZiONAAA6qgCYUZc566.jpg" alt="21.jpg"></p> <p><strong>【晋升的主要过程】</strong>
下图是晋升的主要过程：对象先分配在年青代，经过多次 Young GC 后，如果对象还活着，晋升到老年代。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/28/Cgp9HWEsnYuAPI_DAAAiMNdNNFI753.jpg" alt="22.jpg"></p> <p>如果老年代，最终也放满了，就会发生 major GC（即 Full GC）。由于老年代的的对象通常会比较多，标记-清理-整理（压缩）的耗时通常也会比较长，会让应用出现卡顿的现象。这也就是为什么很多应用要优化，尽量避免或减少 Full GC 的原因。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/28/Cgp9HWEsna-AYYftAAA5rifCKkc411.jpg" alt="23.jpg"></p> <p>注：上面的过程主要来自 oracle 官网的资料，但是有一个细节官网没有提到：如果分配的新对象比较大，eden 区放不下，但是 old 区可以放下时，会直接分配到 old 区。</p> <blockquote><p>即没有晋升这一过程，直接到老年代了。</p></blockquote> <p><strong>【GC 流程图】</strong></p> <p>下图引自阿里出品的《码出高效-Java开发手册》一书，梳理了 GC 的主要过程。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/28/Cgp9HWEsndeATQYWAABUVHtEAHE399.jpg" alt="24.jpg"></p> <h2 id="_8-种垃圾回收器"><a href="#_8-种垃圾回收器" class="header-anchor">#</a> 8 种垃圾回收器</h2> <p>不算上后面出现的神器 ZGC，历史上出现过 7 种经典的垃圾回收器。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/29/Cgp9HWEsoXuAR2WEAAEJEJx1RMY327.png" alt="25.png"></p> <p>这些回收器都是基于分代的，把 G1 除外，按回收的分代划分如下。</p> <ul><li><p>横线以上的 3 种：Serial、ParNew、Parellel Scavenge 都是回收年青代的；</p></li> <li><p>横线以下的 3 种：CMS、Serial Old、Parallel Old 都是回收老年代的。</p></li></ul> <p>接下来，我们将以上提到的 8 种垃圾回收器逐一讲解，其中 CMS、G1、ZGC 这三种收集器是面试考试重点，我也会着重讲解。</p> <h5 id="_1-serial-收集器"><a href="#_1-serial-收集器" class="header-anchor">#</a> 1.Serial 收集器</h5> <p>单线程用标记-复制算法，快刀斩乱麻，单线程的好处避免上下文切换，早期的机器，大多是单核，也比较实用。但执行期间会发生 STW（Stop The World）。</p> <h5 id="_2-parnew-收集器"><a href="#_2-parnew-收集器" class="header-anchor">#</a> 2.ParNew 收集器</h5> <p>是 Serial 的多线程版本，也同样会 STW，在多核机器上会更适用。</p> <h5 id="_3-parallel-scavenge-收集器"><a href="#_3-parallel-scavenge-收集器" class="header-anchor">#</a> 3.Parallel Scavenge 收集器</h5> <p>ParNew 的升级版本，主要区别在于提供了两个参数：</p> <p>-XX:MaxGCPauseMillis 最大垃圾回收停顿时间；</p> <p>-XX:GCTimeRatio 垃圾回收时间与总时间占比。</p> <p>通过这 2 个参数，可以适当控制回收的节奏，更关注于吞吐率，即总时间与垃圾回收时间的比例。</p> <h5 id="_4-serial-old-收集器"><a href="#_4-serial-old-收集器" class="header-anchor">#</a> 4.Serial Old 收集器</h5> <p>因为老年代的对象通常比较多，占用的空间通常也会更大。如果采用复制算法，得留 50% 的空间用于复制，相当不划算；而且因为对象多，从一个区，复制到另一个区，耗时也会比较长。</p> <p>所以老年代的收集，通常会采用“标记-整理”法。从名字就可以看出来，这是单线程（串行）的， 依然会有 STW。</p> <h5 id="_5-parallel-old-收集器"><a href="#_5-parallel-old-收集器" class="header-anchor">#</a> 5.Parallel Old 收集器</h5> <p>一句话：Serial Old 的多线程版本。</p> <h5 id="_6-重点-cms-收集器"><a href="#_6-重点-cms-收集器" class="header-anchor">#</a> 6.重点！CMS 收集器</h5> <p>全称：Concurrent Mark Sweep，从名字上看，就能猜出它是并发多线程的。这是 JDK 7 中广泛使用的收集器，有必要多说一下。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/29/Cgp9HWEsoZSAEqicAABcDI3t_Mo844.jpg" alt="26.jpg"></p> <h3 id="question-7-cms-收集器工作的整个流程主要分为哪几个阶段"><a href="#question-7-cms-收集器工作的整个流程主要分为哪几个阶段" class="header-anchor">#</a> Question 7：CMS 收集器工作的整个流程主要分为哪几个阶段？</h3> <p>相对前面两个 Serial Old 收集器或 Parallel Old 收集器而言，这个明显要复杂多了，分为 4 个阶段：</p> <ol><li><p>Inital Mark 初始标记：主要是标记GC Root开始的下级（注：仅下一级）对象，这个过程会STW，但是跟GC Root直接关联的下级对象不会很多，因此这个过程其实很快。</p></li> <li><p>Concurrent Mark 并发标记：根据上一步的结果，继续向下标识所有关联的对象，直到这条链上的最尽头。这个过程是多线程的，虽然耗时理论上会比较长，但是其它工作线程并不会阻塞，没有 STW。</p></li> <li><p>Remark 再标志：为啥还要再标记一次？因为第2步并没有阻塞其它工作线程，其它线程在标识过程中，很有可能会产生新的垃圾。</p></li></ol> <blockquote><p>试想下，高铁上的垃圾清理员，从车厢一头开始吆喝“有需要扔垃圾的乘客，请把垃圾扔一下”，一边工作一边向前走，等走到车厢另一头时，刚才走过的位置上，可能又有乘客产生了新的空瓶垃圾。
所以，要完全把这个车厢清理干净的话，她应该喊一下：所有乘客不要再扔垃圾了（STW），然后把新产生的垃圾收走。当然，因为刚才已经把收过一遍垃圾，所以这次收集新产生的垃圾，用不了多长时间（即 STW 时间不会很长）。</p></blockquote> <ol start="4"><li>Concurrent Sweep 并行清理：这里使用多线程以“Mark Sweep-标记清理”算法，把垃圾清掉，其它工作线程仍然能继续支行，不会造成卡顿。</li></ol> <p>等等，刚才我们不是提到过“标记清理”法，会留下很多内存碎片吗？</p> <p>确实，但是也没办法，如果换成“Mark Compact 标记-整理”法，把垃圾清理后，剩下的对象也顺便排整理，会导致这些对象的内存地址发生变化。别忘了，此时其他线程还在工作，如果引用的对象地址变了，就天下大乱了。</p> <p>另外，由于这一步是并行处理，并不阻塞其它线程，所以还有一个副使用：在清理过程中，仍然可能会有新垃圾对象产生，只能等到下一轮 GC，才会被清理掉。</p> <p>虽然仍不完美，但是从这 4 步的处理过程来看，以往收集器中最让人诟病的长时间 STW，通过上述设计，被分解成二次短暂的 STW。所以从总体效果上看，应用在 GC 期间卡顿的情况会大大改善，这也是 CMS 一度十分流行的重要原因。</p> <h5 id="_7-重点-g1-收集器"><a href="#_7-重点-g1-收集器" class="header-anchor">#</a> 7.重点！G1 收集器</h5> <p>鉴于 CMS 的一些不足之外，比如：老年代内存碎片化，STW 时间虽然已经改善了很多，但是仍然有提升空间。G1 就横空出世了，它对于 heap 区的内存划思路很新颖，有点算法中分治法“分而治之”的味道。</p> <blockquote><p>G1 的全称是 Garbage-First，为什么叫这个名字？呆会儿会详细说明。</p></blockquote> <h3 id="question-8-g1-垃圾收集器的原理是什么"><a href="#question-8-g1-垃圾收集器的原理是什么" class="header-anchor">#</a> Question 8：G1 垃圾收集器的原理是什么？</h3> <p>如下图，G1 将 heap 内存区，划分为一个个大小相等（1-32M，2的 n 次方）、内存连续的 Region 区域，每个 region 都对应 Eden、Survivor 、Old、Humongous 四种角色之一，但是 region 与 region 之间不要求连续。</p> <blockquote><p>注：Humongous，简称 H 区是专用于存放超大对象的区域，通常 &gt;= 1/2 Region Size，且只有 Full GC 阶段，才会回收 H 区，避免了频繁扫描、复制/移动大对象。</p></blockquote> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/32/CioPOWEsoyiAPrJoAAAlpnfE74Y082.jpg" alt="27.jpg"></p> <p>所有的垃圾回收，都是基于 1 个个 region 的。JVM 内部知道，哪些 region 的对象最少（即该区域最空），总是会优先收集这些 region（因为对象少，内存相对较空，肯定快）。这就是 Garbage-First 得名的由来，G 即是 Garbage 的缩写，1 即 First。</p> <h5 id="_1-g1-young-gc"><a href="#_1-g1-young-gc" class="header-anchor">#</a> 1）G1 Young GC</h5> <p>young GC 前：</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEso1-ASR07AAAooj52DT8141.jpg" alt="28.jpg"></p> <p>young GC 后：</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/32/CioPOWEso26ATLb5AAAhJlGHuaA144.jpg" alt="29.jpg"></p> <p>理论上讲，只要有一个 Empty Region（空区域），就可以进行垃圾回收。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/32/CioPOWEso4CAQAEVAAAZ5lASmzU156.jpg" alt="30.jpg"></p> <p>由于 region 与 region 之间并不要求连续，而使用 G1 的场景通常是大内存，比如 64G 甚至更大，为了提高扫描根对象和标记的效率，G1 使用了二个新的辅助存储结构：</p> <ul><li><p>Remembered Sets：简称 RSets，用于根据每个 region 里的对象，是从哪指向过来的（即谁引用了我），每个 Region 都有独立的 RSets（Other Region -&gt; Self Region）。</p></li> <li><p>Collection Sets ：简称 CSets，记录了等待回收的 Region 集合，GC 时这些 Region 中的对象会被回收（copied or moved）。</p></li></ul> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEso76AGea-AAAgqInKaYY726.jpg" alt="31.jpg"></p> <p>RSets 的引入，在 YGC 时，将年青代 Region 的 RSets 做为根对象，可以避免扫描老年代的 region，能大大减轻 GC 的负担。</p> <blockquote><p>注：在老年代收集 Mixed GC 时，RSets 记录了 Old-&gt;Old 的引用，也可以避免扫描所有 Old 区。</p></blockquote> <h5 id="_2-old-generation-collection-也称为-mixed-gc"><a href="#_2-old-generation-collection-也称为-mixed-gc" class="header-anchor">#</a> 2）Old Generation Collection（也称为 Mixed GC）</h5> <h3 id="question-9-g1-垃圾收集器的运行过程-分为哪几个阶段"><a href="#question-9-g1-垃圾收集器的运行过程-分为哪几个阶段" class="header-anchor">#</a> Question 9：G1 垃圾收集器的运行过程，分为哪几个阶段？</h3> <p>按 oracle 官网文档描述，分为 5 个阶段：Initial Mark(STW) -&gt; Root Region Scan -&gt; Cocurrent Marking -&gt; Remark(STW) -&gt; Copying/Cleanup(STW &amp;&amp; Concurrent)</p> <blockquote><p>注：也有很多文章会把 Root Region Scan 省略掉，合并到 Initial Mark 里，变成 4 个阶段。</p></blockquote> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/32/CioPOWEspASAXxudAAAc8vriADo007.jpg" alt="32.jpg"></p> <h5 id="阶段-1-存活对象的-初始标记-依赖于-young-gc-gc-日志中会记录成-young-字样。"><a href="#阶段-1-存活对象的-初始标记-依赖于-young-gc-gc-日志中会记录成-young-字样。" class="header-anchor">#</a> 阶段 1：存活对象的“初始标记”依赖于 Young GC，GC 日志中会记录成 young 字样。</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>2019-06-09T15:24:37.086+0800: 500993.392: [GC pause (G1 Evacuation Pause) (young), 0.0493588 secs]
   [Parallel Time: 41.9 ms, GC Workers: 8]
      [GC Worker Start (ms): Min: 500993393.7, Avg: 500993393.7, Max: 500993393.7, Diff: 0.1]
      [Ext Root Scanning (ms): Min: 1.5, Avg: 2.2, Max: 4.4, Diff: 2.8, Sum: 17.2]
      [Update RS (ms): Min: 15.8, Avg: 18.1, Max: 18.9, Diff: 3.1, Sum: 144.8]
         [Processed Buffers: Min: 110, Avg: 144.9, Max: 163, Diff: 53, Sum: 1159]
      [Scan RS (ms): Min: 4.7, Avg: 5.0, Max: 5.1, Diff: 0.4, Sum: 39.7]
      [Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]
      [Object Copy (ms): Min: 16.4, Avg: 16.5, Max: 16.6, Diff: 0.2, Sum: 132.0]
      [Termination (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]
         [Termination Attempts: Min: 1, Avg: 4.9, Max: 7, Diff: 6, Sum: 39]
      [GC Worker Other (ms): Min: 0.0, Avg: 0.0, Max: 0.1, Diff: 0.1, Sum: 0.3]
      [GC Worker Total (ms): Min: 41.7, Avg: 41.8, Max: 41.8, Diff: 0.1, Sum: 334.1]
      [GC Worker End (ms): Min: 500993435.5, Avg: 500993435.5, Max: 500993435.5, Diff: 0.0]
   [Code Root Fixup: 0.0 ms]
   [Code Root Purge: 0.0 ms]
   [Clear CT: 0.2 ms]
   [Other: 7.2 ms]
      [Choose CSet: 0.0 ms]
      [Ref Proc: 4.3 ms]
      [Ref Enq: 0.1 ms]
      [Redirty Cards: 0.1 ms]
      [Humongous Register: 0.1 ms]
      [Humongous Reclaim: 0.1 ms]
      [Free CSet: 0.6 ms]
   [Eden: 1340.0M(1340.0M)-&gt;0.0B(548.0M) Survivors: 40.0M-&gt;64.0M Heap: 2868.2M(12.0G)-&gt;1499.8M(12.0G)]
 [Times: user=0.35 sys=0.00, real=0.05 secs]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEspKCAWO06AAAjPuht2jw948.jpg" alt="33.jpg"></p> <h5 id="阶段-2-并发标记过程中-如果发现某些-region-全是空的-会被直接清除。"><a href="#阶段-2-并发标记过程中-如果发现某些-region-全是空的-会被直接清除。" class="header-anchor">#</a> 阶段 2：并发标记过程中，如果发现某些 region 全是空的，会被直接清除。</h5> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/32/CioPOWEspL-AeIrMAAAZ0L4aFgU868.jpg" alt="34.jpg"></p> <h5 id="阶段-3-进入重新标记阶段。"><a href="#阶段-3-进入重新标记阶段。" class="header-anchor">#</a> 阶段 3：进入重新标记阶段。</h5> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEspNCAShnGAAAs2sVtmIk851.jpg" alt="35.jpg"></p> <h5 id="阶段-4-并发复制-清查阶段。"><a href="#阶段-4-并发复制-清查阶段。" class="header-anchor">#</a> 阶段 4：并发复制/清查阶段。</h5> <p>这个阶段，Young 区和 Old 区的对象有可能会被同时清理。GC 日志中，会记录为 mixed 字段，这也是 G1 的老年代收集，也称为 Mixed GC 的原因。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2019-06-09T15:24:23.959+0800: 500980.265: [GC pause (G1 Evacuation Pause) (mixed), 0.0885388 secs]
   [Parallel Time: 74.2 ms, GC Workers: 8]
      [GC Worker Start (ms): Min: 500980270.6, Avg: 500980270.6, Max: 500980270.6, Diff: 0.1]
      [Ext Root Scanning (ms): Min: 1.7, Avg: 2.2, Max: 4.1, Diff: 2.4, Sum: 17.3]
      [Update RS (ms): Min: 11.7, Avg: 13.7, Max: 14.3, Diff: 2.6, Sum: 109.8]
         [Processed Buffers: Min: 136, Avg: 141.5, Max: 152, Diff: 16, Sum: 1132]
      [Scan RS (ms): Min: 42.5, Avg: 42.9, Max: 43.1, Diff: 0.5, Sum: 343.1]
      [Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.1]
      [Object Copy (ms): Min: 14.9, Avg: 15.2, Max: 15.4, Diff: 0.5, Sum: 121.7]
      [Termination (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.1]
         [Termination Attempts: Min: 1, Avg: 8.2, Max: 11, Diff: 10, Sum: 66]
      [GC Worker Other (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.2]
      [GC Worker Total (ms): Min: 74.0, Avg: 74.0, Max: 74.1, Diff: 0.1, Sum: 592.3]
      [GC Worker End (ms): Min: 500980344.6, Avg: 500980344.6, Max: 500980344.6, Diff: 0.0]
   [Code Root Fixup: 0.0 ms]
   [Code Root Purge: 0.0 ms]
   [Clear CT: 0.5 ms]
   [Other: 13.9 ms]
      [Choose CSet: 4.1 ms]
      [Ref Proc: 1.8 ms]
      [Ref Enq: 0.1 ms]
      [Redirty Cards: 0.2 ms]
      [Humongous Register: 0.1 ms]
      [Humongous Reclaim: 0.1 ms]
      [Free CSet: 5.6 ms]
   [Eden: 584.0M(584.0M)-&gt;0.0B(576.0M) Survivors: 28.0M-&gt;36.0M Heap: 4749.3M(12.0G)-&gt;2930.0M(12.0G)]
 [Times: user=0.61 sys=0.00, real=0.09 secs]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEspReALKoGAAAe7uQdsCU229.jpg" alt="36.jpg"></p> <p>上图是，老年代收集完后的示意图。</p> <p>通过这几个阶段的分析，虽然看上去很多阶段仍然会发生 STW，但是 G1 提供了一个预测模型，通过统计方法，根据历史数据来预测本次收集，需要选择多少个 Region 来回收，尽量满足用户的预期停顿值（-XX:MaxGCPauseMillis 参数可指定预期停顿值）。</p> <blockquote><p>注：如果 Mixed GC 仍然效果不理想，跟不上新对象分配内存的需求，会使用 Serial Old GC（Full GC）强制收集整个 Heap。</p></blockquote> <p>小结：与 CMS 相比，G1 有内存整理过程（标记-压缩），避免了内存碎片；STW 时间可控（能预测 GC 停顿时间）。</p> <h5 id="_8-重点-zgc-截止目前史上最好的-gc-收集器"><a href="#_8-重点-zgc-截止目前史上最好的-gc-收集器" class="header-anchor">#</a> 8.重点！ZGC（截止目前史上最好的 GC 收集器）</h5> <h3 id="question-10-zgc-在-g1-基础上做了哪些改进"><a href="#question-10-zgc-在-g1-基础上做了哪些改进" class="header-anchor">#</a> Question 10：ZGC 在 G1 基础上做了哪些改进？</h3> <p>在 G1 的基础上，它做了如下 7 点改进（JDK 11 开始引入）。</p> <h5 id="_1-动态调整大小的-region"><a href="#_1-动态调整大小的-region" class="header-anchor">#</a> 1）动态调整大小的 Region</h5> <p>G1 中每个 Region 的大小是固定的，创建和销毁 Region，可以动态调整大小，内存使用更高效。</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/2A/Cgp9HWEspYeAXzknAAAIiMoiXjE128.jpg" alt="37.jpg"></p> <h5 id="_2-不分代-干掉了-rsets"><a href="#_2-不分代-干掉了-rsets" class="header-anchor">#</a> 2）不分代，干掉了 RSets</h5> <p>G1 中每个 Region 需要借助额外的 RSets 来记录“谁引用了我”，占用了额外的内存空间，每次对象移动时，RSets 也需要更新，会产生开销。</p> <blockquote><p>ZGC 没有为止，没有实现分代机制，每次都是并发的对所有 region 进行回收，不象 G1 是增量回收，所以用不着 RSets。不分代的带来的可能性能下降，会用下面马上提到的 Colored Pointer &amp;&amp; Load Barrier 来优化。</p></blockquote> <h5 id="_3-带颜色的指针-colored-pointer"><a href="#_3-带颜色的指针-colored-pointer" class="header-anchor">#</a> 3）带颜色的指针 Colored Pointer</h5> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/2A/Cgp9HWEspaqAZJgwAAAnVLyDuLg609.jpg" alt="38.jpg"></p> <p>这里的指针类似 Java 中的引用，意为对某块虚拟内存的引用。ZGC 采用了64位指针（注：目前只支持 linux 64 位系统），将 42-45 这 4 个 bit 位置赋予了不同含义，即所谓的颜色标志位，也换为指针的 metadata。</p> <ul><li><p>finalizable 位：仅 finalizer（类比 C++ 中的析构函数）可访问；</p></li> <li><p>remap 位：指向对象当前（最新）的内存地址，参考下面提到的relocation；</p></li> <li><p>marked0 &amp;&amp; marked1 位：用于标志可达对象。</p></li></ul> <p>这 4 个标志位，同一时刻只会有 1 个位置是 1。每当指针对应的内存数据发生变化，比如内存被移动，颜色会发生变化。</p> <h5 id="_4-读屏障-load-barrier"><a href="#_4-读屏障-load-barrier" class="header-anchor">#</a> 4）读屏障 Load Barrier</h5> <p>传统 GC 做标记时，为了防止其他线程在标记期间修改对象，通常会简单的 STW。而 ZGC 有了 Colored Pointer 后，引入了所谓的“读屏障”。</p> <p>当指针引用的内存正被移动时，指针上的颜色就会变化，ZGC 会先把指针更新成最新状态，然后再返回（你可以回想下 Java 中的 volatile 关键字，有异曲同工之妙）。这样仅读取该指针时，可能会略有开销，而不用将整个 heap STW。</p> <h5 id="_5-重定位-relocation"><a href="#_5-重定位-relocation" class="header-anchor">#</a> 5）重定位 Relocation</h5> <p>如下图，在标记过程中，先从 Roots 对象找到了直接关联的下级对象 1，2，4。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEspqWAAHS6AAAcoge7Pv8625.jpg" alt="39.jpg"></p> <p>然后继续向下层标记，找到了 5，8 对象， 此时已经可以判定 3，6，7 为垃圾对象。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEsprCAZrtCAAAeqKPoHXw488.jpg" alt="40.jpg"></p> <p>如果按常规思路，一般会将 8 从最右侧的 Region，移动或复制到中间的 Region，然后再将中间 Region 的 3 干掉，最后再对中间 Region 做压缩 compact 整理。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEspr6AMxziAAAeYmBBjoU744.jpg" alt="41.jpg"></p> <p>但 ZGC 做得更高明，它直接将 4，5 复制到了一个空的新 Region 就完事了，然后中间的 2 个 Region 直接废弃，或理解为“释放”，作为下次回收的“新” Region。这样的好处是避免了中间 Region 的 compact 整理过程。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEspsuAFh42AAAsCgyJwEk919.jpg" alt="42.jpg"></p> <p>最后，指针重新调整为正确的指向（即：remap），而且上一阶段的 remap 与下一阶段的mark是混在一起处理的，相对更高效。</p> <p>【 Remap 的流程图】</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/2A/Cgp9HWEsptuABwmwAAA8njSoyvA729.jpg" alt="43.jpg"></p> <h5 id="_6-多重映射-multi-mapping"><a href="#_6-多重映射-multi-mapping" class="header-anchor">#</a> 6）多重映射 Multi-Mapping</h5> <p>这个优化，说实话没完全看懂，只能谈下自己的理解（如果有误，欢迎指正)。虚拟内存与实际物理内存，OS 会维护一个映射关系，才能正常使用，如下图：</p> <p><img src="https://s0.lgstatic.com/i/image6/M00/56/33/CioPOWEspu-AMzsrAAAexu5Y-5Y191.jpg" alt="44.jpg"></p> <p>zgc 的 64 位颜色指针，在解除映射关系时，代价较高（需要屏蔽额外的 42-45 的颜色标志位）。考虑到这 4 个标志位，同 1 时刻，只会有 1 位置成 1（如下图），另外 finalizable 标志位，永远不希望被解除映射绑定（可不用考虑映射问题）。</p> <p>所以剩下 3 种颜色的虚拟内存，可以都映射到同1段物理内存。即映射复用，或者更通俗点讲，本来 3 种不同颜色的指针，哪怕 0-41 位完全相同，也需要映射到 3 段不同的物理内存，现在只需要映射到同 1 段物理内存即可。</p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/33/CioPOWEspvuAPsezAAA3EnbGU_s779.jpg" alt="45.jpg"></p> <p><img src="https://s0.lgstatic.com/i/image6/M01/56/33/CioPOWEspwaACvveAAB6uIWxwWM451.jpg" alt="46.jpg"></p> <h5 id="_7-支持-numa-架构"><a href="#_7-支持-numa-架构" class="header-anchor">#</a> 7）支持 NUMA 架构</h5> <p>NUMA 是一种多核服务器的架构，简单来讲，一个多核服务器（比如 2core），每个 cpu 都有属于自己的存储器，会比访问另一个核的存储器会慢很多（类似于就近访问更快）。</p> <p>相对之前的 GC 算法，ZGC 首次支持了 NUMA 架构，申请堆内存时，判断当前线程属是哪个CPU在执行，然后就近申请该 CPU 能使用的内存。</p> <p>小结：革命性的 ZGC 经过上述一堆优化后，每次 GC 总体卡顿时间按官方说法&lt;10ms。</p> <blockquote><p>注：启用 zgc，需要设置 -XX:+UnlockExperimentalVMOptions -XX:+UseZGC。</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/txxs/mark/edit/master/docs/q&amp;a/interview/GC-FAQ.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-01-04 17:14:56</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mark/q&amp;a/interview/Elasticsearch-FAQ.html" class="prev">
        /q&amp;a/interview/Elasticsearch-FAQ.html
      </a></span> <span class="next"><a href="/mark/q&amp;a/interview/Java-Basics-FAQ.html">
        JDK和JRE、 JVM
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mark/assets/js/app.0aea0d93.js" defer></script><script src="/mark/assets/js/2.9796e7dc.js" defer></script><script src="/mark/assets/js/214.486d9eaa.js" defer></script><script src="/mark/assets/js/4.70c6b853.js" defer></script>
  </body>
</html>

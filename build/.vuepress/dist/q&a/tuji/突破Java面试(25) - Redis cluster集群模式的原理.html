<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1 面试题 | Mark</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/mark/favicon.ico">
    <link rel="manifest" href="/mark/manifest.json">
    <meta name="description" content="本博客主要是用来记录系统化的知识，内容部分来自github上的其他开源仓库，如有问题联系sdlyjhm01@sina.com">
    
    <link rel="preload" href="/mark/assets/css/0.styles.bb82d616.css" as="style"><link rel="preload" href="/mark/assets/js/app.e4c063e1.js" as="script"><link rel="preload" href="/mark/assets/js/2.306dea3c.js" as="script"><link rel="preload" href="/mark/assets/js/253.5c87349e.js" as="script"><link rel="preload" href="/mark/assets/js/4.c54fd058.js" as="script"><link rel="prefetch" href="/mark/assets/js/10.e9625f2f.js"><link rel="prefetch" href="/mark/assets/js/100.1a6cd12f.js"><link rel="prefetch" href="/mark/assets/js/101.741a168b.js"><link rel="prefetch" href="/mark/assets/js/102.6985d2b2.js"><link rel="prefetch" href="/mark/assets/js/103.9a645de3.js"><link rel="prefetch" href="/mark/assets/js/104.5ed09afb.js"><link rel="prefetch" href="/mark/assets/js/105.2b3dc588.js"><link rel="prefetch" href="/mark/assets/js/106.3b2ec007.js"><link rel="prefetch" href="/mark/assets/js/107.13608aab.js"><link rel="prefetch" href="/mark/assets/js/108.bdaebab1.js"><link rel="prefetch" href="/mark/assets/js/109.2f7c8e41.js"><link rel="prefetch" href="/mark/assets/js/11.beb96cb1.js"><link rel="prefetch" href="/mark/assets/js/110.2599e016.js"><link rel="prefetch" href="/mark/assets/js/111.34856411.js"><link rel="prefetch" href="/mark/assets/js/112.9cab5bf3.js"><link rel="prefetch" href="/mark/assets/js/113.24635129.js"><link rel="prefetch" href="/mark/assets/js/114.35ac2fbe.js"><link rel="prefetch" href="/mark/assets/js/115.a5eebc2c.js"><link rel="prefetch" href="/mark/assets/js/116.3c9d9082.js"><link rel="prefetch" href="/mark/assets/js/117.830c8803.js"><link rel="prefetch" href="/mark/assets/js/118.a447117a.js"><link rel="prefetch" href="/mark/assets/js/119.f8a7931e.js"><link rel="prefetch" href="/mark/assets/js/12.3d6db41d.js"><link rel="prefetch" href="/mark/assets/js/120.c15995b4.js"><link rel="prefetch" href="/mark/assets/js/121.ff016afe.js"><link rel="prefetch" href="/mark/assets/js/122.50f64ae0.js"><link rel="prefetch" href="/mark/assets/js/123.57368e0f.js"><link rel="prefetch" href="/mark/assets/js/124.0713a8fa.js"><link rel="prefetch" href="/mark/assets/js/125.4896a4c6.js"><link rel="prefetch" href="/mark/assets/js/126.1a525322.js"><link rel="prefetch" href="/mark/assets/js/127.e8fa04df.js"><link rel="prefetch" href="/mark/assets/js/128.e8a68598.js"><link rel="prefetch" href="/mark/assets/js/129.6d32ce67.js"><link rel="prefetch" href="/mark/assets/js/13.4dbd9a5e.js"><link rel="prefetch" href="/mark/assets/js/130.9cf9077d.js"><link rel="prefetch" href="/mark/assets/js/131.8298f3e8.js"><link rel="prefetch" href="/mark/assets/js/132.4a0689f8.js"><link rel="prefetch" href="/mark/assets/js/133.2e3514b7.js"><link rel="prefetch" href="/mark/assets/js/134.c31920ff.js"><link rel="prefetch" href="/mark/assets/js/135.8ef71a2a.js"><link rel="prefetch" href="/mark/assets/js/136.1590399b.js"><link rel="prefetch" href="/mark/assets/js/137.8cb3427f.js"><link rel="prefetch" href="/mark/assets/js/138.bd50cc1e.js"><link rel="prefetch" href="/mark/assets/js/139.d0693df5.js"><link rel="prefetch" href="/mark/assets/js/14.c5fb4a01.js"><link rel="prefetch" href="/mark/assets/js/140.b7c03b64.js"><link rel="prefetch" href="/mark/assets/js/141.9055de44.js"><link rel="prefetch" href="/mark/assets/js/142.75184b94.js"><link rel="prefetch" href="/mark/assets/js/143.b0133c36.js"><link rel="prefetch" href="/mark/assets/js/144.6e99b7d7.js"><link rel="prefetch" href="/mark/assets/js/145.05ba3b46.js"><link rel="prefetch" href="/mark/assets/js/146.b0cce194.js"><link rel="prefetch" href="/mark/assets/js/147.cb0f06f8.js"><link rel="prefetch" href="/mark/assets/js/148.bda4a3cf.js"><link rel="prefetch" href="/mark/assets/js/149.f30174f5.js"><link rel="prefetch" href="/mark/assets/js/15.e20bc33d.js"><link rel="prefetch" href="/mark/assets/js/150.17580267.js"><link rel="prefetch" href="/mark/assets/js/151.c883500d.js"><link rel="prefetch" href="/mark/assets/js/152.e8955d60.js"><link rel="prefetch" href="/mark/assets/js/153.90ab5dfe.js"><link rel="prefetch" href="/mark/assets/js/154.2ef64f3b.js"><link rel="prefetch" href="/mark/assets/js/155.d78ebb6d.js"><link rel="prefetch" href="/mark/assets/js/156.61084b3e.js"><link rel="prefetch" href="/mark/assets/js/157.77ad971a.js"><link rel="prefetch" href="/mark/assets/js/158.7dd189a7.js"><link rel="prefetch" href="/mark/assets/js/159.bab8ef3d.js"><link rel="prefetch" href="/mark/assets/js/16.0fead0d6.js"><link rel="prefetch" href="/mark/assets/js/160.eab855b5.js"><link rel="prefetch" href="/mark/assets/js/161.c44ab80b.js"><link rel="prefetch" href="/mark/assets/js/162.343e7733.js"><link rel="prefetch" href="/mark/assets/js/163.b3c10836.js"><link rel="prefetch" href="/mark/assets/js/164.d415bea2.js"><link rel="prefetch" href="/mark/assets/js/165.28563be8.js"><link rel="prefetch" href="/mark/assets/js/166.0ba763c0.js"><link rel="prefetch" href="/mark/assets/js/167.9a6593ff.js"><link rel="prefetch" href="/mark/assets/js/168.53e9d8e7.js"><link rel="prefetch" href="/mark/assets/js/169.11e13f73.js"><link rel="prefetch" href="/mark/assets/js/17.d6bc62ed.js"><link rel="prefetch" href="/mark/assets/js/170.d0ce7089.js"><link rel="prefetch" href="/mark/assets/js/171.203b2c5c.js"><link rel="prefetch" href="/mark/assets/js/172.974e4793.js"><link rel="prefetch" href="/mark/assets/js/173.ef302303.js"><link rel="prefetch" href="/mark/assets/js/174.08c07fc2.js"><link rel="prefetch" href="/mark/assets/js/175.5882ace6.js"><link rel="prefetch" href="/mark/assets/js/176.fba7beb7.js"><link rel="prefetch" href="/mark/assets/js/177.98c1da39.js"><link rel="prefetch" href="/mark/assets/js/178.1937bbe2.js"><link rel="prefetch" href="/mark/assets/js/179.dcd66fa6.js"><link rel="prefetch" href="/mark/assets/js/18.9e104c7f.js"><link rel="prefetch" href="/mark/assets/js/180.42411846.js"><link rel="prefetch" href="/mark/assets/js/181.2068a24f.js"><link rel="prefetch" href="/mark/assets/js/182.55041e52.js"><link rel="prefetch" href="/mark/assets/js/183.65d5f5ea.js"><link rel="prefetch" href="/mark/assets/js/184.27b87f1a.js"><link rel="prefetch" href="/mark/assets/js/185.51db0e3c.js"><link rel="prefetch" href="/mark/assets/js/186.65372d21.js"><link rel="prefetch" href="/mark/assets/js/187.b49fc178.js"><link rel="prefetch" href="/mark/assets/js/188.c0a36f6c.js"><link rel="prefetch" href="/mark/assets/js/189.61a299f6.js"><link rel="prefetch" href="/mark/assets/js/19.a4465f20.js"><link rel="prefetch" href="/mark/assets/js/190.b9a3dca1.js"><link rel="prefetch" href="/mark/assets/js/191.1458bb3b.js"><link rel="prefetch" href="/mark/assets/js/192.5cf60fdc.js"><link rel="prefetch" href="/mark/assets/js/193.f746c670.js"><link rel="prefetch" href="/mark/assets/js/194.66002694.js"><link rel="prefetch" href="/mark/assets/js/195.844f0001.js"><link rel="prefetch" href="/mark/assets/js/196.8d4d8979.js"><link rel="prefetch" href="/mark/assets/js/197.c48967ed.js"><link rel="prefetch" href="/mark/assets/js/198.4cd8e227.js"><link rel="prefetch" href="/mark/assets/js/199.8c6743ac.js"><link rel="prefetch" href="/mark/assets/js/20.07561449.js"><link rel="prefetch" href="/mark/assets/js/200.2d742e73.js"><link rel="prefetch" href="/mark/assets/js/201.c938782f.js"><link rel="prefetch" href="/mark/assets/js/202.a161f0dd.js"><link rel="prefetch" href="/mark/assets/js/203.4660c742.js"><link rel="prefetch" href="/mark/assets/js/204.c503097d.js"><link rel="prefetch" href="/mark/assets/js/205.0c9eb91a.js"><link rel="prefetch" href="/mark/assets/js/206.c94b988e.js"><link rel="prefetch" href="/mark/assets/js/207.adb9b2e2.js"><link rel="prefetch" href="/mark/assets/js/208.f28a5d4b.js"><link rel="prefetch" href="/mark/assets/js/209.c6219bc8.js"><link rel="prefetch" href="/mark/assets/js/21.f2b60342.js"><link rel="prefetch" href="/mark/assets/js/210.28b46949.js"><link rel="prefetch" href="/mark/assets/js/211.a92bf419.js"><link rel="prefetch" href="/mark/assets/js/212.eaa3b7ca.js"><link rel="prefetch" href="/mark/assets/js/213.de90a7c8.js"><link rel="prefetch" href="/mark/assets/js/214.486d9eaa.js"><link rel="prefetch" href="/mark/assets/js/215.ccedf288.js"><link rel="prefetch" href="/mark/assets/js/216.58d4b4d1.js"><link rel="prefetch" href="/mark/assets/js/217.5cbb91f5.js"><link rel="prefetch" href="/mark/assets/js/218.b35d663a.js"><link rel="prefetch" href="/mark/assets/js/219.1f406ef3.js"><link rel="prefetch" href="/mark/assets/js/22.0686356f.js"><link rel="prefetch" href="/mark/assets/js/220.6cdcf57a.js"><link rel="prefetch" href="/mark/assets/js/221.1144668a.js"><link rel="prefetch" href="/mark/assets/js/222.7bf0c5af.js"><link rel="prefetch" href="/mark/assets/js/223.6cd26625.js"><link rel="prefetch" href="/mark/assets/js/224.f02d4c89.js"><link rel="prefetch" href="/mark/assets/js/225.fa07fe75.js"><link rel="prefetch" href="/mark/assets/js/226.4b3bbd33.js"><link rel="prefetch" href="/mark/assets/js/227.dabe9543.js"><link rel="prefetch" href="/mark/assets/js/228.53bdf8e9.js"><link rel="prefetch" href="/mark/assets/js/229.dd82ae2e.js"><link rel="prefetch" href="/mark/assets/js/23.9e340a33.js"><link rel="prefetch" href="/mark/assets/js/230.3cf9338a.js"><link rel="prefetch" href="/mark/assets/js/231.5e0764db.js"><link rel="prefetch" href="/mark/assets/js/232.f6daa645.js"><link rel="prefetch" href="/mark/assets/js/233.43e6b82f.js"><link rel="prefetch" href="/mark/assets/js/234.e52aecc8.js"><link rel="prefetch" href="/mark/assets/js/235.d1683347.js"><link rel="prefetch" href="/mark/assets/js/236.e45e5c7d.js"><link rel="prefetch" href="/mark/assets/js/237.9c65c5b9.js"><link rel="prefetch" href="/mark/assets/js/238.d6f0804a.js"><link rel="prefetch" href="/mark/assets/js/239.4b956bd9.js"><link rel="prefetch" href="/mark/assets/js/24.abe0e260.js"><link rel="prefetch" href="/mark/assets/js/240.3019d534.js"><link rel="prefetch" href="/mark/assets/js/241.6c51d01b.js"><link rel="prefetch" href="/mark/assets/js/242.2a754068.js"><link rel="prefetch" href="/mark/assets/js/243.feb3cc1d.js"><link rel="prefetch" href="/mark/assets/js/244.7290a6ce.js"><link rel="prefetch" href="/mark/assets/js/245.215398bb.js"><link rel="prefetch" href="/mark/assets/js/246.9b0896c0.js"><link rel="prefetch" href="/mark/assets/js/247.4d398ea3.js"><link rel="prefetch" href="/mark/assets/js/248.049e8ea8.js"><link rel="prefetch" href="/mark/assets/js/249.6bc6ac30.js"><link rel="prefetch" href="/mark/assets/js/25.68c4fe7a.js"><link rel="prefetch" href="/mark/assets/js/250.330488f0.js"><link rel="prefetch" href="/mark/assets/js/251.b75132bf.js"><link rel="prefetch" href="/mark/assets/js/252.18bb23c9.js"><link rel="prefetch" href="/mark/assets/js/254.04f08822.js"><link rel="prefetch" href="/mark/assets/js/255.5b393009.js"><link rel="prefetch" href="/mark/assets/js/256.2c79d4fa.js"><link rel="prefetch" href="/mark/assets/js/257.644acbb2.js"><link rel="prefetch" href="/mark/assets/js/258.4c00d685.js"><link rel="prefetch" href="/mark/assets/js/259.05c3992d.js"><link rel="prefetch" href="/mark/assets/js/26.2fb8fed9.js"><link rel="prefetch" href="/mark/assets/js/260.4693507e.js"><link rel="prefetch" href="/mark/assets/js/261.7c32ecee.js"><link rel="prefetch" href="/mark/assets/js/262.3f7e72b8.js"><link rel="prefetch" href="/mark/assets/js/263.c428cf3e.js"><link rel="prefetch" href="/mark/assets/js/264.4efe463d.js"><link rel="prefetch" href="/mark/assets/js/265.8a9bce95.js"><link rel="prefetch" href="/mark/assets/js/266.548ef0d7.js"><link rel="prefetch" href="/mark/assets/js/267.ae261c7a.js"><link rel="prefetch" href="/mark/assets/js/268.e41a2f78.js"><link rel="prefetch" href="/mark/assets/js/269.fd4c9a1f.js"><link rel="prefetch" href="/mark/assets/js/27.c2c9ed98.js"><link rel="prefetch" href="/mark/assets/js/270.29813a31.js"><link rel="prefetch" href="/mark/assets/js/271.3e888632.js"><link rel="prefetch" href="/mark/assets/js/28.726b3e12.js"><link rel="prefetch" href="/mark/assets/js/29.c009cb4a.js"><link rel="prefetch" href="/mark/assets/js/3.edaa3e28.js"><link rel="prefetch" href="/mark/assets/js/30.86a6504d.js"><link rel="prefetch" href="/mark/assets/js/31.249d2406.js"><link rel="prefetch" href="/mark/assets/js/32.4d8ac805.js"><link rel="prefetch" href="/mark/assets/js/33.d2b5486c.js"><link rel="prefetch" href="/mark/assets/js/34.e9abb0de.js"><link rel="prefetch" href="/mark/assets/js/35.293fec1a.js"><link rel="prefetch" href="/mark/assets/js/36.2b9c8a10.js"><link rel="prefetch" href="/mark/assets/js/37.43188c47.js"><link rel="prefetch" href="/mark/assets/js/38.5e021abe.js"><link rel="prefetch" href="/mark/assets/js/39.6e6890e3.js"><link rel="prefetch" href="/mark/assets/js/40.f862bba5.js"><link rel="prefetch" href="/mark/assets/js/41.319659f0.js"><link rel="prefetch" href="/mark/assets/js/42.a14f611f.js"><link rel="prefetch" href="/mark/assets/js/43.0a67294f.js"><link rel="prefetch" href="/mark/assets/js/44.292881ee.js"><link rel="prefetch" href="/mark/assets/js/45.453c93ac.js"><link rel="prefetch" href="/mark/assets/js/46.cee27d28.js"><link rel="prefetch" href="/mark/assets/js/47.c320d6f1.js"><link rel="prefetch" href="/mark/assets/js/48.0cadb284.js"><link rel="prefetch" href="/mark/assets/js/49.916f6ffa.js"><link rel="prefetch" href="/mark/assets/js/5.0410b920.js"><link rel="prefetch" href="/mark/assets/js/50.bfac1e92.js"><link rel="prefetch" href="/mark/assets/js/51.66b9efc0.js"><link rel="prefetch" href="/mark/assets/js/52.5e329f4e.js"><link rel="prefetch" href="/mark/assets/js/53.5ebb3dc1.js"><link rel="prefetch" href="/mark/assets/js/54.fbd82a72.js"><link rel="prefetch" href="/mark/assets/js/55.5a5041e1.js"><link rel="prefetch" href="/mark/assets/js/56.9918d1db.js"><link rel="prefetch" href="/mark/assets/js/57.4f73916d.js"><link rel="prefetch" href="/mark/assets/js/58.274313f1.js"><link rel="prefetch" href="/mark/assets/js/59.e60a271d.js"><link rel="prefetch" href="/mark/assets/js/6.51b4a227.js"><link rel="prefetch" href="/mark/assets/js/60.4d884e9e.js"><link rel="prefetch" href="/mark/assets/js/61.290db17e.js"><link rel="prefetch" href="/mark/assets/js/62.eb490a45.js"><link rel="prefetch" href="/mark/assets/js/63.90140437.js"><link rel="prefetch" href="/mark/assets/js/64.36c3468b.js"><link rel="prefetch" href="/mark/assets/js/65.81a6fc53.js"><link rel="prefetch" href="/mark/assets/js/66.f2ae1459.js"><link rel="prefetch" href="/mark/assets/js/67.b689ddf8.js"><link rel="prefetch" href="/mark/assets/js/68.9b0bd217.js"><link rel="prefetch" href="/mark/assets/js/69.0a32bc88.js"><link rel="prefetch" href="/mark/assets/js/7.6b95ce54.js"><link rel="prefetch" href="/mark/assets/js/70.9e738877.js"><link rel="prefetch" href="/mark/assets/js/71.d0399199.js"><link rel="prefetch" href="/mark/assets/js/72.305dff09.js"><link rel="prefetch" href="/mark/assets/js/73.c7ea3366.js"><link rel="prefetch" href="/mark/assets/js/74.8541b699.js"><link rel="prefetch" href="/mark/assets/js/75.8d2d5a69.js"><link rel="prefetch" href="/mark/assets/js/76.908be437.js"><link rel="prefetch" href="/mark/assets/js/77.49c880ae.js"><link rel="prefetch" href="/mark/assets/js/78.2b665a75.js"><link rel="prefetch" href="/mark/assets/js/79.6619e251.js"><link rel="prefetch" href="/mark/assets/js/8.5269bfb0.js"><link rel="prefetch" href="/mark/assets/js/80.dd76b16b.js"><link rel="prefetch" href="/mark/assets/js/81.9b506b79.js"><link rel="prefetch" href="/mark/assets/js/82.da202056.js"><link rel="prefetch" href="/mark/assets/js/83.e4c3af2e.js"><link rel="prefetch" href="/mark/assets/js/84.fedc555d.js"><link rel="prefetch" href="/mark/assets/js/85.d1c0f6ce.js"><link rel="prefetch" href="/mark/assets/js/86.d8a6611e.js"><link rel="prefetch" href="/mark/assets/js/87.9e776c7f.js"><link rel="prefetch" href="/mark/assets/js/88.8bf04bdb.js"><link rel="prefetch" href="/mark/assets/js/89.c63b2465.js"><link rel="prefetch" href="/mark/assets/js/9.6dad4f93.js"><link rel="prefetch" href="/mark/assets/js/90.30f588d5.js"><link rel="prefetch" href="/mark/assets/js/91.35beaee2.js"><link rel="prefetch" href="/mark/assets/js/92.e92b7a91.js"><link rel="prefetch" href="/mark/assets/js/93.61e0fa8f.js"><link rel="prefetch" href="/mark/assets/js/94.a3f251b1.js"><link rel="prefetch" href="/mark/assets/js/95.59c4f76b.js"><link rel="prefetch" href="/mark/assets/js/96.9d5c426f.js"><link rel="prefetch" href="/mark/assets/js/97.39fd9dfd.js"><link rel="prefetch" href="/mark/assets/js/98.227620d6.js"><link rel="prefetch" href="/mark/assets/js/99.4dfc8edd.js">
    <link rel="stylesheet" href="/mark/assets/css/0.styles.bb82d616.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mark/" class="home-link router-link-active"><img src="/mark/mlogo.svg" alt="Mark" class="logo"> <span class="site-name can-hide">Mark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link router-link-active">
  突击
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/zq99299/note-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link router-link-active">
  突击
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/zq99299/note-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>突击</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mark/q&amp;a/tuji/MySQL分库分表.html" class="sidebar-link">1 为什么要分库分表</a></li><li><a href="/mark/q&amp;a/tuji/分布式事务解决方案.html" class="sidebar-link">1 CAP 定理</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(02) - Redis如何通过读写分离来承载读请求QPS超过10万.html" class="sidebar-link">1 Redis高并发跟整个系统的高并发之间的关系</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(06)-如何保证消息队列的高可用性.html" class="sidebar-link">0  Github</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(8)-MQ的数据去哪了.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(9)-如何保证消息队列的顺序性.html" class="sidebar-link">0 Github</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(11)-你怎么设计一个消息队列.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(19) - 分布式缓存的第一个问题.html" class="sidebar-link">1   项目中如何使用缓存的？</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(23-9) - 深入解析Redis哨兵底层原理.html" class="sidebar-link">1 sdown和odown转换机制</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html" class="active sidebar-link">1 面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_5-1-基础通信原理" class="sidebar-link">5.1 基础通信原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_5-1-1-集中式" class="sidebar-link">5.1.1 集中式</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_5-1-2-gossip协议" class="sidebar-link">5.1.2 gossip协议</a></li></ul></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-1-基于重定向的客户端" class="sidebar-link">6.1 基于重定向的客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-1-1-请求重定向" class="sidebar-link">6.1.1 请求重定向</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-1-2-计算hash-slot" class="sidebar-link">6.1.2 计算hash slot</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-1-3-hash-slot查找" class="sidebar-link">6.1.3 hash slot查找</a></li></ul></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-2-smart-jedis" class="sidebar-link">6.2 smart jedis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-2-1-什么是smart-jedis" class="sidebar-link">6.2.1 什么是smart jedis</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-2-2-jediscluster的工作原理" class="sidebar-link">6.2.2 JedisCluster的工作原理</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_6-2-3-hashslot迁移和ask重定向" class="sidebar-link">6.2.3 hashslot迁移和ask重定向</a></li></ul></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_7-1-判断节点宕机" class="sidebar-link">7.1 判断节点宕机</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_7-2-从节点过滤" class="sidebar-link">7.2 从节点过滤</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_7-3-从节点选举" class="sidebar-link">7.3 从节点选举</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#_7-4-与哨兵比较" class="sidebar-link">7.4 与哨兵比较</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#java交流群" class="sidebar-link">Java交流群</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#博客" class="sidebar-link">博客</a></li><li class="sidebar-sub-header"><a href="/mark/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.html#github" class="sidebar-link">Github</a></li></ul></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(29) - 生产环境的redis集群的部署架构是怎么样的.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(32)-为什么要把系统拆分成分布式的？为啥要用dubbo.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(33)-Dubbo的工作原理.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(35)-Dubbo负载均衡及动态代理的策略.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(37)-基于Dubbo的服务治理、服务降级以及重试.html" class="sidebar-link">1 服务治理</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(38)-分布式服务接口的幂等性.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(40)-如何设计一个类似Dubbo的RPC框架.html" class="sidebar-link">0  Github</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(41)-ZooKeeper的适用场景.html" class="sidebar-link">0  Github</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(42) - Redis &amp; ZooKeeper两种分布式锁实现的优劣.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(43)-分布式Session方案的实现.html" class="sidebar-link">1 面试题</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(45)-设计一个高并发系统.html" class="sidebar-link">/q&amp;a/tuji/突破Java面试(45)-设计一个高并发系统.html</a></li><li><a href="/mark/q&amp;a/tuji/突破Java面试(47)-分库分表的实践.html" class="sidebar-link">1 面试题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content__default"><h1 id="_1-面试题"><a href="#_1-面试题" class="header-anchor">#</a> 1 面试题</h1> <p>Redis集群模式的工作原理说一下？在集群模式下，key是如何寻址的？寻址都有哪些算法？了解一致性hash吗？</p> <h1 id="_2-考点分析"><a href="#_2-考点分析" class="header-anchor">#</a> 2 考点分析</h1> <p>Redis不断在发展-Redis cluster集群模式，可以做到在多台机器上，部署多个实例，每个实例存储一部分的数据，同时每个实例可以带上Redis从实例，自动确保说，如果Redis主实例挂了，会自动切换到redis从实例顶上来。</p> <p>现在新版本，大家都是用Redis cluster的，也就是原生支持的集群模式，那么面试官肯定会就redis cluster对你来个几连炮。要是你没用过redis cluster，正常，以前很多人用codis之类的客户端来支持集群，但是起码你得研究一下redis cluster</p> <h1 id="_3-redis如何在保持读写分离-高可用的架构下-还能横向扩容支撑1t-海量数据"><a href="#_3-redis如何在保持读写分离-高可用的架构下-还能横向扩容支撑1t-海量数据" class="header-anchor">#</a> 3 Redis如何在保持读写分离+高可用的架构下，还能横向扩容支撑1T+海量数据</h1> <ul><li>redis单master架构的容量的瓶颈问题
<img src="https://ask.qcloudimg.com/http-save/1752328/hosq404j9q.png" alt=""></li> <li>redis如何通过master横向扩容支撑1T+数据量<img src="https://ask.qcloudimg.com/http-save/1752328/6yjg1upzbi.png" alt=""></li></ul> <h1 id="_3-数据分布算法-hash-一致性hash-redis-cluster的hash-slot"><a href="#_3-数据分布算法-hash-一致性hash-redis-cluster的hash-slot" class="header-anchor">#</a> 3 数据分布算法：hash+一致性hash+redis cluster的hash slot</h1> <p>讲解分布式数据存储的核心算法，数据分布的算法</p> <p>hash算法 -&gt; 一致性hash算法（memcached） -&gt; redis cluster，hash slot算法</p> <p>用不同的算法，就决定了在多个master节点的时候，数据如何分布到这些节点上去，解决这个问题</p> <h1 id="_4-redis-cluster"><a href="#_4-redis-cluster" class="header-anchor">#</a> 4 Redis cluster</h1> <ul><li>自动将数据分片，每个master上放一部分数据</li> <li>提供内置的高可用支持，部分master不可用时，还可继续工作</li></ul> <p>在Redis cluster架构下，每个Redis要开放两个端口，比如一个是6379，另外一个就是加10000的端口号，比如16379</p> <p>16379端口用于节点间通信，也就是cluster bus集群总线</p> <p>cluster bus的通信，用来故障检测，配置更新，故障转移授权</p> <p>cluster bus用了另外一种二进制的协议 - gossip，主要用于节点间高效的数据交换，占用更少的网络带宽和处理时间</p> <ul><li>最老土的hash算法和弊端（大量缓存重建）
<img src="https://ask.qcloudimg.com/http-save/1752328/1i0opt2jo7.png" alt=""></li></ul> <p>3、一致性hash算法（自动缓存迁移）+虚拟节点（自动负载均衡）</p> <ul><li>一致性hash算法的讲解和优点
<img src="https://ask.qcloudimg.com/http-save/1752328/13nksjkgat.png" alt=""></li> <li>一致性hash算法的虚拟节点实现负载均衡
<img src="https://ask.qcloudimg.com/http-save/1752328/gos1u9fp10.png" alt=""></li></ul> <p>4、redis cluster的hash slot算法</p> <p><img src="https://ask.qcloudimg.com/http-save/1752328/3df7rwuplp.png" alt=""></p> <p>redis cluster有固定的16384个hash slot，对每个key计算CRC16值，然后对16384取模，可以获取key对应的hash slot</p> <p>redis cluster中每个master都会持有部分slot，比如有3个master，那么可能每个master持有5000多个hash slot</p> <p>hash slot让node的增加和移除很简单，增加一个master，就将其他master的hash slot移动部分过去，减少一个master，就将它的hash slot移动到其他master上去</p> <p>移动hash slot的成本是非常低的</p> <p>客户端的api，可以对指定的数据，让他们走同一个hash slot，通过hash tag来实现</p> <h1 id="_5-节点间的内部通信机制"><a href="#_5-节点间的内部通信机制" class="header-anchor">#</a> 5 节点间的内部通信机制</h1> <h2 id="_5-1-基础通信原理"><a href="#_5-1-基础通信原理" class="header-anchor">#</a> 5.1 基础通信原理</h2> <p>用于维护集群的元数据</p> <h3 id="_5-1-1-集中式"><a href="#_5-1-1-集中式" class="header-anchor">#</a> 5.1.1 集中式</h3> <ul><li>集中式的集群元数据存储和维护
<img src="https://ask.qcloudimg.com/http-save/1752328/xejh8tb52v.png" alt=""> <strong>将集群元数据（节点信息，故障等）集中存储在某个节点</strong></li> <li>优点
元数据的更新和读取，时效性好，一旦元数据出现变更，立即更新到集中式的存储中，其他节点读取时立即就可感知</li> <li>缺点
所有的元数据的跟新压力全部集中在一个地方，可能会导致元数据的存储有压力</li></ul> <p>Redis cluster节点间采取的另一种称为gossip的协议</p> <p>互相之间不断通信，保持整个集群所有节点的数据是完整的</p> <p>gossip：好处在于，元数据的更新比较分散，不是集中在一个地方，更新请求会陆陆续续，打到所有节点上去更新，有一定的延时，降低了压力; 缺点，元数据更新有延时，可能导致集群的一些操作会有一些滞后</p> <p>我们刚才做reshard，去做另外一个操作，会发现说，configuration error，达成一致</p> <p>（2）10000端口</p> <p>每个节点都有一个专门用于节点间通信的端口，就是自己提供服务的端口号+10000，比如7001，那么用于节点间通信的就是17001端口</p> <p>每隔节点每隔一段时间都会往另外几个节点发送ping消息，同时其他几点接收到ping之后返回pong</p> <p>（3）交换的信息</p> <p>故障信息，节点的增加和移除，hash slot信息，等等</p> <h3 id="_5-1-2-gossip协议"><a href="#_5-1-2-gossip协议" class="header-anchor">#</a> 5.1.2 gossip协议</h3> <ul><li>gossip协议维护集群元数据
<img src="https://ask.qcloudimg.com/http-save/1752328/1dfycf9xrp.png" alt="">
协议包含多种消息</li></ul> <h4 id="meet"><a href="#meet" class="header-anchor">#</a> meet</h4> <p>某节点发送meet给新加入的节点，让新节点加入集群，然后新节点就会开始与其他节点通信</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>redis-trib.rb add-node
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其实内部就是发送了一个gossip meet消息给新节点，通知该节点加入集群</p> <h4 id="ping"><a href="#ping" class="header-anchor">#</a> ping</h4> <p>每个节点都会频繁给其他节点发ping，其中包含自己的状态还有自己维护的集群元数据，互相通过ping交换元数据</p> <p>ping很频繁，而且要携带一些元数据，可能会加重网络的负担</p> <p>每个节点每s会执行10次ping，每次会选择5个最久没有通信的其他节点。当然如果发现某个节点通信延时达到了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cluster_node_timeout / 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么立即发送ping，避免数据交换延时过长，落后的时间太长了。比如说，两节点之间已经10分钟没有交换数据，那么整个集群处于严重的元数据不一致的情况，就会有问题。所以<code>cluster_node_timeout</code>可以调节，如果调节比较大，那么会降低发送频率</p> <p>每次ping，一个是带上自己节点的信息，还有就是带上1/10其他节点的信息，发送出去，进行数据交换。至少包含3个其他节点的信息，最多包含总节点-2个其他节点的信息</p> <h4 id="pong"><a href="#pong" class="header-anchor">#</a> pong</h4> <p>返回ping和meet，包含自己的状态和其他信息，也可用于信息广播和更新</p> <h4 id="fail"><a href="#fail" class="header-anchor">#</a> fail</h4> <p>某个节点判断另一个节点fail后，就发送fail给其他节点，通知其他节点，指定的节点宕机啦！</p> <h1 id="_6-面向集群的jedis内部实现原理"><a href="#_6-面向集群的jedis内部实现原理" class="header-anchor">#</a> 6 面向集群的Jedis内部实现原理</h1> <p>开发Jedis，Redis的Java客户端</p> <p>jedis cluster api与redis cluster集群交互的一些基本原理</p> <h2 id="_6-1-基于重定向的客户端"><a href="#_6-1-基于重定向的客户端" class="header-anchor">#</a> 6.1 基于重定向的客户端</h2> <p>redis-cli -c，自动重定向</p> <h3 id="_6-1-1-请求重定向"><a href="#_6-1-1-请求重定向" class="header-anchor">#</a> 6.1.1 请求重定向</h3> <p>客户端可能会挑选任意一个Redis实例去发送命令，每个实例接收到命令，都会计算key对应的hash slot</p> <p>若在本地就在本地处理，否则返回moved给客户端，让客户端重定向</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cluster keyslot mykey
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可查看一个key对应的hash slot是什么</p> <p>用redis-cli的时候，可加入<code>-c</code>参数，支持自动的请求重定向，redis-cli接收到moved之后，会自动重定向到对应的节点执行命令</p> <h3 id="_6-1-2-计算hash-slot"><a href="#_6-1-2-计算hash-slot" class="header-anchor">#</a> 6.1.2 计算hash slot</h3> <p>计算hash slot的算法，就是根据key计算CRC16值，然后对16384取模，拿到对应的hash slot</p> <p>用hash tag可以手动指定key对应的slot，同一个hash tag下的key，都会在一个hash slot中，比如set mykey1:{100}和set mykey2:{100}</p> <h3 id="_6-1-3-hash-slot查找"><a href="#_6-1-3-hash-slot查找" class="header-anchor">#</a> 6.1.3 hash slot查找</h3> <p>节点间通过gossip协议数据交换，就知道每个hash slot在哪个节点上</p> <h2 id="_6-2-smart-jedis"><a href="#_6-2-smart-jedis" class="header-anchor">#</a> 6.2 smart jedis</h2> <h3 id="_6-2-1-什么是smart-jedis"><a href="#_6-2-1-什么是smart-jedis" class="header-anchor">#</a> 6.2.1 什么是smart jedis</h3> <p>基于重定向的客户端，很消耗网络IO，因为大部分情况下，可能都会出现一次请求重定向，才能找到正确的节点</p> <p>所以大部分的客户端，比如java redis客户端，就是jedis，都是smart的</p> <p>本地维护一份hashslot -&gt; node的映射表，缓存，大部分情况下，直接走本地缓存就可以找到hashslot -&gt; node，不需要通过节点进行moved重定向</p> <h3 id="_6-2-2-jediscluster的工作原理"><a href="#_6-2-2-jediscluster的工作原理" class="header-anchor">#</a> 6.2.2 JedisCluster的工作原理</h3> <p>在JedisCluster初始化的时候，就会随机选择一个node，初始化hashslot -&gt; node映射表，同时为每个节点创建一个JedisPool连接池</p> <p>每次基于JedisCluster执行操作，首先JedisCluster都会在本地计算key的hashslot，然后在本地映射表找到对应的节点</p> <p>如果那个node正好还是持有那个hashslot，那么就ok; 如果说进行了reshard这样的操作，可能hashslot已经不在那个node上了，就会返回moved</p> <p>如果JedisCluter API发现对应的节点返回moved，那么利用该节点的元数据，更新本地的hashslot -&gt; node映射表缓存</p> <p>重复上面几个步骤，直到找到对应的节点，如果重试超过5次，那么就报错，JedisClusterMaxRedirectionException</p> <p>jedis老版本，可能会出现在集群某个节点故障还没完成自动切换恢复时，频繁更新hash slot，频繁ping节点检查活跃，导致大量网络IO开销</p> <p>jedis最新版本，对于这些过度的hash slot更新和ping，都进行了优化，避免了类似问题</p> <h3 id="_6-2-3-hashslot迁移和ask重定向"><a href="#_6-2-3-hashslot迁移和ask重定向" class="header-anchor">#</a> 6.2.3 hashslot迁移和ask重定向</h3> <p>如果hash slot正在迁移，那么会返回ask重定向给jedis</p> <p>jedis接收到ask重定向之后，会重新定位到目标节点去执行，但是因为ask发生在hash slot迁移过程中，所以JedisCluster API收到ask是不会更新hashslot本地缓存</p> <p>已经可以确定说，hashslot已经迁移完了，moved是会更新本地hashslot-&gt;node映射表缓存的</p> <h1 id="_7-高可用性与主备切换原理"><a href="#_7-高可用性与主备切换原理" class="header-anchor">#</a> 7 高可用性与主备切换原理</h1> <p>原理，几乎跟哨兵类似</p> <h2 id="_7-1-判断节点宕机"><a href="#_7-1-判断节点宕机" class="header-anchor">#</a> 7.1 判断节点宕机</h2> <p>若一个节点认为另外一个节点宕机，即<code>pfail</code> - 主观宕机</p> <p>若多个节点都认为另外一个节点宕机，即<code>fail</code> - 客观宕机</p> <p>跟哨兵的原理几乎一样，sdown - odown</p> <p>在<code>cluster-node-timeout</code>内，某个节点一直没有返回<code>pong</code>，那么就被认为<code>pfail</code></p> <p>若一个节点认为某个节点<code>pfail</code>，那么会在<code>gossip ping</code>消息中，<code>ping</code>给其他节点，若<strong>超过半数</strong>的节点都认为<code>pfail</code>，那么就会变成<code>fail</code></p> <h2 id="_7-2-从节点过滤"><a href="#_7-2-从节点过滤" class="header-anchor">#</a> 7.2 从节点过滤</h2> <p>对宕机的master node，从其所有的slave node中，选择一个切换成master node</p> <p>检查每个slave node与master node断开连接的时间，如果超过了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cluster-node-timeout * cluster-slave-validity-factor
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么就没有资格切换成master，这个也跟哨兵是一样的，从节点超时过滤的步骤</p> <h2 id="_7-3-从节点选举"><a href="#_7-3-从节点选举" class="header-anchor">#</a> 7.3 从节点选举</h2> <blockquote><p>哨兵：对所有从节点进行排序，slave priority，offset，run id</p></blockquote> <p>每个从节点，都根据自己对master复制数据的offset，设置一个选举时间，offset越大（复制数据越多）的从节点，选举时间越靠前，优先进行选举</p> <p>所有的master node开始slave选举投票，给要选举的slave投票，如果大部分</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>master node（N/2 + 1）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>都投票给了某从节点，那么选举通过，该从节点可以切换成master</p> <p>从节点执行主备切换，从节点切换为主节点</p> <h2 id="_7-4-与哨兵比较"><a href="#_7-4-与哨兵比较" class="header-anchor">#</a> 7.4 与哨兵比较</h2> <p>整个流程跟哨兵相比，非常类似，所以说，redis cluster功能强大，直接集成了replication和sentinal的功能</p> <h1 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h1> <p>《Java工程师面试突击第1季-中华石杉老师》</p> <h1 id="x-交流学习"><a href="#x-交流学习" class="header-anchor">#</a> X 交流学习</h1> <p><img src="https://img-blog.csdnimg.cn/20190504005601174.jpg" alt=""></p> <h2 id="java交流群"><a href="#java交流群" class="header-anchor">#</a> <a href="https://jq.qq.com/?_wv=1027&amp;k=5UB4P1T" target="_blank" rel="noopener noreferrer">Java交流群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <h2 id="博客"><a href="#博客" class="header-anchor">#</a> <a href="https://blog.csdn.net/qq_33589510" target="_blank" rel="noopener noreferrer">博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <h2 id="github"><a href="#github" class="header-anchor">#</a> <a href="https://github.com/Wasabi1234" target="_blank" rel="noopener noreferrer">Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/note-book/edit/master/docs/q&amp;a/tuji/突破Java面试(25) - Redis cluster集群模式的原理.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-01-04 17:14:56</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mark/q&amp;a/tuji/突破Java面试(23-9) - 深入解析Redis哨兵底层原理.html" class="prev">
        1 sdown和odown转换机制
      </a></span> <span class="next"><a href="/mark/q&amp;a/tuji/突破Java面试(29) - 生产环境的redis集群的部署架构是怎么样的.html">
        1 面试题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mark/assets/js/app.e4c063e1.js" defer></script><script src="/mark/assets/js/2.306dea3c.js" defer></script><script src="/mark/assets/js/253.5c87349e.js" defer></script><script src="/mark/assets/js/4.c54fd058.js" defer></script>
  </body>
</html>

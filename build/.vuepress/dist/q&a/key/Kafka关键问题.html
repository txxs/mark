<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mark</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/mark/mlogo.svg">
    <link rel="manifest" href="/mark/manifest.json">
    <meta name="description" content="本博客主要是用来记录系统化的知识，内容部分来自github上的其他开源仓库，如有问题联系sdlyjhm01@sina.com">
    
    <link rel="preload" href="/mark/assets/css/0.styles.b8afb793.css" as="style"><link rel="preload" href="/mark/assets/js/app.2dbe1734.js" as="script"><link rel="preload" href="/mark/assets/js/2.9796e7dc.js" as="script"><link rel="preload" href="/mark/assets/js/231.eab10621.js" as="script"><link rel="preload" href="/mark/assets/js/4.70c6b853.js" as="script"><link rel="prefetch" href="/mark/assets/js/10.df3cf319.js"><link rel="prefetch" href="/mark/assets/js/100.f072fb4c.js"><link rel="prefetch" href="/mark/assets/js/101.f7067152.js"><link rel="prefetch" href="/mark/assets/js/102.2f564774.js"><link rel="prefetch" href="/mark/assets/js/103.0833de4e.js"><link rel="prefetch" href="/mark/assets/js/104.fa4d8cec.js"><link rel="prefetch" href="/mark/assets/js/105.17b344cf.js"><link rel="prefetch" href="/mark/assets/js/106.cfff8dda.js"><link rel="prefetch" href="/mark/assets/js/107.13608aab.js"><link rel="prefetch" href="/mark/assets/js/108.8c423eb7.js"><link rel="prefetch" href="/mark/assets/js/109.238e1dca.js"><link rel="prefetch" href="/mark/assets/js/11.80b654ab.js"><link rel="prefetch" href="/mark/assets/js/110.a1830cac.js"><link rel="prefetch" href="/mark/assets/js/111.e9dabbff.js"><link rel="prefetch" href="/mark/assets/js/112.3a900401.js"><link rel="prefetch" href="/mark/assets/js/113.24635129.js"><link rel="prefetch" href="/mark/assets/js/114.8fc77473.js"><link rel="prefetch" href="/mark/assets/js/115.b4131249.js"><link rel="prefetch" href="/mark/assets/js/116.b0cfd3ac.js"><link rel="prefetch" href="/mark/assets/js/117.0bff6f69.js"><link rel="prefetch" href="/mark/assets/js/118.d9a1678f.js"><link rel="prefetch" href="/mark/assets/js/119.360d7624.js"><link rel="prefetch" href="/mark/assets/js/12.d9300b0f.js"><link rel="prefetch" href="/mark/assets/js/120.c15995b4.js"><link rel="prefetch" href="/mark/assets/js/121.1b93b7ab.js"><link rel="prefetch" href="/mark/assets/js/122.ab535412.js"><link rel="prefetch" href="/mark/assets/js/123.b8cd1ef4.js"><link rel="prefetch" href="/mark/assets/js/124.34d446e2.js"><link rel="prefetch" href="/mark/assets/js/125.2b2df1dd.js"><link rel="prefetch" href="/mark/assets/js/126.8eb36919.js"><link rel="prefetch" href="/mark/assets/js/127.91c34bee.js"><link rel="prefetch" href="/mark/assets/js/128.1034875f.js"><link rel="prefetch" href="/mark/assets/js/129.a682626b.js"><link rel="prefetch" href="/mark/assets/js/13.ca3fb9d7.js"><link rel="prefetch" href="/mark/assets/js/130.c42eab83.js"><link rel="prefetch" href="/mark/assets/js/131.cceee9e2.js"><link rel="prefetch" href="/mark/assets/js/132.f16fd5fb.js"><link rel="prefetch" href="/mark/assets/js/133.31b4aa08.js"><link rel="prefetch" href="/mark/assets/js/134.6c236b05.js"><link rel="prefetch" href="/mark/assets/js/135.97372458.js"><link rel="prefetch" href="/mark/assets/js/136.7e090491.js"><link rel="prefetch" href="/mark/assets/js/137.67730076.js"><link rel="prefetch" href="/mark/assets/js/138.d8c65801.js"><link rel="prefetch" href="/mark/assets/js/139.2f99ff7e.js"><link rel="prefetch" href="/mark/assets/js/14.10dd5868.js"><link rel="prefetch" href="/mark/assets/js/140.3b645a3e.js"><link rel="prefetch" href="/mark/assets/js/141.712afbb7.js"><link rel="prefetch" href="/mark/assets/js/142.17c6987d.js"><link rel="prefetch" href="/mark/assets/js/143.5b78829e.js"><link rel="prefetch" href="/mark/assets/js/144.e0d7b8fa.js"><link rel="prefetch" href="/mark/assets/js/145.06e7df05.js"><link rel="prefetch" href="/mark/assets/js/146.1fc2cd42.js"><link rel="prefetch" href="/mark/assets/js/147.6eb84780.js"><link rel="prefetch" href="/mark/assets/js/148.9996b3e4.js"><link rel="prefetch" href="/mark/assets/js/149.55ddabca.js"><link rel="prefetch" href="/mark/assets/js/15.82e082d5.js"><link rel="prefetch" href="/mark/assets/js/150.58feda5b.js"><link rel="prefetch" href="/mark/assets/js/151.96c562cb.js"><link rel="prefetch" href="/mark/assets/js/152.70dc45be.js"><link rel="prefetch" href="/mark/assets/js/153.b79e6a8b.js"><link rel="prefetch" href="/mark/assets/js/154.eddb4064.js"><link rel="prefetch" href="/mark/assets/js/155.d60d7566.js"><link rel="prefetch" href="/mark/assets/js/156.236533c2.js"><link rel="prefetch" href="/mark/assets/js/157.9ec45825.js"><link rel="prefetch" href="/mark/assets/js/158.0e1f8c13.js"><link rel="prefetch" href="/mark/assets/js/159.c4ed63f7.js"><link rel="prefetch" href="/mark/assets/js/16.f8933712.js"><link rel="prefetch" href="/mark/assets/js/160.81d0914a.js"><link rel="prefetch" href="/mark/assets/js/161.da504c35.js"><link rel="prefetch" href="/mark/assets/js/162.0dd7b6ad.js"><link rel="prefetch" href="/mark/assets/js/163.b2d017d3.js"><link rel="prefetch" href="/mark/assets/js/164.69825b4d.js"><link rel="prefetch" href="/mark/assets/js/165.aa065894.js"><link rel="prefetch" href="/mark/assets/js/166.cceac3ee.js"><link rel="prefetch" href="/mark/assets/js/167.9f6db258.js"><link rel="prefetch" href="/mark/assets/js/168.f1b71141.js"><link rel="prefetch" href="/mark/assets/js/169.eccd32dc.js"><link rel="prefetch" href="/mark/assets/js/17.1147e9c7.js"><link rel="prefetch" href="/mark/assets/js/170.f64a91c1.js"><link rel="prefetch" href="/mark/assets/js/171.511f24c9.js"><link rel="prefetch" href="/mark/assets/js/172.98326d74.js"><link rel="prefetch" href="/mark/assets/js/173.fc4affbb.js"><link rel="prefetch" href="/mark/assets/js/174.4c1d9d38.js"><link rel="prefetch" href="/mark/assets/js/175.5de95aae.js"><link rel="prefetch" href="/mark/assets/js/176.6d3554fc.js"><link rel="prefetch" href="/mark/assets/js/177.e4018046.js"><link rel="prefetch" href="/mark/assets/js/178.1937bbe2.js"><link rel="prefetch" href="/mark/assets/js/179.1a6a712d.js"><link rel="prefetch" href="/mark/assets/js/18.5fe91a14.js"><link rel="prefetch" href="/mark/assets/js/180.0bf90d52.js"><link rel="prefetch" href="/mark/assets/js/181.584ec0c3.js"><link rel="prefetch" href="/mark/assets/js/182.f4c3a2f3.js"><link rel="prefetch" href="/mark/assets/js/183.e4c7f14b.js"><link rel="prefetch" href="/mark/assets/js/184.ad1758ac.js"><link rel="prefetch" href="/mark/assets/js/185.0d7c97fb.js"><link rel="prefetch" href="/mark/assets/js/186.cdf4227e.js"><link rel="prefetch" href="/mark/assets/js/187.b670917b.js"><link rel="prefetch" href="/mark/assets/js/188.9807b51e.js"><link rel="prefetch" href="/mark/assets/js/189.b8753c71.js"><link rel="prefetch" href="/mark/assets/js/19.e9b1dcfd.js"><link rel="prefetch" href="/mark/assets/js/190.2dee9d57.js"><link rel="prefetch" href="/mark/assets/js/191.f88a6409.js"><link rel="prefetch" href="/mark/assets/js/192.5dc26a17.js"><link rel="prefetch" href="/mark/assets/js/193.9494c593.js"><link rel="prefetch" href="/mark/assets/js/194.bcc3b6ac.js"><link rel="prefetch" href="/mark/assets/js/195.2ea1ab22.js"><link rel="prefetch" href="/mark/assets/js/196.9650acd0.js"><link rel="prefetch" href="/mark/assets/js/197.c48967ed.js"><link rel="prefetch" href="/mark/assets/js/198.328d5a76.js"><link rel="prefetch" href="/mark/assets/js/199.e08acaf4.js"><link rel="prefetch" href="/mark/assets/js/20.4f331f61.js"><link rel="prefetch" href="/mark/assets/js/200.5d3b2e68.js"><link rel="prefetch" href="/mark/assets/js/201.be29f7a2.js"><link rel="prefetch" href="/mark/assets/js/202.89ddebd9.js"><link rel="prefetch" href="/mark/assets/js/203.cb278cbf.js"><link rel="prefetch" href="/mark/assets/js/204.0b19e441.js"><link rel="prefetch" href="/mark/assets/js/205.584e246f.js"><link rel="prefetch" href="/mark/assets/js/206.856112d3.js"><link rel="prefetch" href="/mark/assets/js/207.f168e627.js"><link rel="prefetch" href="/mark/assets/js/208.cee4afc6.js"><link rel="prefetch" href="/mark/assets/js/209.1d14a25a.js"><link rel="prefetch" href="/mark/assets/js/21.c74f1424.js"><link rel="prefetch" href="/mark/assets/js/210.3904779c.js"><link rel="prefetch" href="/mark/assets/js/211.050ecc31.js"><link rel="prefetch" href="/mark/assets/js/212.2db0a90f.js"><link rel="prefetch" href="/mark/assets/js/213.95bd1ada.js"><link rel="prefetch" href="/mark/assets/js/214.983d47ef.js"><link rel="prefetch" href="/mark/assets/js/215.332dc047.js"><link rel="prefetch" href="/mark/assets/js/216.780ff20a.js"><link rel="prefetch" href="/mark/assets/js/217.3a6a8cd7.js"><link rel="prefetch" href="/mark/assets/js/218.9f20c81d.js"><link rel="prefetch" href="/mark/assets/js/219.b3b4b6f8.js"><link rel="prefetch" href="/mark/assets/js/22.373cd872.js"><link rel="prefetch" href="/mark/assets/js/220.00cd360f.js"><link rel="prefetch" href="/mark/assets/js/221.4e572d7f.js"><link rel="prefetch" href="/mark/assets/js/222.cca213d4.js"><link rel="prefetch" href="/mark/assets/js/223.3f341d66.js"><link rel="prefetch" href="/mark/assets/js/224.43f47500.js"><link rel="prefetch" href="/mark/assets/js/225.c131d933.js"><link rel="prefetch" href="/mark/assets/js/226.1ea0a360.js"><link rel="prefetch" href="/mark/assets/js/227.cb23c67b.js"><link rel="prefetch" href="/mark/assets/js/228.c64873fb.js"><link rel="prefetch" href="/mark/assets/js/229.928edced.js"><link rel="prefetch" href="/mark/assets/js/23.4333640f.js"><link rel="prefetch" href="/mark/assets/js/230.58966917.js"><link rel="prefetch" href="/mark/assets/js/232.da1441a7.js"><link rel="prefetch" href="/mark/assets/js/233.6c862d7e.js"><link rel="prefetch" href="/mark/assets/js/234.edebb47a.js"><link rel="prefetch" href="/mark/assets/js/235.fd5dd6e1.js"><link rel="prefetch" href="/mark/assets/js/236.211533ac.js"><link rel="prefetch" href="/mark/assets/js/237.2dce9ac0.js"><link rel="prefetch" href="/mark/assets/js/238.3cdef962.js"><link rel="prefetch" href="/mark/assets/js/239.82f57548.js"><link rel="prefetch" href="/mark/assets/js/24.8caf3f2b.js"><link rel="prefetch" href="/mark/assets/js/240.e9e45d9b.js"><link rel="prefetch" href="/mark/assets/js/241.bad2fa26.js"><link rel="prefetch" href="/mark/assets/js/242.4c1ceb9a.js"><link rel="prefetch" href="/mark/assets/js/243.c557c4e9.js"><link rel="prefetch" href="/mark/assets/js/244.49721017.js"><link rel="prefetch" href="/mark/assets/js/245.dcb2eb93.js"><link rel="prefetch" href="/mark/assets/js/246.d37c1ea9.js"><link rel="prefetch" href="/mark/assets/js/247.769ab20f.js"><link rel="prefetch" href="/mark/assets/js/248.8eb9f553.js"><link rel="prefetch" href="/mark/assets/js/249.185ea853.js"><link rel="prefetch" href="/mark/assets/js/25.d0d16b20.js"><link rel="prefetch" href="/mark/assets/js/250.cb04d14f.js"><link rel="prefetch" href="/mark/assets/js/251.6d8eff10.js"><link rel="prefetch" href="/mark/assets/js/252.018ad493.js"><link rel="prefetch" href="/mark/assets/js/253.1a0bd9d5.js"><link rel="prefetch" href="/mark/assets/js/254.7fe38823.js"><link rel="prefetch" href="/mark/assets/js/255.03695ec7.js"><link rel="prefetch" href="/mark/assets/js/256.535854ae.js"><link rel="prefetch" href="/mark/assets/js/257.822e0b2a.js"><link rel="prefetch" href="/mark/assets/js/258.a0bd43a5.js"><link rel="prefetch" href="/mark/assets/js/259.07c14f8b.js"><link rel="prefetch" href="/mark/assets/js/26.294be53b.js"><link rel="prefetch" href="/mark/assets/js/260.2ee2850d.js"><link rel="prefetch" href="/mark/assets/js/261.2998d0d7.js"><link rel="prefetch" href="/mark/assets/js/262.614ae1e1.js"><link rel="prefetch" href="/mark/assets/js/263.9b497ea8.js"><link rel="prefetch" href="/mark/assets/js/264.42326992.js"><link rel="prefetch" href="/mark/assets/js/265.b1fed4a3.js"><link rel="prefetch" href="/mark/assets/js/266.3a38458a.js"><link rel="prefetch" href="/mark/assets/js/267.a91c4a5f.js"><link rel="prefetch" href="/mark/assets/js/268.05feb517.js"><link rel="prefetch" href="/mark/assets/js/269.c60619b4.js"><link rel="prefetch" href="/mark/assets/js/27.eb7e8ff0.js"><link rel="prefetch" href="/mark/assets/js/270.d123bdb4.js"><link rel="prefetch" href="/mark/assets/js/271.8a571d6d.js"><link rel="prefetch" href="/mark/assets/js/272.2840a815.js"><link rel="prefetch" href="/mark/assets/js/273.10761184.js"><link rel="prefetch" href="/mark/assets/js/274.e62b4866.js"><link rel="prefetch" href="/mark/assets/js/275.1e6f0fcd.js"><link rel="prefetch" href="/mark/assets/js/276.5dfdd341.js"><link rel="prefetch" href="/mark/assets/js/277.1a6f6821.js"><link rel="prefetch" href="/mark/assets/js/278.23f55dac.js"><link rel="prefetch" href="/mark/assets/js/279.5b9facdd.js"><link rel="prefetch" href="/mark/assets/js/28.d637a557.js"><link rel="prefetch" href="/mark/assets/js/280.9b821466.js"><link rel="prefetch" href="/mark/assets/js/281.532af105.js"><link rel="prefetch" href="/mark/assets/js/282.c6a18938.js"><link rel="prefetch" href="/mark/assets/js/283.42cf3e72.js"><link rel="prefetch" href="/mark/assets/js/29.11cf275c.js"><link rel="prefetch" href="/mark/assets/js/3.d3cb6ecd.js"><link rel="prefetch" href="/mark/assets/js/30.3bf50f04.js"><link rel="prefetch" href="/mark/assets/js/31.98f1a2af.js"><link rel="prefetch" href="/mark/assets/js/32.fa63cd6c.js"><link rel="prefetch" href="/mark/assets/js/33.dad127c9.js"><link rel="prefetch" href="/mark/assets/js/34.b5cef715.js"><link rel="prefetch" href="/mark/assets/js/35.b5c65e52.js"><link rel="prefetch" href="/mark/assets/js/36.8156b993.js"><link rel="prefetch" href="/mark/assets/js/37.9fa50bcb.js"><link rel="prefetch" href="/mark/assets/js/38.c9ea75bc.js"><link rel="prefetch" href="/mark/assets/js/39.c314f4f6.js"><link rel="prefetch" href="/mark/assets/js/40.73d2d9e4.js"><link rel="prefetch" href="/mark/assets/js/41.f172bc1f.js"><link rel="prefetch" href="/mark/assets/js/42.c5a602b5.js"><link rel="prefetch" href="/mark/assets/js/43.0a67294f.js"><link rel="prefetch" href="/mark/assets/js/44.067ae635.js"><link rel="prefetch" href="/mark/assets/js/45.6b977bd3.js"><link rel="prefetch" href="/mark/assets/js/46.32b783a4.js"><link rel="prefetch" href="/mark/assets/js/47.67fffb22.js"><link rel="prefetch" href="/mark/assets/js/48.7b2aceb9.js"><link rel="prefetch" href="/mark/assets/js/49.c5f99bf0.js"><link rel="prefetch" href="/mark/assets/js/5.52acfc77.js"><link rel="prefetch" href="/mark/assets/js/50.cd0d5f3d.js"><link rel="prefetch" href="/mark/assets/js/51.c926b64c.js"><link rel="prefetch" href="/mark/assets/js/52.db63cdae.js"><link rel="prefetch" href="/mark/assets/js/53.38c41b64.js"><link rel="prefetch" href="/mark/assets/js/54.daeb58fa.js"><link rel="prefetch" href="/mark/assets/js/55.ceada84a.js"><link rel="prefetch" href="/mark/assets/js/56.ae880421.js"><link rel="prefetch" href="/mark/assets/js/57.057b84d1.js"><link rel="prefetch" href="/mark/assets/js/58.140c76ef.js"><link rel="prefetch" href="/mark/assets/js/59.d4e19796.js"><link rel="prefetch" href="/mark/assets/js/6.1f1ebd02.js"><link rel="prefetch" href="/mark/assets/js/60.71d095dc.js"><link rel="prefetch" href="/mark/assets/js/61.d07291f0.js"><link rel="prefetch" href="/mark/assets/js/62.89042103.js"><link rel="prefetch" href="/mark/assets/js/63.1738a846.js"><link rel="prefetch" href="/mark/assets/js/64.50593833.js"><link rel="prefetch" href="/mark/assets/js/65.9ab86a1d.js"><link rel="prefetch" href="/mark/assets/js/66.dc9c3227.js"><link rel="prefetch" href="/mark/assets/js/67.8c4b3654.js"><link rel="prefetch" href="/mark/assets/js/68.8000c397.js"><link rel="prefetch" href="/mark/assets/js/69.3247d5d4.js"><link rel="prefetch" href="/mark/assets/js/7.b5d2c498.js"><link rel="prefetch" href="/mark/assets/js/70.e429c940.js"><link rel="prefetch" href="/mark/assets/js/71.62ec38a8.js"><link rel="prefetch" href="/mark/assets/js/72.7622f36a.js"><link rel="prefetch" href="/mark/assets/js/73.565b560a.js"><link rel="prefetch" href="/mark/assets/js/74.a3e3ac23.js"><link rel="prefetch" href="/mark/assets/js/75.75f69430.js"><link rel="prefetch" href="/mark/assets/js/76.a2a09444.js"><link rel="prefetch" href="/mark/assets/js/77.031188d0.js"><link rel="prefetch" href="/mark/assets/js/78.b7935c10.js"><link rel="prefetch" href="/mark/assets/js/79.0c3eec6c.js"><link rel="prefetch" href="/mark/assets/js/8.929c879f.js"><link rel="prefetch" href="/mark/assets/js/80.3ac4a553.js"><link rel="prefetch" href="/mark/assets/js/81.9b506b79.js"><link rel="prefetch" href="/mark/assets/js/82.38f820f5.js"><link rel="prefetch" href="/mark/assets/js/83.420d43cc.js"><link rel="prefetch" href="/mark/assets/js/84.b76cd8d5.js"><link rel="prefetch" href="/mark/assets/js/85.b4995cef.js"><link rel="prefetch" href="/mark/assets/js/86.7f19c0d7.js"><link rel="prefetch" href="/mark/assets/js/87.05c5ed65.js"><link rel="prefetch" href="/mark/assets/js/88.37f737db.js"><link rel="prefetch" href="/mark/assets/js/89.19ae5b3e.js"><link rel="prefetch" href="/mark/assets/js/9.9d4021a1.js"><link rel="prefetch" href="/mark/assets/js/90.e398fbb8.js"><link rel="prefetch" href="/mark/assets/js/91.53cd9f73.js"><link rel="prefetch" href="/mark/assets/js/92.68ec96a6.js"><link rel="prefetch" href="/mark/assets/js/93.61e0fa8f.js"><link rel="prefetch" href="/mark/assets/js/94.40298b3a.js"><link rel="prefetch" href="/mark/assets/js/95.544b0da2.js"><link rel="prefetch" href="/mark/assets/js/96.a77f0130.js"><link rel="prefetch" href="/mark/assets/js/97.ee169531.js"><link rel="prefetch" href="/mark/assets/js/98.b733e74c.js"><link rel="prefetch" href="/mark/assets/js/99.8113b777.js">
    <link rel="stylesheet" href="/mark/assets/css/0.styles.b8afb793.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mark/" class="home-link router-link-active"><img src="/mark/mlogo.svg" alt="Mark" class="logo"> <span class="site-name can-hide">Mark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link">
  突击
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/key/" class="nav-link router-link-active">
  key
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/txxs/mark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link">
  突击
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/key/" class="nav-link router-link-active">
  key
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/txxs/mark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>关键问题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mark/q&amp;a/key/Kafka关键问题.html" class="active sidebar-link">/q&amp;a/key/Kafka关键问题.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ol><li>Kafka一致性（可靠性）原理。</li></ol> <ul><li><p>生产者：生产的消息需要被ac，有三种ack的方式，分别是全部副本要ack；全部副本不需要ack；</p></li> <li><p>还有就是ISR，ISR是在延迟时间内可以和leader保持一致的副本。</p></li> <li><p>另外还有幂等：通过produceID+序列号的方式实现。而消费者这边也是两种，分别是高水位，只有高水位的消息才会被消费，这样就保证了副本的一致性；另外就是消费了的消息才会被提交，保证了单副本的一致性。</p></li> <li><p>还有这个：
HW 更新是需要一轮额外的拉取请求才能实现，Follower 副本要拉取 Leader 副本的数据，也就是说，Leader 副本 HW 更新和 Follower 副本 HW 更新在时间上是存在错配的。这种错配是很多“数据丢失”或“数据不一致”问题的根源。因此社区在 0.11 版本正式引入了 「Leader Epoch」 概念，来规避因 HW 更新错配导致的各种不一致问题。
所谓 Leader Epoch，我们大致可以认为是 Leader 版本。它由两部分数据组成
1）Epoch: 一个单调递增的版本号。每当副本 Leader 权力发生变更时，都会增加该版本号。小版本号的 Leader 被认为是过期 Leader，不能再行使 Leader 权力。
2）起始位移（Start Offset）: Leader 副本在该 Epoch 值上写入的首条消息的位移。</p></li></ul> <ol start="2"><li>Kafka 为什么能那么快 | Kafka高效读写数据的原因据的原因 | 吞吐量大的原因？</li></ol> <ul><li>partition 并行处理</li> <li>顺序写磁盘，充分利用磁盘特性</li> <li>利用了现代操作系统分页存储 Page Cache 来利用内存提高 I/O 效率</li> <li>采用了零拷贝技术
<ul><li>Producer 生产的数据持久化到 broker，采用 mmap 文件映射，实现顺序的快速写入</li> <li>Customer 从 broker 读取数据，采用 sendfile，将磁盘文件读到 OS 内核缓冲区后，转到 NIO buffer进行网络发送，减少 CPU 消耗</li></ul></li></ul> <ol start="3"><li><p>如何保证消息队列的幂等性？</p> <p>一个是生产者幂等，另外一个是消费者幂等。生产者幂等是设置参数为true。消费者幂等，更多的是通过程序保证：
向数据库insert数据时，先根据主键查询，若数据存在则不insert，改为update
向Redis中写数据可以用set去重，天然保证幂等性
生产者发送每条消息时，增加一个全局唯一id（类似订单id），消费者消费到时，先根据这个id去Redis中查询是否消费过该消息。如果没有消费过，就处理，将id写入Redis；如果消费过了，那么就不处理，保证不重复处理相同消息。
基于数据库的唯一键约束来保证不会插入重复的数据，当消费者企图插入重复数据到数据库时，会报错。</p></li> <li><p>谈一谈 Kafka 的再均衡</p> <p>发生条件</p> <ul><li><p>一：分区数放生变化</p></li> <li><p>二：topic发生变化</p></li> <li><p>三：消费者发生变化</p></li> <li><p>第一步：所有成员都向 coordinator 发送请求，请求入组。一旦所有成员都发送了请求，coordinator 会从中选择一个consumer担任leader的角色，并把组成员信息以及订阅信息发给leader。</p></li> <li><p>第二步：leader开始分配消费方案，指明具体哪个consumer负责消费哪些topic的哪些partition。一旦完成分配，leader会将这个方案发给coordinator。coordinator接收到分配方案之后会把方案发给各个consumer，这样组内</p></li></ul></li> <li><p>再均衡策略</p></li></ol> <p>这里主要说的是消费的分区分配策略，我们知道一个 Consumer Group 中有多个 Consumer，一个 Topic 也有多个 Partition，所以必然会有 Partition 分配问题「 确定哪个 Partition 由哪个 Consumer 来消费的问题」。Kafka 客户端提供了3 种分区分配策略：RangeAssignor、RoundRobinAssignor 和 StickyAssignor，前两种分配方案相对简单一些StickyAssignor 分配方案相对复杂一些。</p> <ul><li><p>RangeAssignor RangeAssignor 是 Kafka 默认的分区分配算法，它是按照 Topic 的维度进行分配的，首先对 每个Topic 的 Partition 按照分区ID进行排序，然后对订阅该 Topic 的 Consumer Group 的 Consumer 按名称字典进行排序，之后尽量均衡的按照范围区段将分区分配给 Consumer。此时也可能会造成先分配分区的 Consumer 任务过重（分区数无法被消费者数量整除）。 问题：优先分配前边几个消费组，如果消费者多partition少的情况下，总是前几个消费者分配。</p></li> <li><p>RoundRobinAssignor 该分区分配策略是将 Consumer Group 订阅的所有 Topic 的 Partition 及所有 Consumer 按照字典进行排序后尽量均衡的挨个进行分配。如果 Consumer Group 内，每个 Consumer 订阅都订阅了相同的Topic，那么分配结果是均衡的。如果订阅 Topic 是不同的，那么分配结果是不保证「 尽量均衡」的，因为某些 Consumer 可能不参与一些 Topic 的分配。 问题：单个topic和单个partition分配不均衡</p></li> <li><p>StickyAssignor 该分区分配算法是最复杂的一种，可以通过 partition.assignment.strategy 参数去设置，从 0.11 版本开始引入，目的就是在执行新分配时，尽量在上一次分配结果上少做调整，其主要实现了以下2个目标： 1、Topic Partition 的分配要尽量均衡。 2、当 Rebalance 发生时，尽量与上一次分配结果保持一致。 注意：当两个目标发生冲突的时候，优先保证第一个目标，这样可以使分配更加均匀，其中第一个目标是3种分配策略都尽量去尝试完成的， 而第二个目标才是该算法的精髓所在</p></li></ul> <ol start="6"><li><p>消费出现挤压</p> <p>发送端：发送端即生产者业务代码都是先执行自己的业务逻辑，最后再发送消息。如果说性能上不去，需要你优先检查一下，是不是发消息之前的业务逻辑耗时太多导致的。</p> <p>对于发送消息的业务逻辑，只需要注意设置合适的并发和批量大小，就可以达到很好的发送性能。我们知道 Producer 发消息给 Broker 且收到消息并返回 ack 响应，假设这一次过程的平均时延是 1ms，它包括了下面这些步骤的耗时：</p> <ul><li>1）发送端在发送网络请求之前的耗时。</li> <li>2）发送消息和返回响应在网络传输中的耗时</li> <li>3）Broker 端处理消息的时延。</li></ul> <p>假设此时你的发送端是单线程，每次只能发送 1 条消息，那么每秒只能发送 1000 条消息，这种情况下并不能发挥出 Kafka 的真实性能。此时无论是增加每次发送消息的批量大小，还是增加并发，都可以成倍地提升发送性能。</p> <p>如果当前发送端是在线服务的话，比较在意请求响应时延，此时可以采用并发方式来提升性能。
如果当前发送端是离线服务的话，更关注系统的吞吐量，发送数据一般都来自数据库，此时更适合批量读取，批量发送来提升性能
另外还需要关注下消息体是否过大，如果消息体过大，势必会增加 IO 的耗时，影响 Kafka 生产和消费的速度，也可能会造成消息积压</p> <p>首先看生产者是不不是流量增加，如果增加了就询问原因和沟通
其次看消费者是不是有报错，如果必须要增加流量就需要评估增加流量的链路是否有问题，如果没有问题那手段可以是：增加并发度，增加线程，批量消费，无效的消息过滤等。</p></li> <li><p>发送端怎么避免fullfc
弄一个内存池子，分块，批量发送的时候循环使用，同时不要释放这块内存，这样就可以避免fullgc。</p></li> <li><p>写入的过程可以总结为：</p></li></ol> <ul><li>Producer先从Zookeeper的&quot;/brokers/.../state&quot;节点找到该Partition的Leader。</li> <li>Producer将消息发送给该Leader。</li> <li>Leader将消息写入本地log。</li> <li>followers从Leader pull消息，写入本地log后Leader发送ACK。</li> <li>Leader收到所有ISR中的replica的ACK后，增加HW并向Producer发送ACK。</li></ul> <ol start="9"><li><p>存储机制
一个topic可以分为多个partition，一个partition可以分为多个segment，一个segment可以分为index和log文件。
index 和 log 文件以当前 Segment 的第一条消息的 Offset 命名
分段的好处：好查询，好删除</p></li> <li><p>kafka高可用：</p></li></ol> <ul><li><p>备份机制：Kafka允许同一个Partition存在多个消息副本，每个Partition的副本通常由1个Leader及0个以上的Follower组成，生产者将消息直接发往对应Partition的Leader，Follower会周期地向Leader发送同步请求，同一Partition的Replica不应存储在同一个Broker上，因为一旦该Broker宕机，对应Partition的所有Replica都无法工作，这就达不到高可用的效果</p></li> <li><p>ISR机制：ISR 中的副本都是与 Leader 同步的副本，相反，不在 ISR 中的追随者副本就被认为是与 Leader 不同步的，这里的保持同步不是指与Leader数据保持完全一致，只需在replica.lag.time.max.ms时间内与Leader保持有效连接</p></li> <li><p>ACK机制：生产者发送消息中包含acks字段，该字段代表Leader应答生产者前Leader收到的应答数</p></li> <li><p>故障恢复机制：「Kafka从0.8版本开始引入了一套Leader选举及失败恢复机制」，首先需要在集群所有Broker中选出一个Controller，负责各Partition的Leader选举以及Replica的重新分配当出现Leader故障后，Controller会将Leader/Follower的变动通知到需为此作出响应的Broker。Kafka使用ZooKeeper存储Broker、Topic等状态数据，Kafka集群中的Controller和Broker会在ZooKeeper指定节点上注册Watcher(事件监听器)，以便在特定事件触发时，由ZooKeeper将事件通知到对应Broker</p></li></ul> <ol start="11"><li>kafka的事务</li></ol> <ul><li><p>幂等设计只能保证单个 Producer 对于同一个&lt;Topic, Partition&gt;的Exactly Once语义，它并不能保证写操作的原子性——即多个写操作，要么全部被 Commit 要么全部不被 Commit。为了实现这一点，Kafka 0.11.0.0 引入了一个服务器端的模块，名为Transaction Coordinator，用于管理 Producer 发送的消息的事务性。该Transaction Coordinator维护Transaction Log，该 log 存于一个内部的 Topic 内。由于 Topic 数据具有持久性，因此事务的状态也具有持久性。Producer 并不直接读写Transaction Log，它与Transaction Coordinator通信，然后由Transaction Coordinator将该事务的状态插入相应的Transaction Log。 事务初始化是针对于多条的produrcert同时发送的情况：</p></li> <li><p>事务初始化：Producer 在使用事务功能，必须先自定义一个唯一的 transaction id。有了 transaction id，即使客户端挂掉了，它重启后也能继续处理未完成的事务。Kafka 实现事务需要依靠幂等性，而幂等性需要指定 producer id 。所以Producer在启动事务之前，需要向 TC 服务申请 producer id。TC 服务在分配 producer id 后，会将它持久化到事务 topic。</p></li> <li><p>发送消息：Producer 在接收到 producer id 后，就可以正常的发送消息了。不过发送消息之前，需要先将这些消息的分区地址，上传到 TC 服务。TC 服务会将这些分区地址持久化到事务 topic。然后 Producer 才会真正的发送消息，这些消息与普通消息不同，它们会有一个字段，表示自身是事务消息。这里需要注意下一种特殊的请求，提交消费位置请求，用于原子性的从某个 topic 读取消息，并且发送消息到另外一个 topic。我们知道一般是消费者使用消费组订阅 topic，才会发送提交消费位置的请求，而这里是由 Producer 发送的。Producer 首先会发送一条请求，里面会包含这个消费组对应的分区（每个消费组的消费位置都保存在 __consumer_offset topic 的一个分区里），TC 服务会将分区持久化之后，发送响应。Producer 收到响应后，就会直接发送消费位置请求给 GroupCoordinator。</p></li> <li><p>发送提交请求：Producer 发送完消息后，如果认为该事务可以提交了，就会发送提交请求到 TC 服务。Producer 的工作至此就完成了，接下来它只需要等待响应。这里需要强调下，Producer 会在发送事务提交请求之前，会等待之前所有的请求都已经发送并且响应成功。</p></li> <li><p>提交请求持久化：TC 服务收到事务提交请求后，会先将提交信息先持久化到事务 topic 。持久化成功后，服务端就立即发送成功响应给 Producer。然后找到该事务涉及到的所有分区，为每 个分区生成提交请求，存到队列里等待发送。读者可能有所疑问，在一般的二阶段提交中，协调者需要收到所有参与者的响应后，才能判断此事务是否成功，最后才将结果返回给客户。那如果 TC 服务在发送响应给 Producer 后，还没来及向分区发送请求就挂掉了，那么 Kafka 是如何保证事务完成。因为每次事务的信息都会持久化，所以 TC 服务挂掉重新启动后，会先从 事务 topic 加载事务信息，如果发现只有事务提交信息，却没有后来的事务完成信息，说明存在事务结果信息没有提交到分区。</p></li> <li><p>发送事务结果信息给分区：后台线程会不停的从队列里，拉取请求并且发送到分区。当一个分区收到事务结果消息后，会将结果保存到分区里，并且返回成功响应到 TC服务。当 TC 服务收到所有分区的成功响应后，会持久化一条事务完成的消息到事务 topic。至此，一个完整的事务流程就完成了。</p></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/txxs/mark/edit/master/docs/q&amp;a/key/Kafka关键问题.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-04-19 06:52:48</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mark/assets/js/app.2dbe1734.js" defer></script><script src="/mark/assets/js/2.9796e7dc.js" defer></script><script src="/mark/assets/js/231.eab10621.js" defer></script><script src="/mark/assets/js/4.70c6b853.js" defer></script>
  </body>
</html>

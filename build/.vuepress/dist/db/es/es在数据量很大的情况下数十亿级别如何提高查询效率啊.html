<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>面试题 | Mark</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/mark/mlogo.svg">
    <link rel="manifest" href="/mark/manifest.json">
    <meta name="description" content="本博客主要是用来记录系统化的知识，内容部分来自github上的其他开源仓库，如有问题联系sdlyjhm01@sina.com">
    
    <link rel="preload" href="/mark/assets/css/0.styles.06a758ea.css" as="style"><link rel="preload" href="/mark/assets/js/app.92e1a2e3.js" as="script"><link rel="preload" href="/mark/assets/js/2.9796e7dc.js" as="script"><link rel="preload" href="/mark/assets/js/24.cbd56564.js" as="script"><link rel="preload" href="/mark/assets/js/4.70c6b853.js" as="script"><link rel="prefetch" href="/mark/assets/js/10.fbb45a51.js"><link rel="prefetch" href="/mark/assets/js/100.027a096c.js"><link rel="prefetch" href="/mark/assets/js/101.f7067152.js"><link rel="prefetch" href="/mark/assets/js/102.024ad162.js"><link rel="prefetch" href="/mark/assets/js/103.5d056aae.js"><link rel="prefetch" href="/mark/assets/js/104.fa4d8cec.js"><link rel="prefetch" href="/mark/assets/js/105.17b344cf.js"><link rel="prefetch" href="/mark/assets/js/106.9bce0bab.js"><link rel="prefetch" href="/mark/assets/js/107.161ce549.js"><link rel="prefetch" href="/mark/assets/js/108.d9024072.js"><link rel="prefetch" href="/mark/assets/js/109.ee27b37e.js"><link rel="prefetch" href="/mark/assets/js/11.80b654ab.js"><link rel="prefetch" href="/mark/assets/js/110.a1830cac.js"><link rel="prefetch" href="/mark/assets/js/111.06885278.js"><link rel="prefetch" href="/mark/assets/js/112.ec48555e.js"><link rel="prefetch" href="/mark/assets/js/113.24635129.js"><link rel="prefetch" href="/mark/assets/js/114.8fc77473.js"><link rel="prefetch" href="/mark/assets/js/115.a39b0ea1.js"><link rel="prefetch" href="/mark/assets/js/116.b0cfd3ac.js"><link rel="prefetch" href="/mark/assets/js/117.0bff6f69.js"><link rel="prefetch" href="/mark/assets/js/118.d9a1678f.js"><link rel="prefetch" href="/mark/assets/js/119.360d7624.js"><link rel="prefetch" href="/mark/assets/js/12.6d0871a3.js"><link rel="prefetch" href="/mark/assets/js/120.0f07abc2.js"><link rel="prefetch" href="/mark/assets/js/121.25ef4688.js"><link rel="prefetch" href="/mark/assets/js/122.ab535412.js"><link rel="prefetch" href="/mark/assets/js/123.aff98816.js"><link rel="prefetch" href="/mark/assets/js/124.f8f14c50.js"><link rel="prefetch" href="/mark/assets/js/125.b1a78758.js"><link rel="prefetch" href="/mark/assets/js/126.8eb36919.js"><link rel="prefetch" href="/mark/assets/js/127.464c203d.js"><link rel="prefetch" href="/mark/assets/js/128.687c2e6e.js"><link rel="prefetch" href="/mark/assets/js/129.51e6ba47.js"><link rel="prefetch" href="/mark/assets/js/13.e3a73739.js"><link rel="prefetch" href="/mark/assets/js/130.c717debd.js"><link rel="prefetch" href="/mark/assets/js/131.a57c7484.js"><link rel="prefetch" href="/mark/assets/js/132.02d1a2d2.js"><link rel="prefetch" href="/mark/assets/js/133.ca253696.js"><link rel="prefetch" href="/mark/assets/js/134.2991f9c5.js"><link rel="prefetch" href="/mark/assets/js/135.8ef71a2a.js"><link rel="prefetch" href="/mark/assets/js/136.dc605919.js"><link rel="prefetch" href="/mark/assets/js/137.67730076.js"><link rel="prefetch" href="/mark/assets/js/138.d8c65801.js"><link rel="prefetch" href="/mark/assets/js/139.2f99ff7e.js"><link rel="prefetch" href="/mark/assets/js/14.1ed959f6.js"><link rel="prefetch" href="/mark/assets/js/140.3b645a3e.js"><link rel="prefetch" href="/mark/assets/js/141.6f8749be.js"><link rel="prefetch" href="/mark/assets/js/142.3d959e49.js"><link rel="prefetch" href="/mark/assets/js/143.5b78829e.js"><link rel="prefetch" href="/mark/assets/js/144.4c4816a2.js"><link rel="prefetch" href="/mark/assets/js/145.79841a51.js"><link rel="prefetch" href="/mark/assets/js/146.1fc2cd42.js"><link rel="prefetch" href="/mark/assets/js/147.6eb84780.js"><link rel="prefetch" href="/mark/assets/js/148.a4173523.js"><link rel="prefetch" href="/mark/assets/js/149.d74a2622.js"><link rel="prefetch" href="/mark/assets/js/15.c1038853.js"><link rel="prefetch" href="/mark/assets/js/150.58feda5b.js"><link rel="prefetch" href="/mark/assets/js/151.96c562cb.js"><link rel="prefetch" href="/mark/assets/js/152.35ddf89d.js"><link rel="prefetch" href="/mark/assets/js/153.b79e6a8b.js"><link rel="prefetch" href="/mark/assets/js/154.97779b76.js"><link rel="prefetch" href="/mark/assets/js/155.43cd2156.js"><link rel="prefetch" href="/mark/assets/js/156.236533c2.js"><link rel="prefetch" href="/mark/assets/js/157.d015e470.js"><link rel="prefetch" href="/mark/assets/js/158.0e1f8c13.js"><link rel="prefetch" href="/mark/assets/js/159.9de871d5.js"><link rel="prefetch" href="/mark/assets/js/16.f00c64fd.js"><link rel="prefetch" href="/mark/assets/js/160.83e77120.js"><link rel="prefetch" href="/mark/assets/js/161.78228eb1.js"><link rel="prefetch" href="/mark/assets/js/162.adce8a63.js"><link rel="prefetch" href="/mark/assets/js/163.b2d017d3.js"><link rel="prefetch" href="/mark/assets/js/164.69825b4d.js"><link rel="prefetch" href="/mark/assets/js/165.f554269d.js"><link rel="prefetch" href="/mark/assets/js/166.cceac3ee.js"><link rel="prefetch" href="/mark/assets/js/167.9f6db258.js"><link rel="prefetch" href="/mark/assets/js/168.424f4d8a.js"><link rel="prefetch" href="/mark/assets/js/169.11e13f73.js"><link rel="prefetch" href="/mark/assets/js/17.73b72526.js"><link rel="prefetch" href="/mark/assets/js/170.d67b1e26.js"><link rel="prefetch" href="/mark/assets/js/171.95caf8ff.js"><link rel="prefetch" href="/mark/assets/js/172.98326d74.js"><link rel="prefetch" href="/mark/assets/js/173.12208555.js"><link rel="prefetch" href="/mark/assets/js/174.e2e512d1.js"><link rel="prefetch" href="/mark/assets/js/175.5de95aae.js"><link rel="prefetch" href="/mark/assets/js/176.fd89c678.js"><link rel="prefetch" href="/mark/assets/js/177.e4018046.js"><link rel="prefetch" href="/mark/assets/js/178.837eaca8.js"><link rel="prefetch" href="/mark/assets/js/179.6533cab8.js"><link rel="prefetch" href="/mark/assets/js/18.853ba918.js"><link rel="prefetch" href="/mark/assets/js/180.add9c61e.js"><link rel="prefetch" href="/mark/assets/js/181.584ec0c3.js"><link rel="prefetch" href="/mark/assets/js/182.ab450f09.js"><link rel="prefetch" href="/mark/assets/js/183.e4c7f14b.js"><link rel="prefetch" href="/mark/assets/js/184.fb202665.js"><link rel="prefetch" href="/mark/assets/js/185.599a5ec7.js"><link rel="prefetch" href="/mark/assets/js/186.bc6afb47.js"><link rel="prefetch" href="/mark/assets/js/187.f4e863e4.js"><link rel="prefetch" href="/mark/assets/js/188.9807b51e.js"><link rel="prefetch" href="/mark/assets/js/189.b8753c71.js"><link rel="prefetch" href="/mark/assets/js/19.e9b1dcfd.js"><link rel="prefetch" href="/mark/assets/js/190.c37c0c58.js"><link rel="prefetch" href="/mark/assets/js/191.d658c007.js"><link rel="prefetch" href="/mark/assets/js/192.ec89e330.js"><link rel="prefetch" href="/mark/assets/js/193.5ec91a0f.js"><link rel="prefetch" href="/mark/assets/js/194.bcc3b6ac.js"><link rel="prefetch" href="/mark/assets/js/195.e7e89a8e.js"><link rel="prefetch" href="/mark/assets/js/196.9650acd0.js"><link rel="prefetch" href="/mark/assets/js/197.60ed2939.js"><link rel="prefetch" href="/mark/assets/js/198.9dcbad35.js"><link rel="prefetch" href="/mark/assets/js/199.e08acaf4.js"><link rel="prefetch" href="/mark/assets/js/20.4f331f61.js"><link rel="prefetch" href="/mark/assets/js/200.62d87394.js"><link rel="prefetch" href="/mark/assets/js/201.d4bde771.js"><link rel="prefetch" href="/mark/assets/js/202.1393910b.js"><link rel="prefetch" href="/mark/assets/js/203.cb278cbf.js"><link rel="prefetch" href="/mark/assets/js/204.0b19e441.js"><link rel="prefetch" href="/mark/assets/js/205.0f299615.js"><link rel="prefetch" href="/mark/assets/js/206.822078c6.js"><link rel="prefetch" href="/mark/assets/js/207.0b3c1c27.js"><link rel="prefetch" href="/mark/assets/js/208.cee4afc6.js"><link rel="prefetch" href="/mark/assets/js/209.9f987997.js"><link rel="prefetch" href="/mark/assets/js/21.c74f1424.js"><link rel="prefetch" href="/mark/assets/js/210.b912554e.js"><link rel="prefetch" href="/mark/assets/js/211.9d3e75a5.js"><link rel="prefetch" href="/mark/assets/js/212.71ebd5db.js"><link rel="prefetch" href="/mark/assets/js/213.9a4b3c07.js"><link rel="prefetch" href="/mark/assets/js/214.486d9eaa.js"><link rel="prefetch" href="/mark/assets/js/215.07f79be1.js"><link rel="prefetch" href="/mark/assets/js/216.90ee67e6.js"><link rel="prefetch" href="/mark/assets/js/217.a21585ca.js"><link rel="prefetch" href="/mark/assets/js/218.b35d663a.js"><link rel="prefetch" href="/mark/assets/js/219.4595de1c.js"><link rel="prefetch" href="/mark/assets/js/22.c1d496c9.js"><link rel="prefetch" href="/mark/assets/js/220.f29de7a1.js"><link rel="prefetch" href="/mark/assets/js/221.89b143f6.js"><link rel="prefetch" href="/mark/assets/js/222.cca213d4.js"><link rel="prefetch" href="/mark/assets/js/223.6146a6d7.js"><link rel="prefetch" href="/mark/assets/js/224.5ddd3952.js"><link rel="prefetch" href="/mark/assets/js/225.c131d933.js"><link rel="prefetch" href="/mark/assets/js/226.367e606b.js"><link rel="prefetch" href="/mark/assets/js/227.6e5da2f7.js"><link rel="prefetch" href="/mark/assets/js/228.11123405.js"><link rel="prefetch" href="/mark/assets/js/229.d8a0b5fa.js"><link rel="prefetch" href="/mark/assets/js/23.4333640f.js"><link rel="prefetch" href="/mark/assets/js/230.20010286.js"><link rel="prefetch" href="/mark/assets/js/231.481866c6.js"><link rel="prefetch" href="/mark/assets/js/232.7b2aa9dc.js"><link rel="prefetch" href="/mark/assets/js/233.abff58fe.js"><link rel="prefetch" href="/mark/assets/js/234.c5f9f58f.js"><link rel="prefetch" href="/mark/assets/js/235.67940be6.js"><link rel="prefetch" href="/mark/assets/js/236.2d8f374c.js"><link rel="prefetch" href="/mark/assets/js/237.8f5d87d5.js"><link rel="prefetch" href="/mark/assets/js/238.63b71a1d.js"><link rel="prefetch" href="/mark/assets/js/239.05c3b17a.js"><link rel="prefetch" href="/mark/assets/js/240.87f0594c.js"><link rel="prefetch" href="/mark/assets/js/241.110e4bac.js"><link rel="prefetch" href="/mark/assets/js/242.35914afa.js"><link rel="prefetch" href="/mark/assets/js/243.59f4fc4d.js"><link rel="prefetch" href="/mark/assets/js/244.0b97267d.js"><link rel="prefetch" href="/mark/assets/js/245.53b73619.js"><link rel="prefetch" href="/mark/assets/js/246.828715ee.js"><link rel="prefetch" href="/mark/assets/js/247.3d23aaba.js"><link rel="prefetch" href="/mark/assets/js/248.bbd06a7d.js"><link rel="prefetch" href="/mark/assets/js/249.41aea4f1.js"><link rel="prefetch" href="/mark/assets/js/25.ac8322d1.js"><link rel="prefetch" href="/mark/assets/js/250.da82811d.js"><link rel="prefetch" href="/mark/assets/js/251.39562a60.js"><link rel="prefetch" href="/mark/assets/js/252.de0bf0bc.js"><link rel="prefetch" href="/mark/assets/js/253.5d547c29.js"><link rel="prefetch" href="/mark/assets/js/254.aea8fdae.js"><link rel="prefetch" href="/mark/assets/js/255.7c51ec31.js"><link rel="prefetch" href="/mark/assets/js/256.06fe17f9.js"><link rel="prefetch" href="/mark/assets/js/257.33c2ec09.js"><link rel="prefetch" href="/mark/assets/js/258.e58e44fa.js"><link rel="prefetch" href="/mark/assets/js/259.9571c018.js"><link rel="prefetch" href="/mark/assets/js/26.785db377.js"><link rel="prefetch" href="/mark/assets/js/260.86bee389.js"><link rel="prefetch" href="/mark/assets/js/261.11e74891.js"><link rel="prefetch" href="/mark/assets/js/262.a3886826.js"><link rel="prefetch" href="/mark/assets/js/263.edfe28ba.js"><link rel="prefetch" href="/mark/assets/js/264.392bdd96.js"><link rel="prefetch" href="/mark/assets/js/265.836530c0.js"><link rel="prefetch" href="/mark/assets/js/266.1c9900d2.js"><link rel="prefetch" href="/mark/assets/js/267.8dbb63c6.js"><link rel="prefetch" href="/mark/assets/js/268.d91309e2.js"><link rel="prefetch" href="/mark/assets/js/269.7ec3892f.js"><link rel="prefetch" href="/mark/assets/js/27.eb7e8ff0.js"><link rel="prefetch" href="/mark/assets/js/270.5c482c88.js"><link rel="prefetch" href="/mark/assets/js/271.39ff24be.js"><link rel="prefetch" href="/mark/assets/js/272.06bb9e48.js"><link rel="prefetch" href="/mark/assets/js/273.aa6a5d00.js"><link rel="prefetch" href="/mark/assets/js/274.5924dec3.js"><link rel="prefetch" href="/mark/assets/js/275.eaa6987b.js"><link rel="prefetch" href="/mark/assets/js/276.49237d44.js"><link rel="prefetch" href="/mark/assets/js/28.d637a557.js"><link rel="prefetch" href="/mark/assets/js/29.78f496e8.js"><link rel="prefetch" href="/mark/assets/js/3.d3cb6ecd.js"><link rel="prefetch" href="/mark/assets/js/30.04b98d4d.js"><link rel="prefetch" href="/mark/assets/js/31.98f1a2af.js"><link rel="prefetch" href="/mark/assets/js/32.0bc8f6d9.js"><link rel="prefetch" href="/mark/assets/js/33.fddffa17.js"><link rel="prefetch" href="/mark/assets/js/34.2e2cc112.js"><link rel="prefetch" href="/mark/assets/js/35.b5c65e52.js"><link rel="prefetch" href="/mark/assets/js/36.8156b993.js"><link rel="prefetch" href="/mark/assets/js/37.d4d6b147.js"><link rel="prefetch" href="/mark/assets/js/38.c9ea75bc.js"><link rel="prefetch" href="/mark/assets/js/39.41376eb5.js"><link rel="prefetch" href="/mark/assets/js/40.73d2d9e4.js"><link rel="prefetch" href="/mark/assets/js/41.f172bc1f.js"><link rel="prefetch" href="/mark/assets/js/42.b437e03b.js"><link rel="prefetch" href="/mark/assets/js/43.3cd3f1b3.js"><link rel="prefetch" href="/mark/assets/js/44.292881ee.js"><link rel="prefetch" href="/mark/assets/js/45.c1e3cae0.js"><link rel="prefetch" href="/mark/assets/js/46.fe779fca.js"><link rel="prefetch" href="/mark/assets/js/47.67fffb22.js"><link rel="prefetch" href="/mark/assets/js/48.c6c664aa.js"><link rel="prefetch" href="/mark/assets/js/49.50269c8a.js"><link rel="prefetch" href="/mark/assets/js/5.0b2d3a40.js"><link rel="prefetch" href="/mark/assets/js/50.b7c51e4d.js"><link rel="prefetch" href="/mark/assets/js/51.88fad818.js"><link rel="prefetch" href="/mark/assets/js/52.727c66c2.js"><link rel="prefetch" href="/mark/assets/js/53.38c41b64.js"><link rel="prefetch" href="/mark/assets/js/54.daeb58fa.js"><link rel="prefetch" href="/mark/assets/js/55.94bdad99.js"><link rel="prefetch" href="/mark/assets/js/56.ae880421.js"><link rel="prefetch" href="/mark/assets/js/57.994fbd52.js"><link rel="prefetch" href="/mark/assets/js/58.adaa2964.js"><link rel="prefetch" href="/mark/assets/js/59.e32e2057.js"><link rel="prefetch" href="/mark/assets/js/6.f05774e4.js"><link rel="prefetch" href="/mark/assets/js/60.43e99ed1.js"><link rel="prefetch" href="/mark/assets/js/61.f3edf3c6.js"><link rel="prefetch" href="/mark/assets/js/62.08cf95d5.js"><link rel="prefetch" href="/mark/assets/js/63.6810e631.js"><link rel="prefetch" href="/mark/assets/js/64.50593833.js"><link rel="prefetch" href="/mark/assets/js/65.9ab86a1d.js"><link rel="prefetch" href="/mark/assets/js/66.9efa2efa.js"><link rel="prefetch" href="/mark/assets/js/67.8c4b3654.js"><link rel="prefetch" href="/mark/assets/js/68.8000c397.js"><link rel="prefetch" href="/mark/assets/js/69.3247d5d4.js"><link rel="prefetch" href="/mark/assets/js/7.46392252.js"><link rel="prefetch" href="/mark/assets/js/70.618e85ff.js"><link rel="prefetch" href="/mark/assets/js/71.837fc208.js"><link rel="prefetch" href="/mark/assets/js/72.e86979bd.js"><link rel="prefetch" href="/mark/assets/js/73.a8765062.js"><link rel="prefetch" href="/mark/assets/js/74.a3e3ac23.js"><link rel="prefetch" href="/mark/assets/js/75.bb7c9557.js"><link rel="prefetch" href="/mark/assets/js/76.5a8de615.js"><link rel="prefetch" href="/mark/assets/js/77.1f0bb919.js"><link rel="prefetch" href="/mark/assets/js/78.9a1b66d5.js"><link rel="prefetch" href="/mark/assets/js/79.be0dfaec.js"><link rel="prefetch" href="/mark/assets/js/8.929c879f.js"><link rel="prefetch" href="/mark/assets/js/80.7ddf1bc8.js"><link rel="prefetch" href="/mark/assets/js/81.b7badbfb.js"><link rel="prefetch" href="/mark/assets/js/82.78e85969.js"><link rel="prefetch" href="/mark/assets/js/83.420d43cc.js"><link rel="prefetch" href="/mark/assets/js/84.35905cc9.js"><link rel="prefetch" href="/mark/assets/js/85.413f4f6a.js"><link rel="prefetch" href="/mark/assets/js/86.21e9aa54.js"><link rel="prefetch" href="/mark/assets/js/87.7162bc56.js"><link rel="prefetch" href="/mark/assets/js/88.43d86259.js"><link rel="prefetch" href="/mark/assets/js/89.d974497f.js"><link rel="prefetch" href="/mark/assets/js/9.9d4021a1.js"><link rel="prefetch" href="/mark/assets/js/90.70a6df38.js"><link rel="prefetch" href="/mark/assets/js/91.25bfb1d6.js"><link rel="prefetch" href="/mark/assets/js/92.9cdc3392.js"><link rel="prefetch" href="/mark/assets/js/93.b5812dcf.js"><link rel="prefetch" href="/mark/assets/js/94.00b0fe67.js"><link rel="prefetch" href="/mark/assets/js/95.544b0da2.js"><link rel="prefetch" href="/mark/assets/js/96.94832874.js"><link rel="prefetch" href="/mark/assets/js/97.ee169531.js"><link rel="prefetch" href="/mark/assets/js/98.04594ceb.js"><link rel="prefetch" href="/mark/assets/js/99.895610bf.js">
    <link rel="stylesheet" href="/mark/assets/css/0.styles.06a758ea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mark/" class="home-link router-link-active"><img src="/mark/mlogo.svg" alt="Mark" class="logo"> <span class="site-name can-hide">Mark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link router-link-active">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link">
  突击
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/key/" class="nav-link">
  key
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/txxs/mark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://txxs.github.io/record/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程算法" class="dropdown-title"><span class="title">工程算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程算法" class="mobile-dropdown-title"><span class="title">工程算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/algo/" class="nav-link">
  个人总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务" class="dropdown-title"><span class="title">业务</span> <span class="arrow down"></span></button> <button type="button" aria-label="业务" class="mobile-dropdown-title"><span class="title">业务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/buss/" class="nav-link">
  buss
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/db/es/" class="nav-link router-link-active">
  ES
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/mark/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/distri/the/" class="nav-link">
  理论
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/rpc/" class="nav-link">
  rpc
</a></li><li class="dropdown-item"><!----> <a href="/mark/distri/zk/" class="nav-link">
  zk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问答" class="dropdown-title"><span class="title">问答</span> <span class="arrow down"></span></button> <button type="button" aria-label="问答" class="mobile-dropdown-title"><span class="title">问答</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/interview/" class="nav-link">
  问答
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow down"></span></button> <button type="button" aria-label="java" class="mobile-dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/java/collection/" class="nav-link">
  collection
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/thread/" class="nav-link">
  thread
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/io/" class="nav-link">
  io
</a></li><li class="dropdown-item"><!----> <a href="/mark/java/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kafka" class="dropdown-title"><span class="title">kafka</span> <span class="arrow down"></span></button> <button type="button" aria-label="kafka" class="mobile-dropdown-title"><span class="title">kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/kafka/" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="q&amp;a" class="dropdown-title"><span class="title">q&amp;a</span> <span class="arrow down"></span></button> <button type="button" aria-label="q&amp;a" class="mobile-dropdown-title"><span class="title">q&amp;a</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/interview/" class="nav-link">
  问答
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/self/" class="nav-link">
  自己
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/tuji/" class="nav-link">
  突击
</a></li><li class="dropdown-item"><!----> <a href="/mark/q&amp;a/key/" class="nav-link">
  key
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title">总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="总结" class="mobile-dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mark/self/" class="nav-link">
  问答
</a></li></ul></div></div> <a href="https://github.com/txxs/mark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>工程算法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mark/db/es/es写入和查询的工作原理是什么啊.html" class="sidebar-link">面试题</a></li><li><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html" class="active sidebar-link">面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#面试题" class="sidebar-link">面试题</a></li><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#面试官心理分析" class="sidebar-link">面试官心理分析</a></li><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#面试题剖析" class="sidebar-link">面试题剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#性能优化的杀手锏-filesystem-cache" class="sidebar-link">性能优化的杀手锏——filesystem cache</a></li><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#数据预热" class="sidebar-link">数据预热</a></li><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#冷热分离" class="sidebar-link">冷热分离</a></li><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#document-模型设计" class="sidebar-link">document 模型设计</a></li><li class="sidebar-sub-header"><a href="/mark/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.html#分页性能优化" class="sidebar-link">分页性能优化</a></li></ul></li></ul></li><li><a href="/mark/db/es/es的分布式架构原理能说一下么.html" class="sidebar-link">面试题</a></li><li><a href="/mark/db/es/ES选举-类Bully算法.html" class="sidebar-link">/db/es/ES选举-类Bully算法.html</a></li><li><a href="/mark/db/es/ES面试基础知识要点.html" class="sidebar-link">/db/es/ES面试基础知识要点.html</a></li><li><a href="/mark/db/es/倒排索引更具体的解释.html" class="sidebar-link">/db/es/倒排索引更具体的解释.html</a></li><li><a href="/mark/db/es/底层lucene和倒排索引.html" class="sidebar-link">底层 lucene</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="面试题"><a href="#面试题" class="header-anchor">#</a> 面试题</h2> <p>es 在数据量很大的情况下（数十亿级别）如何提高查询效率啊？</p> <h2 id="面试官心理分析"><a href="#面试官心理分析" class="header-anchor">#</a> 面试官心理分析</h2> <p>这个问题是肯定要问的，说白了，就是看你有没有实际干过 es，因为啥？其实 es 性能并没有你想象中那么好的。很多时候数据量大了，特别是有几亿条数据的时候，可能你会懵逼的发现，跑个搜索怎么一下 <code>5~10s</code>，坑爹了。第一次搜索的时候，是  <code>5~10s</code>，后面反而就快了，可能就几百毫秒。</p> <p>你就很懵，每个用户第一次访问都会比较慢，比较卡么？所以你要是没玩儿过 es，或者就是自己玩玩儿 demo，被问到这个问题容易懵逼，显示出你对 es 确实玩儿的不怎么样？</p> <h2 id="面试题剖析"><a href="#面试题剖析" class="header-anchor">#</a> 面试题剖析</h2> <p>说实话，es 性能优化是没有什么银弹的，啥意思呢？就是<strong>不要期待着随手调一个参数，就可以万能的应对所有的性能慢的场景</strong>。也许有的场景是你换个参数，或者调整一下语法，就可以搞定，但是绝对不是所有场景都可以这样。</p> <h3 id="性能优化的杀手锏-filesystem-cache"><a href="#性能优化的杀手锏-filesystem-cache" class="header-anchor">#</a> 性能优化的杀手锏——filesystem cache</h3> <p>你往 es 里写的数据，实际上都写到磁盘文件里去了，<strong>查询的时候</strong>，操作系统会将磁盘文件里的数据自动缓存到 <code>filesystem cache</code> 里面去。</p> <p><img src="https://txxs.github.io/pic/tofuturedbes/1-5.png" alt="es-search-process"></p> <p>es 的搜索引擎严重依赖于底层的 <code>filesystem cache</code>，你如果给 <code>filesystem cache</code> 更多的内存，尽量让内存可以容纳所有的 <code>idx segment file</code> 索引数据文件，那么你搜索的时候就基本都是走内存的，性能会非常高。</p> <p>性能差距究竟可以有多大？我们之前很多的测试和压测，如果走磁盘一般肯定上秒，搜索性能绝对是秒级别的，1秒、5秒、10秒。但如果是走 <code>filesystem cache</code>，是走纯内存的，那么一般来说性能比走磁盘要高一个数量级，基本上就是毫秒级的，从几毫秒到几百毫秒不等。</p> <p>这里有个真实的案例。某个公司 es 节点有 3 台机器，每台机器看起来内存很多，64G，总内存就是 <code>64 * 3 = 192G</code>。每台机器给 es jvm heap 是 <code>32G</code>，那么剩下来留给 <code>filesystem cache</code> 的就是每台机器才 <code>32G</code>，总共集群里给 <code>filesystem cache</code> 的就是 <code>32 * 3 = 96G</code> 内存。而此时，整个磁盘上索引数据文件，在 3 台机器上一共占用了 <code>1T</code> 的磁盘容量，es 数据量是 <code>1T</code>，那么每台机器的数据量是 <code>300G</code>。这样性能好吗？ <code>filesystem cache</code> 的内存才 100G，十分之一的数据可以放内存，其他的都在磁盘，然后你执行搜索操作，大部分操作都是走磁盘，性能肯定差。</p> <p>归根结底，你要让 es 性能要好，最佳的情况下，就是你的机器的内存，至少可以容纳你的总数据量的一半。</p> <p>根据我们自己的生产环境实践经验，最佳的情况下，是仅仅在 es 中就存少量的数据，就是你要<strong>用来搜索的那些索引</strong>，如果内存留给 <code>filesystem cache</code> 的是 100G，那么你就将索引数据控制在 <code>100G</code> 以内，这样的话，你的数据几乎全部走内存来搜索，性能非常之高，一般可以在 1 秒以内。</p> <p>比如说你现在有一行数据。<code>id,name,age ....</code> 30 个字段。但是你现在搜索，只需要根据 <code>id,name,age</code> 三个字段来搜索。如果你傻乎乎往 es 里写入一行数据所有的字段，就会导致说 <code>90%</code> 的数据是不用来搜索的，结果硬是占据了 es 机器上的 <code>filesystem cache</code> 的空间，单条数据的数据量越大，就会导致 <code>filesystem cahce</code> 能缓存的数据就越少。其实，仅仅写入 es 中要用来检索的<strong>少数几个字段</strong>就可以了，比如说就写入 es <code>id,name,age</code> 三个字段，然后你可以把其他的字段数据存在 mysql/hbase 里，我们一般是建议用 <code>es + hbase</code> 这么一个架构。</p> <p>hbase 的特点是<strong>适用于海量数据的在线存储</strong>，就是对 hbase 可以写入海量数据，但是不要做复杂的搜索，做很简单的一些根据 id 或者范围进行查询的这么一个操作就可以了。从 es 中根据 name 和 age 去搜索，拿到的结果可能就 20 个 <code>doc id</code>，然后根据 <code>doc id</code> 到 hbase 里去查询每个 <code>doc id</code> 对应的<strong>完整的数据</strong>，给查出来，再返回给前端。</p> <p>写入 es 的数据最好小于等于，或者是略微大于 es 的 filesystem cache 的内存容量。然后你从 es 检索可能就花费 20ms，然后再根据 es 返回的 id 去 hbase 里查询，查 20 条数据，可能也就耗费个 30ms，可能你原来那么玩儿，1T 数据都放 es，会每次查询都是 5~10s，现在可能性能就会很高，每次查询就是 50ms。</p> <h3 id="数据预热"><a href="#数据预热" class="header-anchor">#</a> 数据预热</h3> <p>假如说，哪怕是你就按照上述的方案去做了，es 集群中每个机器写入的数据量还是超过了 <code>filesystem cache</code> 一倍，比如说你写入一台机器 60G 数据，结果 <code>filesystem cache</code> 就 30G，还是有 30G 数据留在了磁盘上。</p> <p>其实可以做<strong>数据预热</strong>。</p> <p>举个例子，拿微博来说，你可以把一些大V，平时看的人很多的数据，你自己提前后台搞个系统，每隔一会儿，自己的后台系统去搜索一下热数据，刷到 <code>filesystem cache</code> 里去，后面用户实际上来看这个热数据的时候，他们就是直接从内存里搜索了，很快。</p> <p>或者是电商，你可以将平时查看最多的一些商品，比如说 iphone 8，热数据提前后台搞个程序，每隔 1 分钟自己主动访问一次，刷到 <code>filesystem cache</code> 里去。</p> <p>对于那些你觉得比较热的、经常会有人访问的数据，最好<strong>做一个专门的缓存预热子系统</strong>，就是对热数据每隔一段时间，就提前访问一下，让数据进入 <code>filesystem cache</code> 里面去。这样下次别人访问的时候，性能一定会好很多。</p> <h3 id="冷热分离"><a href="#冷热分离" class="header-anchor">#</a> 冷热分离</h3> <p>es 可以做类似于 mysql 的水平拆分，就是说将大量的访问很少、频率很低的数据，单独写一个索引，然后将访问很频繁的热数据单独写一个索引。最好是将<strong>冷数据写入一个索引中，然后热数据写入另外一个索引中</strong>，这样可以确保热数据在被预热之后，尽量都让他们留在 <code>filesystem os cache</code> 里，<strong>别让冷数据给冲刷掉</strong>。</p> <p>你看，假设你有 6 台机器，2 个索引，一个放冷数据，一个放热数据，每个索引 3 个 shard。3 台机器放热数据 index，另外 3 台机器放冷数据 index。然后这样的话，你大量的时间是在访问热数据 index，热数据可能就占总数据量的 10%，此时数据量很少，几乎全都保留在 <code>filesystem cache</code> 里面了，就可以确保热数据的访问性能是很高的。但是对于冷数据而言，是在别的 index 里的，跟热数据 index 不在相同的机器上，大家互相之间都没什么联系了。如果有人访问冷数据，可能大量数据是在磁盘上的，此时性能差点，就 10% 的人去访问冷数据，90% 的人在访问热数据，也无所谓了。</p> <h3 id="document-模型设计"><a href="#document-模型设计" class="header-anchor">#</a> document 模型设计</h3> <p>对于 MySQL，我们经常有一些复杂的关联查询。在 es 里该怎么玩儿，es 里面的复杂的关联查询尽量别用，一旦用了性能一般都不太好。</p> <p>最好是先在 Java 系统里就完成关联，将关联好的数据直接写入 es 中。搜索的时候，就不需要利用 es 的搜索语法来完成 join 之类的关联搜索了。</p> <p>document 模型设计是非常重要的，很多操作，不要在搜索的时候才想去执行各种复杂的乱七八糟的操作。es 能支持的操作就那么多，不要考虑用 es 做一些它不好操作的事情。如果真的有那种操作，尽量在 document 模型设计的时候，写入的时候就完成。另外对于一些太复杂的操作，比如 join/nested/parent-child 搜索都要尽量避免，性能都很差的。</p> <h3 id="分页性能优化"><a href="#分页性能优化" class="header-anchor">#</a> 分页性能优化</h3> <p>es 的分页是较坑的，为啥呢？举个例子吧，假如你每页是 10 条数据，你现在要查询第 100 页，实际上是会把每个 shard 上存储的前 1000 条数据都查到一个协调节点上，如果你有个 5 个 shard，那么就有 5000 条数据，接着协调节点对这 5000 条数据进行一些合并、处理，再获取到最终第 100 页的 10 条数据。</p> <p>分布式的，你要查第 100 页的 10 条数据，不可能说从 5 个 shard，每个 shard 就查 2 条数据，最后到协调节点合并成 10 条数据吧？你<strong>必须</strong>得从每个 shard 都查 1000 条数据过来，然后根据你的需求进行排序、筛选等等操作，最后再次分页，拿到里面第 100 页的数据。你翻页的时候，翻的越深，每个 shard 返回的数据就越多，而且协调节点处理的时间越长，非常坑爹。所以用 es 做分页的时候，你会发现越翻到后面，就越是慢。</p> <p>我们之前也是遇到过这个问题，用 es 作分页，前几页就几十毫秒，翻到 10 页或者几十页的时候，基本上就要 5~10 秒才能查出来一页数据了。</p> <p>有什么解决方案吗？</p> <h4 id="不允许深度分页-默认深度分页性能很差"><a href="#不允许深度分页-默认深度分页性能很差" class="header-anchor">#</a> 不允许深度分页（默认深度分页性能很差）</h4> <p>跟产品经理说，你系统不允许翻那么深的页，默认翻的越深，性能就越差。</p> <h4 id="类似于-app-里的推荐商品不断下拉出来一页一页的"><a href="#类似于-app-里的推荐商品不断下拉出来一页一页的" class="header-anchor">#</a> 类似于 app 里的推荐商品不断下拉出来一页一页的</h4> <p>类似于微博中，下拉刷微博，刷出来一页一页的，你可以用 <code>scroll api</code>，关于如何使用，自行上网搜索。</p> <p>scroll 会一次性给你生成<strong>所有数据的一个快照</strong>，然后每次滑动向后翻页就是通过<strong>游标</strong> <code>scroll_id</code> 移动，获取下一页下一页这样子，性能会比上面说的那种分页性能要高很多很多，基本上都是毫秒级的。</p> <p>但是，唯一的一点就是，这个适合于那种类似微博下拉翻页的，<strong>不能随意跳到任何一页的场景</strong>。也就是说，你不能先进入第 10 页，然后去第 120 页，然后又回到第 58 页，不能随意乱跳页。所以现在很多产品，都是不允许你随意翻页的，app，也有一些网站，做的就是你只能往下拉，一页一页的翻。</p> <p>初始化时必须指定 <code>scroll</code> 参数，告诉 es 要保存此次搜索的上下文多长时间。你需要确保用户不会持续不断翻页翻几个小时，否则可能因为超时而失败。</p> <p>除了用 <code>scroll api</code>，你也可以用 <code>search_after</code> 来做，<code>search_after</code> 的思想是使用前一页的结果来帮助检索下一页的数据，显然，这种方式也不允许你随意翻页，你只能一页页往后翻。初始化时，需要使用一个唯一值的字段作为 sort 字段。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/txxs/mark/edit/master/docs/db/es/es在数据量很大的情况下数十亿级别如何提高查询效率啊.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-01-04 13:20:52</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mark/db/es/es写入和查询的工作原理是什么啊.html" class="prev">
        面试题
      </a></span> <span class="next"><a href="/mark/db/es/es的分布式架构原理能说一下么.html">
        面试题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mark/assets/js/app.92e1a2e3.js" defer></script><script src="/mark/assets/js/2.9796e7dc.js" defer></script><script src="/mark/assets/js/24.cbd56564.js" defer></script><script src="/mark/assets/js/4.70c6b853.js" defer></script>
  </body>
</html>
